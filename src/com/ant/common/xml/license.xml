<?xml version="1.0" encoding="euc-kr"?>


<!DOCTYPE sqlMap
 PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
 "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="license">
	
	
	<!-- 문자 전송 -->
	<insert id="insertLicUmsData" parameterClass="java.util.HashMap">
		INSERT into ums_data (cmid, msg_type, status, request_time, dest_phone, send_phone, subject, msg_body, etc1, etc2, etc3 )
				values ( 
						 REPLACE(REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR, GETDATE(), 21),'-',''), ' ', ''), ':', ''),'.','')+CONVERT(VARCHAR,#umscnt#)
				        , #msg_type# 
				        , 0
				        , GETDATE()
				        , #dest_phone#  
				        , #send_phone# 
						, #subject#
				        , #msg_body#	
				        , #etc1#
				        , #etc2#	
				        , #etc3#			        							      
					   )	
	</insert>	
	

	
	<!-- 문자 예약 전송 -->
	<insert id="insertLicUmsResultData" parameterClass="java.util.HashMap">
		INSERT into ums_data (cmid, msg_type, status, request_time, dest_phone, send_phone, subject, msg_body, etc1, etc2, etc3 )
				values ( 
						 REPLACE(REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR, GETDATE(), 21),'-',''), ' ', ''), ':', ''),'.','')+CONVERT(VARCHAR,#umscnt#)
				        , #msg_type# 
				        , 0
				        , #request_time#
				        , #dest_phone#  
				        , #send_phone# 
						, #subject#
				        , #msg_body#	
				        , #etc1#
				        , #etc2#
				        , #etc3#				        							      
					   )	
	</insert>	
	
	
	<!--응시현황 조건 맞는내용출력  -->
	<select id="licensesand" resultClass="java.util.HashMap">
    	SELECT a.code_kind
      ,a.code_certifi
      ,a.code_seq
      ,a.code_bran
      ,a.bran_seq
      ,a.yyyy
      ,a.season
      ,a.operation_cnt
      ,a.operation
      ,a.start_dt
      ,a.end_dt
      ,a.oper_start_dt
      ,a.oper_end_dt
      ,a.receipt_pers_cnt
      ,a.operation_place
      ,a.account_end_dt
      ,a.account_way
      ,a.remark
      ,a.use_yn
      ,a.register
      ,a.regi_date
      ,a.updater
      ,a.up_date
	  ,case when b.code_kind = '5' then convert(varchar,a.yyyy)+'년도 '+'제'+CONVERT(varchar,a.operation_cnt)+'회 ' + (case when a.season in (1,2) then convert(varchar,a.season)+'학기 ' when a.season = 3 then '집합교육 ' when a.season = 4 then '온라인교육 ' else convert(varchar,a.season)+' ' end) + b.edutest_name + '-' + l.detcodename
                    else b.edutest_name end edutest_name
	  ,a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(a.operation_cnt,'0'))+convert(varchar,isnull(a.season,'0')) as detcode
  FROM edu_test a
     left join com_code l
       on l.groupcode = '034'
      and l.detcode = a.code_bran
     , edu_test_name b
  where 1=1
		   and a.code_kind = b.code_kind
		   and a.code_certifi = b.code_certifi
		   and a.code_seq = b.code_seq
		   and a.code_kind not in ('5')
	/* 자격증구분  */
	<dynamic prepend="and">
		<isNotEmpty property="code_certifi1">
			a.code_certifi = #code_certifi1#
		</isNotEmpty>
	</dynamic>
	/* 년도  */
	<dynamic prepend="and">
		<isNotEmpty property="yyyy1">
			a.yyyy = #yyyy1#
		</isNotEmpty>
	</dynamic>
	/* 지부  */
	<dynamic prepend="and">
		<isNotEmpty property="code_bran1">
			a.code_bran = #code_bran1#
		</isNotEmpty>
	</dynamic>
    </select>
	
	<!--공통코드-->
    <select id="licenseserch" resultClass="java.util.HashMap">
        SELECT groupcode
        , detcode
        , detcodename
		, tempcd1
        FROM com_code
        where use_yn='Y'
        ORDER BY cdseq, detcode
    </select>
    
    <!-- 자격증 구분 코드  display-->
    <select id="licenseserch1" resultClass="java.util.HashMap">
        SELECT
        code_certifi
        , certifi_name
        FROM certifi
		where use_yn='Y'
        ORDER BY code_certifi
    </select>
	
    <!--시험별응시현황 count  -->
	<select id="licensesendcnt" resultClass="java.util.HashMap">
    SELECT count(*) cnt
        FROM (
        select f.yyyy
			, f.code_bran
			, f.code_kind
			, f.code_seq
			, case when f.code_kind = '5' then convert(varchar,f.yyyy)+'년도 '+'제'+CONVERT(varchar,f.operation_cnt)+'회 ' + (case when f.season in (1,2) then convert(varchar,f.season)+'학기 ' when f.season = 3 then '집합교육 ' when f.season = 4 then '온라인교육 ' else convert(varchar,f.season)+' ' end) + g.edutest_name + '-' + l.detcodename   
                    else g.edutest_name end  edutest_name
			, a.code_operation
			, case when isnull(a.register,'') <![CDATA[<>]]> '' then 0 else 1 end paystate
			, a.code_pay_flag
			, a.code_certifi
			, a.bran_seq
			, a.receipt_dt
			, p.member person_yn
			, a.oper_name
			, a.oper_lic_no
<!-- 			JUMIN_DEL -->
<!-- 			, [dbo].[GetPersNoDecord](a.oper_no , '2') oper_no -->
<!-- 			, [dbo].[GetPersNoDecord](a.oper_no , '1') oper_no1 -->
			, oper_birth
			, a.oper_comp_name1 
			, a.oper_hp
			, a.oper_email
			, a.receipt_no
			, isnull( f.season,'') season
			, f.operation_cnt
			, c.attend_cnt
			, c.result_state
			, f.operation_place
			, case when a.code_email_comp = '01' then a.oper_email else rtrim(a.oper_email) + '@' + i.detcodename end operemail
			, j.detcodename payflag
			, a.oper_account
			, k.detcodename resultstate
			, a.oper_state
			, b.detcodename
			, e.start_dt
			, e.end_dt
	        , d.result_end_dt
			, isnull( p.code_pers, '') person_yn1
			, a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0')) as detcode
	     ,ROW_NUMBER()OVER(ORDER BY a.code_kind,a.code_certifi,a.code_seq,a.code_bran,a.bran_seq,a.receipt_no ) ncount
	   
from operater a 
	left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member
                  from Person_M_TBL w
                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn
     left join (select  x.code_kind, x.code_certifi, x.code_seq, x.code_bran, 
                        x.bran_seq, x.receipt_no, 
                        replace(replace(ISNULL(x.신청서,' ')
										+','
										+ISNULL(x.사진,' ')
										+','
                                       	+ISNULL(x.영양사면허증사본,' ')
										+','
										+ISNULL(x.경력증명서,' ')
										+','
                                       	+ISNULL(x.학위증명서,' ')
										+','
										+ISNULL(x.최종학위성적증명서,' ')
										+','
                                       	+ISNULL(x.기존자격증사본,' ')
										+','
										+ISNULL(x.발급회비,' ')
										,' ,',''),', ','') detcodename
                  from (           
                        select * from (
                                       select ab.code_kind, ab.code_certifi, ab.code_seq, ab.code_bran, 
                                              ab.bran_seq, ab.receipt_no, bb.detcodename
                                         from oper_add_file ab, com_code bb
                                        where bb.groupcode = '037' 
                                          and bb.detcode = ab.add_file_no     
                                       ) z
                        pivot (max(z.detcodename) for z.detcodename 
                           in ([신청서],[사진],[영양사면허증사본],[경력증명서],[학위증명서]
                              ,[최종학위성적증명서],[기존자격증사본],[발급회비])
                              ) as pvt
                        ) x
               ) b 
               on b.code_kind = a.code_kind 
              and b.code_certifi = a.code_certifi
              and b.code_seq = a.code_seq
              and b.code_bran = a.code_bran
              and b.bran_seq = a.bran_seq
              and b.receipt_no = a.receipt_no
     left join oper_result c 
               on c.code_kind = a.code_kind 
              and c.code_certifi = a.code_certifi
              and c.code_seq = a.code_seq
              and c.code_bran = a.code_bran
              and c.bran_seq = a.bran_seq
              and c.receipt_no = a.receipt_no
	left join (select z.code_pers,
                       x.code_certifi, max(x.result_end_dt) result_end_dt
                  from Person_M_TBL z, result_print x
                 where z.code_pers = x.code_pers
                 group by z.code_pers,
<!--                  JUMIN_DEL -->
<!--                  z.pers_no, -->
                 x.code_certifi
                ) d 
               on d.code_certifi = a.code_certifi
              and d.code_pers = a.person_yn
     left join delay_release e
               on e.code_kind = a.code_kind 
              and e.code_certifi = a.code_certifi
              and e.code_seq = a.code_seq
     left join com_code i
               on i.groupcode = '025'
              and i.detcode = a.code_email_comp
     left join com_code j
               on j.groupcode = '014'
              and j.detcode = a.code_pay_flag
     left join com_code k
               on k.groupcode = '023'
              and k.detcode = c.result_state
			  
   , edu_test f
     left join com_code l
       on l.groupcode = '034'
      and l.detcode = f.code_bran
     left join edu_test_name g
               on g.code_kind = f.code_kind
              and g.code_certifi = f.code_certifi
              and g.code_seq = f.code_seq
 where a.code_kind = f.code_kind
   and a.code_certifi = f.code_certifi
   and a.code_seq = f.code_seq
   and a.code_bran = f.code_bran
   and a.bran_seq = f.bran_seq 
   and a.code_kind in ('5')
   and isnull(p.code_pers, '') != ''
   <dynamic prepend="and">
		<isNotEmpty property="sel">
			<isEmpty property="oper_state1">
			a.oper_state NOT IN ('08','09')
			</isEmpty>  
			<isNotEmpty property="oper_state1">
			a.oper_state NOT IN ('08')
			</isNotEmpty>  
		</isNotEmpty>
   </dynamic>           
		/* 교육년도  */
	<dynamic prepend="and">
		<isNotEmpty property="yyyy1">
			f.yyyy = #yyyy1#
		</isNotEmpty>
	</dynamic>
	/* 교육주최  */
	<dynamic prepend="and">
		<isNotEmpty property="code_bran1">
			f.code_bran = #code_bran1#
		</isNotEmpty>
	</dynamic>
	/* 자격증구분  */
	<dynamic prepend="and">
		<isNotEmpty property="code_certifi1">
			a.code_certifi = #code_certifi1#
		</isNotEmpty>
	</dynamic>
	/* 학기구분  */
	<dynamic prepend="and">
		<isNotEmpty property="season1">
			f.season = #season1#
		</isNotEmpty>
	</dynamic> 
	/* 응시결과상태  */
	<dynamic prepend="and">
		<isNotEmpty property="result_state1">
			c.result_state = #result_state1#
		</isNotEmpty>
	</dynamic>
	/* 응시상태  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_state1">
			a.oper_state = #oper_state1#
		</isNotEmpty>
	</dynamic>
	<dynamic prepend="and">
		<isNotEmpty property="detcode">
			a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0'))=#detcode#
		</isNotEmpty>
	</dynamic>
        ) OUT
        WHERE 1=1
	</select>
	
	<!--시험별응시현황 출력  -->
	<select id="selectlicense" resultClass="java.util.HashMap">
    	select sout.*
	  from (
        select f.yyyy
			, f.code_bran
			, f.code_kind
			, f.code_seq
			, case when f.code_kind = '5' then convert(varchar,f.yyyy)+'년도 '+'제'+CONVERT(varchar,f.operation_cnt)+'회 ' + (case when f.season in (1,2) then convert(varchar,f.season)+'학기 ' when f.season = 3 then '집합교육 ' when f.season = 4 then '온라인교육 ' else convert(varchar,f.season)+' ' end) + g.edutest_name + '-' + l.detcodename   
                    else g.edutest_name end  edutest_name
			, a.code_operation
			, case when isnull(a.register,'') <![CDATA[<>]]> '' then 0 else 1 end paystate
			, a.code_pay_flag
			, a.code_certifi
			, a.bran_seq
			, a.receipt_dt
			, p.member person_yn
			, a.oper_name
			, a.oper_lic_no
<!-- 			JUMIN_DEL -->
<!-- 			, [dbo].[GetPersNoDecord](a.oper_no , '2') oper_no -->
<!-- 			, [dbo].[GetPersNoDecord](a.oper_no , '1') oper_no1 -->
			, oper_birth
			, a.oper_comp_name1 
			, a.oper_hp
			, a.oper_email
			, a.receipt_no
			, isnull( f.season,'') season
			, f.operation_cnt
			, c.attend_cnt
			, c.result_state
			, f.operation_place
			, case when a.code_email_comp = '01' then a.oper_email else rtrim(a.oper_email) + '@' + i.detcodename end operemail
			, j.detcodename payflag
			, a.oper_account
			, k.detcodename resultstate
			, a.oper_state
			, b.detcodename
			, e.start_dt
			, e.end_dt
	        , d.result_end_dt
			, isnull( p.code_pers, '') person_yn1
			, xx.detcodename operstate
			, a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0')) as detcode
	     ,ROW_NUMBER()OVER(ORDER BY a.code_kind,a.code_certifi,a.code_seq,a.code_bran,a.bran_seq,a.receipt_no ) ncount
	     , xx2.detcodename codeoperation
	   
from operater a 
	left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member
                  from Person_M_TBL w
                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn
     left join (select  x.code_kind, x.code_certifi, x.code_seq, x.code_bran, 
                        x.bran_seq, x.receipt_no, 
                        replace(replace(ISNULL(x.신청서,' ')
										+','
										+ISNULL(x.사진,' ')
										+','
                                       	+ISNULL(x.영양사면허증사본,' ')
										+','
										+ISNULL(x.경력증명서,' ')
										+','
                                       	+ISNULL(x.학위증명서,' ')
										+','
										+ISNULL(x.최종학위성적증명서,' ')
										+','
                                       	+ISNULL(x.기존자격증사본,' ')
										+','
										+ISNULL(x.발급회비,' ')
										,' ,',''),', ','') detcodename
                  from (           
                        select * from (
                                       select ab.code_kind, ab.code_certifi, ab.code_seq, ab.code_bran, 
                                              ab.bran_seq, ab.receipt_no, bb.detcodename
                                         from oper_add_file ab, com_code bb
                                        where bb.groupcode = '037' 
                                          and bb.detcode = ab.add_file_no     
                                       ) z
                        pivot (max(z.detcodename) for z.detcodename 
                           in ([신청서],[사진],[영양사면허증사본],[경력증명서],[학위증명서]
                              ,[최종학위성적증명서],[기존자격증사본],[발급회비])
                              ) as pvt
                        ) x
               ) b 
               on b.code_kind = a.code_kind 
              and b.code_certifi = a.code_certifi
              and b.code_seq = a.code_seq
              and b.code_bran = a.code_bran
              and b.bran_seq = a.bran_seq
              and b.receipt_no = a.receipt_no
     left join oper_result c 
               on c.code_kind = a.code_kind 
              and c.code_certifi = a.code_certifi
              and c.code_seq = a.code_seq
              and c.code_bran = a.code_bran
              and c.bran_seq = a.bran_seq
              and c.receipt_no = a.receipt_no
	left join (select z.code_pers,
                       x.code_certifi, max(x.result_end_dt) result_end_dt
                  from Person_M_TBL z, result_print x
                 where z.code_pers = x.code_pers
                 group by z.code_pers,
<!--                  JUMIN_DEL -->
<!--                  z.pers_no, -->
                 x.code_certifi
                ) d 
               on d.code_certifi = a.code_certifi
              and d.code_pers = a.person_yn
     left join delay_release e
               on e.code_kind = a.code_kind 
              and e.code_certifi = a.code_certifi
              and e.code_seq = a.code_seq
     left join com_code i
               on i.groupcode = '025'
              and i.detcode = a.code_email_comp
     left join com_code j
               on j.groupcode = '014'
              and j.detcode = a.code_pay_flag
     left join com_code k
               on k.groupcode = '023'
              and k.detcode = c.result_state
     left join com_code xx
               on xx.groupcode='022'
              and xx.detcode=a.oper_state
     left join com_code xx2
               on xx2.groupcode='035'
              and xx2.detcode=a.code_operation
			  
   , edu_test f
     left join com_code l
       on l.groupcode = '034'
      and l.detcode = f.code_bran
     left join edu_test_name g
               on g.code_kind = f.code_kind
              and g.code_certifi = f.code_certifi
              and g.code_seq = f.code_seq
 where a.code_kind = f.code_kind
   and a.code_certifi = f.code_certifi
   and a.code_seq = f.code_seq
   and a.code_bran = f.code_bran
   and a.bran_seq = f.bran_seq 
   and a.code_kind in ('5')
   and isnull(p.code_pers, '') != '' 
   <dynamic prepend="and">
		<isNotEmpty property="sel">
			<isEmpty property="oper_state1">
			a.oper_state NOT IN ('08','09')
			</isEmpty>  
			<isNotEmpty property="oper_state1">
			a.oper_state NOT IN ('08')
			</isNotEmpty>  
		</isNotEmpty>
   </dynamic>           
		/* 교육년도  */
	<dynamic prepend="and">
		<isNotEmpty property="yyyy1">
			f.yyyy = #yyyy1#
		</isNotEmpty>
	</dynamic>
	/* 교육주최  */
	<dynamic prepend="and">
		<isNotEmpty property="code_bran1">
			f.code_bran = #code_bran1#
		</isNotEmpty>
	</dynamic>
	/* 자격증구분  */
	<dynamic prepend="and">
		<isNotEmpty property="code_certifi1">
			a.code_certifi = #code_certifi1#
		</isNotEmpty>
	</dynamic>
	/* 학기구분  */
	<dynamic prepend="and">
		<isNotEmpty property="season1">
			f.season = #season1#
		</isNotEmpty>
	</dynamic>
	/* 응시결과상태  */
	<dynamic prepend="and">
		<isNotEmpty property="result_state1">
			c.result_state = #result_state1#
		</isNotEmpty>
	</dynamic>
	/* 응시상태  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_state1">
			a.oper_state = #oper_state1#
		</isNotEmpty>
	</dynamic>
	<dynamic prepend="and">
		<isNotEmpty property="detcode">
			a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0'))=#detcode#
		</isNotEmpty>
	</dynamic>
	)sout
	where sout.ncount > #nstart# and sout.ncount <![CDATA[<=]]> #nend#
	order by sout.yyyy desc , sout.code_kind  , sout.code_certifi,  sout.code_seq desc , sout.code_bran, sout.bran_seq desc, isnull(sout.operation_cnt,'0') desc , sout.season desc , sout.oper_name
	</select>
	
	
	<!--시험별응시현황 쪽지,문자출력  -->
	<select id="selectlicenseA" resultClass="java.util.HashMap">
    	select sout.*
	  from (
        select f.yyyy
			, f.code_bran
			, f.code_kind
			, f.code_seq
			, case when f.code_kind = '5' then convert(varchar,f.yyyy)+'년도 '+'제'+CONVERT(varchar,f.operation_cnt)+'회 ' + (case when f.season in (1,2) then convert(varchar,f.season)+'학기 ' when f.season = 3 then '집합교육 ' when f.season = 4 then '온라인교육 ' else convert(varchar,f.season)+' ' end) + g.edutest_name + '-' + l.detcodename  
                    else g.edutest_name end  edutest_name
			, a.code_operation
			, case when isnull(a.register,'') <![CDATA[<>]]> '' then 0 else 1 end paystate
			, a.code_pay_flag
			, a.code_certifi
			, a.bran_seq
			, a.receipt_dt
			, p.member person_yn
			, a.oper_name
			, a.oper_lic_no
			, [dbo].[GetPersNoDecord](a.oper_no , '2') oper_no
			, [dbo].[GetPersNoDecord](a.oper_no , '1') oper_no1
			, a.oper_comp_name1 
			, a.oper_hp
			, a.oper_email
			, a.receipt_no
			, isnull( f.season,'') season
			, f.operation_cnt
			, c.attend_cnt
			, c.result_state
			, f.operation_place
			, case when a.code_email_comp = '01' then a.oper_email else rtrim(a.oper_email) + '@' + i.detcodename end operemail
			, j.detcodename payflag
			, a.oper_account
			, k.detcodename resultstate
			, a.oper_state
			, b.detcodename
			, e.start_dt
			, e.end_dt
	        , d.result_end_dt
			, isnull( p.code_pers, '') person_yn1
			, a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0')) as detcode
	     ,ROW_NUMBER()OVER(ORDER BY a.code_kind,a.code_certifi,a.code_seq,a.code_bran,a.bran_seq,a.receipt_no ) ncount
	   
from operater a 
	left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member
                  from Person_M_TBL w
                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn
     left join (select  x.code_kind, x.code_certifi, x.code_seq, x.code_bran, 
                        x.bran_seq, x.receipt_no, 
                        replace(replace(ISNULL(x.신청서,' ')
										+','
										+ISNULL(x.사진,' ')
										+','
                                       	+ISNULL(x.영양사면허증사본,' ')
										+','
										+ISNULL(x.경력증명서,' ')
										+','
                                       	+ISNULL(x.학위증명서,' ')
										+','
										+ISNULL(x.최종학위성적증명서,' ')
										+','
                                       	+ISNULL(x.기존자격증사본,' ')
										+','
										+ISNULL(x.발급회비,' ')
										,' ,',''),', ','') detcodename
                  from (           
                        select * from (
                                       select ab.code_kind, ab.code_certifi, ab.code_seq, ab.code_bran, 
                                              ab.bran_seq, ab.receipt_no, bb.detcodename
                                         from oper_add_file ab, com_code bb
                                        where bb.groupcode = '037' 
                                          and bb.detcode = ab.add_file_no     
                                       ) z
                        pivot (max(z.detcodename) for z.detcodename 
                           in ([신청서],[사진],[영양사면허증사본],[경력증명서],[학위증명서]
                              ,[최종학위성적증명서],[기존자격증사본],[발급회비])
                              ) as pvt
                        ) x
               ) b 
               on b.code_kind = a.code_kind 
              and b.code_certifi = a.code_certifi
              and b.code_seq = a.code_seq
              and b.code_bran = a.code_bran
              and b.bran_seq = a.bran_seq
              and b.receipt_no = a.receipt_no
     left join oper_result c 
               on c.code_kind = a.code_kind 
              and c.code_certifi = a.code_certifi
              and c.code_seq = a.code_seq
              and c.code_bran = a.code_bran
              and c.bran_seq = a.bran_seq
              and c.receipt_no = a.receipt_no
	left join (select z.code_pers,
                       x.code_certifi, max(x.result_end_dt) result_end_dt
                  from Person_M_TBL z, result_print x
                 where z.code_pers = x.code_pers
                 group by z.code_pers, z.pers_no, x.code_certifi
                ) d 
               on d.code_certifi = a.code_certifi
              and d.code_pers = a.person_yn
     left join delay_release e
               on e.code_kind = a.code_kind 
              and e.code_certifi = a.code_certifi
              and e.code_seq = a.code_seq
     left join com_code i
               on i.groupcode = '025'
              and i.detcode = a.code_email_comp
     left join com_code j
               on j.groupcode = '014'
              and j.detcode = a.code_pay_flag
     left join com_code k
               on k.groupcode = '023'
              and k.detcode = c.result_state
			  
   , edu_test f
     left join com_code l
       on l.groupcode = '034'
      and l.detcode = f.code_bran
     left join edu_test_name g
               on g.code_kind = f.code_kind
              and g.code_certifi = f.code_certifi
              and g.code_seq = f.code_seq
 where a.code_kind = f.code_kind
   and a.code_certifi = f.code_certifi
   and a.code_seq = f.code_seq
   and a.code_bran = f.code_bran
   and a.bran_seq = f.bran_seq 
   and a.code_kind in ('5')
   and isnull(p.code_pers, '') != ''           
		/* 교육년도  */
	<dynamic prepend="and">
		<isNotEmpty property="yyyy1">
			f.yyyy = #yyyy1#
		</isNotEmpty>
	</dynamic>
	/* 교육주최  */
	<dynamic prepend="and">
		<isNotEmpty property="code_bran1">
			f.code_bran = #code_bran1#
		</isNotEmpty>
	</dynamic>
	/* 자격증구분  */
	<dynamic prepend="and">
		<isNotEmpty property="code_certifi1">
			a.code_certifi = #code_certifi1#
		</isNotEmpty>
	</dynamic>
	/* 학기구분  */
	<dynamic prepend="and">
		<isNotEmpty property="season1">
			f.season = #season1#
		</isNotEmpty>
	</dynamic>
	/* 응시결과상태  */
	<dynamic prepend="and">
		<isNotEmpty property="result_state1">
			c.result_state = #result_state1#
		</isNotEmpty>
	</dynamic>
	/* 응시상태  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_state1">
			a.oper_state = #oper_state1#
		</isNotEmpty>
	</dynamic>
	<dynamic prepend="and">
		<isNotEmpty property="detcode">
			a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0'))=#detcode#
		</isNotEmpty>
	</dynamic>
	)sout
	where sout.ncount > #nstart# and sout.ncount <![CDATA[<=]]> #nend#
	</select>
	
	<!-- 시험별응시현황 엑셀 다운용 select -->
    <select id="conditionExcel" resultClass="java.util.HashMap">
 	select  ' ' upYN
 	 , case when f.code_kind = '5' then convert(varchar,f.yyyy)+'년도 '+'제'+CONVERT(varchar,f.operation_cnt)+'회 ' + (case when f.season in (1,2) then convert(varchar,f.season)+'학기 ' when f.season = 3 then '집합교육 ' when f.season = 4 then '온라인교육 ' else convert(varchar,f.season)+' ' end) + g.edutest_name + '-' + cb.detcodename   
		        else g.edutest_name + ' (' + cb.detcodename + ')' end  edutest_name
     , ISNULL(a.oper_name, '') oper_name
     , ISNULL(a.oper_lic_no, '') oper_lic_no
<!--      JUMIN_DEL -->
<!--      ,case when #check# = '1'  -->
<!-- 							  then [dbo].[GetPersNoDecord](a.oper_no , '1') -->
<!-- 					      when #check# = '2'  -->
<!-- 							  then [dbo].[GetPersNoDecord](a.oper_no , '2')   -->
<!-- 						  when #check# = '3' -->
<!-- 						      then [dbo].[GetPersNoDecord](a.oper_no , '3') -->
<!-- 						  else [dbo].[GetPersNoDecord](a.oper_no , '3') end oper_no   /*주민등록번호 */ -->
     , ISNULL(a.oper_birth, '') oper_birth
     , ISNULL(a.oper_hp, '') oper_hp
<!--      , case when isnull(a.code_email_comp,'') = '01' then isnull(a.oper_email,' ') else isnull(rtrim(a.oper_email) + '@' + i.detcodename,' ') end operemail -->
     , case when charindex('@', a.oper_email, 1) > 0 then isnull(a.oper_email,'')
			when charindex('@', a.oper_email, 1) = 0 and isnull(a.oper_email,'') = '' then ' '
			when charindex('@', a.oper_email, 1) = 0 and i.detcodename = '직접입력' then ' '
			else isnull(rtrim(isnull(a.oper_email,'')) + '@' + i.detcodename,' ') end operemail
     , ISNULL(f.yyyy, '') yyyy
	 , ISNULL(f.season, '') season
	 , ISNULL(f.operation_cnt, '') operation_cnt
	 , ISNULL(cb.detcodename, '') code_bran
     , ISNULL(cc.detcodename,'') code_kind
     , ISNULL(cd.certifi_name,'') code_certifi
     , ISNULL(p.member,' ') person_yn
     , ISNULL(k.detcodename,' ') result_state  /*결과 진행상태*/
     , ISNULL(ce.detcodename,' ') oper_state /*응시자진행상태*/
     , ISNULL(ca.detcodename,'') code_operation /*대상자*/
     , ISNULL(c.attend_cnt,'') attend_cnt /*출석*/
     , ISNULL(f.operation_place,' ') operation_place /*시행장소*/
     , ISNULL(a.oper_comp_name1,' ') oper_comp_name1 /*근무처*/
     , ISNULL(a.receipt_no,'') receipt_no   /*접수번호*/
     , ISNULL(c.result_no, '') result_no  /*발급번호*/ 
     , ISNULL(f.code_seq, '') code_seq
     , ISNULL(a.bran_seq, '') bran_seq
     , isnull(a.refund_bank,'없음') refund_bank
 	 , isnull(a.refund_account,'없음') refund_account
 	 , isnull(a.refund_account_owner,'없음') refund_account_owner
     , f.code_kind
		+f.code_certifi
		+f.code_seq
		+f.code_bran
		+f.bran_seq
		+convert(varchar,isnull(f.operation_cnt,'0'))
		+convert(varchar,isnull(f.season,'0'))  detcode
from operater a 
     left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member
                  from Person_M_TBL w
                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn
     left join com_code ca
               on ca.groupcode = '035'
              and ca.detcode = a.code_operation
     left join certifi cd
               on cd.code_certifi = a.code_certifi
     left join com_code ce
               on ce.groupcode = '022'
              and ce.detcode = a.oper_state
     left join (select  x.code_kind
					  , x.code_certifi
					  , x.code_seq
					  , x.code_bran
					  , x.bran_seq
					  , x.receipt_no
					  , replace(replace(ISNULL(x.신청서,' ')
										+','
										+ISNULL(x.사진,' ')
										+','
                                       	+ISNULL(x.영양사면허증사본,' ')
										+','
										+ISNULL(x.경력증명서,' ')
										+','
                                       	+ISNULL(x.학위증명서,' ')
										+','
										+ISNULL(x.최종학위성적증명서,' ')
										+','
                                       	+ISNULL(x.기존자격증사본,' ')
										+','
										+ISNULL(x.발급회비,' ')
										,' ,',''),', ','') detcodename
                  from (           
                        select * from (
                                       select ab.code_kind
											, ab.code_certifi
											, ab.code_seq
											, ab.code_bran
											, ab.bran_seq
                                            , ab.receipt_no
                                            , bb.detcodename
                                         from oper_add_file ab
											, com_code bb
                                        where bb.groupcode = '037' 
                                          and bb.detcode = ab.add_file_no     
                                       ) z
                        pivot (max(z.detcodename) for z.detcodename 
                           in ([신청서],[사진],[영양사면허증사본],[경력증명서],[학위증명서]
                              ,[최종학위성적증명서],[기존자격증사본],[발급회비])
                              ) as pvt
                        ) x
               ) b 
               on b.code_kind = a.code_kind 
              and b.code_certifi = a.code_certifi
              and b.code_seq = a.code_seq
              and b.code_bran = a.code_bran
              and b.bran_seq = a.bran_seq
              and b.receipt_no = a.receipt_no
     left join oper_result c 
               on c.code_kind = a.code_kind 
              and c.code_certifi = a.code_certifi
              and c.code_seq = a.code_seq
              and c.code_bran = a.code_bran
              and c.bran_seq = a.bran_seq
              and c.receipt_no = a.receipt_no
	left join (select z.code_pers,
                       x.code_certifi, max(x.result_end_dt) result_end_dt
                  from Person_M_TBL z, result_print x
                 where z.code_pers = x.code_pers
                 group by z.code_pers,
<!--                  JUMIN_DEL -->
<!--                  z.pers_no, -->
                 x.code_certifi
                ) d 
               on d.code_certifi = a.code_certifi
              and d.code_pers = a.person_yn
     left join com_code i
               on i.groupcode = '025'
              and i.detcode = a.code_email_comp
     left join com_code k
               on k.groupcode = '023'
              and k.detcode = c.result_state
     left join result_print j
               on j.result_no = c.result_no
               and j.code_certifi = c.code_certifi
     left join delay_release h
               on h.code_pers = j.code_pers                    
   , edu_test f
     left join edu_test_name g
               on g.code_kind = f.code_kind
              and g.code_certifi = f.code_certifi
              and g.code_seq = f.code_seq
     left join com_code cb
               on cb.groupcode = '034'
              and cb.detcode = f.code_bran
     left join com_code cc
               on cc.groupcode = '016'
              and cc.detcode = f.code_kind
 where a.code_kind = f.code_kind
   and a.code_certifi = f.code_certifi
   and a.code_seq = f.code_seq
   and a.code_bran = f.code_bran
   and a.bran_seq = f.bran_seq 
   and a.code_kind in ('5')
   and isnull(p.code_pers, '') != ''            
		/* 교육년도  */
   <dynamic prepend="and">
		<isNotEmpty property="sel">
			<isEmpty property="oper_state1">
			a.oper_state NOT IN ('08','09')
			</isEmpty>  
			<isNotEmpty property="oper_state1">
			a.oper_state NOT IN ('08')
			</isNotEmpty>  
		</isNotEmpty>
   </dynamic>           
	<dynamic prepend="and">
		<isNotEmpty property="yyyy1">
			f.yyyy = #yyyy1#
		</isNotEmpty>
	</dynamic>
	/* 교육주최  */
	<dynamic prepend="and">
		<isNotEmpty property="code_bran1">
			f.code_bran = #code_bran1#
		</isNotEmpty>
	</dynamic>
	/* 자격증구분  */
	<dynamic prepend="and">
		<isNotEmpty property="code_certifi1">
			a.code_certifi = #code_certifi1#
		</isNotEmpty>
	</dynamic>
	/* 학기구분  */
	<dynamic prepend="and">
		<isNotEmpty property="season1">
			f.season = #season1#
		</isNotEmpty>
	</dynamic>
	/* 응시결과상태  */
	<dynamic prepend="and">
		<isNotEmpty property="result_state1">
			c.result_state = #result_state1#
		</isNotEmpty>
	</dynamic>
	/* 응시상태  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_state1">
			a.oper_state = #oper_state1#
		</isNotEmpty>
	</dynamic>
	<dynamic prepend="and">
		<isNotEmpty property="detcode">
			a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0'))=#detcode#
		</isNotEmpty>
	</dynamic>
<!--   order by 25,22 -->
	order by f.yyyy desc , a.code_kind,  a.code_certifi,  a.code_seq desc , a.code_bran, a.bran_seq desc, isnull(f.operation_cnt,'0') desc , isnull(f.season,'') desc , a.oper_name

 </select>
	
	
	
	
	
	
	<!--자격증 결과등록 페이지 count -->
	<select id="resultsendcnt" resultClass="java.util.HashMap">
	
    SELECT count(*) cnt
        FROM (
        select f.yyyy, f.code_bran, f.code_kind, 
               case when f.code_kind = '5' then convert(varchar,f.yyyy)+'년도 '+'제'+CONVERT(varchar,f.operation_cnt)+'회 ' + (case when f.season in (1,2) then convert(varchar,f.season)+'학기 ' when f.season = 3 then '집합교육 ' when f.season = 4 then '온라인교육 ' else convert(varchar,f.season)+' ' end) + g.edutest_name + '-' + l.detcodename   
                    else g.edutest_name end  edutest_name,
               a.code_operation, case when isnull(a.register,'') <![CDATA[<>]]> '' then 0 else 1 end paystate,
               a.code_pay_flag, a.code_certifi,
<!--                g.finish_time,g.finish_date,g.finish_point, -->
               f.finish_time,f.finish_date,f.finish_point,
               c.time_cnt, 
       a.receipt_dt, p.member person_yn,
<!--        JUMIN_DEL -->
<!--        a.oper_name, a.oper_lic_no, [dbo].[GetPersNoDecord](a.oper_no , '2') oper_no, -->
		a.oper_birth,
       a.oper_comp_name1 , a.oper_hp, a.oper_email,
       case when a.code_email_comp = '01' then a.oper_email else rtrim(a.oper_email) + '@' + i.detcodename end operemail,
       j.detcodename payflag, a.oper_account, k.detcodename operstate, a.oper_state, b.detcodename, e.start_dt, e.end_dt 
	   , d.result_end_dt, a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0')) as detcode
	   
from operater a 
	left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member
                  from Person_M_TBL w
                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn
     left join (select  x.code_kind, x.code_certifi, x.code_seq, x.code_bran, 
                        x.bran_seq, x.receipt_no, 
                        replace(replace(ISNULL(x.신청서,' ')
										+','
										+ISNULL(x.사진,' ')
										+','
                                       	+ISNULL(x.영양사면허증사본,' ')
										+','
										+ISNULL(x.경력증명서,' ')
										+','
                                       	+ISNULL(x.학위증명서,' ')
										+','
										+ISNULL(x.최종학위성적증명서,' ')
										+','
                                       	+ISNULL(x.기존자격증사본,' ')
										+','
										+ISNULL(x.발급회비,' ')
										,' ,',''),', ','') detcodename
                  from (           
                        select * from (
                                       select ab.code_kind, ab.code_certifi, ab.code_seq, ab.code_bran, 
                                              ab.bran_seq, ab.receipt_no, bb.detcodename
                                         from oper_add_file ab, com_code bb
                                        where bb.groupcode = '037' 
                                          and bb.detcode = ab.add_file_no     
                                       ) z
                        pivot (max(z.detcodename) for z.detcodename 
                           in ([신청서],[사진],[영양사면허증사본],[경력증명서],[학위증명서]
                              ,[최종학위성적증명서],[기존자격증사본],[발급회비])
                              ) as pvt
                        ) x
               ) b 
               on b.code_kind = a.code_kind 
              and b.code_certifi = a.code_certifi
              and b.code_seq = a.code_seq
              and b.code_bran = a.code_bran
              and b.bran_seq = a.bran_seq
              and b.receipt_no = a.receipt_no
     left join oper_result c 
               on c.code_kind = a.code_kind 
              and c.code_certifi = a.code_certifi
              and c.code_seq = a.code_seq
              and c.code_bran = a.code_bran
              and c.bran_seq = a.bran_seq
              and c.receipt_no = a.receipt_no
	left join (select z.code_pers, 
                       x.code_certifi, max(x.result_end_dt) result_end_dt
                  from Person_M_TBL z, result_print x
                 where z.code_pers = x.code_pers
                 group by z.code_pers,
<!--                  z.pers_no, -->
                 x.code_certifi
                ) d 
               on d.code_certifi = a.code_certifi
              and d.code_pers = a.person_yn
     left join delay_release e
               on e.code_kind = a.code_kind 
              and e.code_certifi = a.code_certifi
              and e.code_seq = a.code_seq
     left join com_code i
               on i.groupcode = '025'
              and i.detcode = a.code_email_comp
     left join com_code j
               on j.groupcode = '014'
              and j.detcode = a.code_pay_flag
     left join com_code k
               on k.groupcode = '022'
              and k.detcode = a.oper_state
   , edu_test f
     left join com_code l
       on l.groupcode = '034'
      and l.detcode = f.code_bran
     left join edu_test_name g
               on g.code_kind = f.code_kind
              and g.code_certifi = f.code_certifi
              and g.code_seq = f.code_seq
 	where a.code_kind = f.code_kind
   			  and a.code_certifi = f.code_certifi
			  and a.code_seq = f.code_seq
			  and a.code_bran = f.code_bran
			  and a.bran_seq = f.bran_seq 
			   and a.code_kind in ('5')   
			   and isnull(p.code_pers, '') != '' 
    <dynamic prepend="and">
		<isNotEmpty property="sel">
			a.oper_state NOT IN ('08','09')  
		</isNotEmpty>
   </dynamic>        
		
	/* 교육년도  */
	<dynamic prepend="and">
		<isNotEmpty property="yyyy1">
			f.yyyy = #yyyy1#
		</isNotEmpty>
	</dynamic>
	/* 교육주최  */
	<dynamic prepend="and">
		<isNotEmpty property="code_bran1">
			f.code_bran = #code_bran1#
		</isNotEmpty>
	</dynamic>
	/* 자격증구분  */
	<dynamic prepend="and">
		<isNotEmpty property="code_certifi1">
			a.code_certifi = #code_certifi1#
		</isNotEmpty>
	</dynamic>
<!-- 	JUMIN_DEL  -->
<!-- 	/* 주민번호 동일 조건  */ -->
<!-- 	<dynamic prepend="and"> -->
<!-- 		<isNotEmpty property="oper_no1"> -->
<!-- 			[dbo].[GetPersNodecord](a.oper_no,'1') like #oper_no1#+'%' -->
<!-- 		</isNotEmpty> -->
<!-- 	</dynamic> -->
	/* 생년월일 동일 조건  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_birth1">
			a.oper_birth like #oper_birth1#+'%'
		</isNotEmpty>
	</dynamic>
	/* 이름 동일 조건  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_name1">
			a.oper_name like #oper_name1#+'%'
		</isNotEmpty>
	</dynamic>
	/* 학기   */
	<dynamic prepend="and">
		<isNotEmpty property="season1">
			f.season = #season1#
		</isNotEmpty>
	</dynamic>
	/* 시험명 동일 조건  */
	<dynamic prepend="and">
		<isNotEmpty property="edutest_name1">
			a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0')) = #edutest_name1#
		</isNotEmpty>
	</dynamic>
	<dynamic prepend="and">
		<isNotEmpty property="code_operation1">
			a.code_operation=#code_operation1#
		</isNotEmpty>
	</dynamic>
        ) OUT
        WHERE 1=1
	</select>		
		
	
	<!--자격증 결과등록 페이지출력, 엑셀저장-->
	<select id="selectresult" resultClass="java.util.HashMap">
		select sout.*
	  from (
        select ' ' upYN
		, isnull(f.yyyy,'') yyyy
		, isnull(f.code_bran, '') code_bran
		, isnull(f.code_kind, '') code_kind
		, isnull(f.code_seq, '') code_seq
		, case when f.code_kind = '5' then convert(varchar,f.yyyy)+'년도 '+'제'+CONVERT(varchar,f.operation_cnt)+'회 ' + (case when f.season in (1,2) then convert(varchar,f.season)+'학기 ' when f.season = 3 then '집합교육 ' when f.season = 4 then '온라인교육 ' else convert(varchar,f.season)+' ' end) + g.edutest_name + '-' + l.detcodename   
		            else g.edutest_name end  edutest_name
        , isnull(a.code_operation, '') code_operation
		, case when isnull(a.register,'') <![CDATA[<>]]> '' then 0 else 1 end paystate
		, ISNULL(a.code_pay_flag,'') code_pay_flag
        , isnull(a.code_certifi, '') code_certifi
        , isnull(a.bran_seq, '')  bran_seq
<!--         , isnull(g.finish_time, '') finish_time -->
<!--         , isnull(g.finish_date, '') finish_date -->
<!--         , isnull(g.finish_point, '') finish_point -->
        , isnull(f.finish_time, '') finish_time
        , isnull(f.finish_date, '') finish_date
        , isnull(f.finish_point, '') finish_point
        , ISNULL( c.time_cnt, '') time_cnt
        , isnull( a.receipt_dt, '') receipt_dt
        , ISNULL( p.member, '') person_yn
		, isnull( p.code_pers, '') person_yn1
        , isnull( a.oper_name, '') oper_name
        , isnull( a.oper_lic_no, '') oper_lic_no
        , c.receipt_no receipt_no1
<!--         JUMIN_DEL -->
<!--         ,case when #check# = '1'  then [dbo].[GetPersNoDecord](a.oper_no , '1') -->
<!-- 		      when #check# = '2'  then [dbo].[GetPersNoDecord](a.oper_no , '2')   -->
<!-- 			  when #check# = '3'  then [dbo].[GetPersNoDecord](a.oper_no , '3') -->
<!-- 			  else [dbo].[GetPersNoDecord](a.oper_no , '3') end oper_no -->
<!--         , [dbo].[GetPersNoDecord](a.oper_no , '1') oper_no1 -->
        , ISNULL( a.oper_birth, '') oper_birth
        , ISNULL( a.oper_comp_name1, '') oper_comp_name1
		, ISNULL( a.oper_comp_add1_1, '') oper_comp_add1_1
        , ISNULL( a.code_post, '') code_post 
        , isnull( a.oper_hp, '') oper_hp
        , ISNULL( a.oper_email, '') oper_email
        , isnull( a.receipt_no, '') receipt_no
        , isnull(f.season, '') season
        , isnull(f.operation_cnt, '') operation_cnt
        , isnull(c.attend_cnt, '') attend_cnt
        , isnull(c.result_state, '') result_state
        , isnull(f.operation_place, '') operation_place
        , isnull(g.print_kind, '') print_kind
        , isnull(c.result_point, '') result_point
<!--         , isnull(g.edu_marks, '') edu_marks -->
        , isnull(f.edu_marks, '') edu_marks
        , case when a.code_email_comp = '01' then a.oper_email else rtrim(a.oper_email)+ '@' + i.detcodename end operemail
        , ISNULL(j.detcodename, '') payflag
        , isnull(a.oper_account, '') oper_account
        , isnull(k.detcodename, '') resultstate
        , isnull(a.oper_state, '') oper_state
        , ISNULL(b.detcodename, '' ) detcodename
        , ISNULL(e.start_dt, '' ) start_dt
        , ISNULL(e.end_dt,'')end_dt
	    , ISNULL(d.result_end_dt, '')result_end_dt
 	   , a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0')) as detcode
	   ,ROW_NUMBER()OVER(ORDER BY a.code_kind
	   ,a.code_certifi
	   ,a.code_seq
	   ,a.code_bran
	   ,a.bran_seq
	   ,a.receipt_no ) ncount
	   
from operater a 
	left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member
                  from Person_M_TBL w
                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn
     left join (select  x.code_kind, x.code_certifi, x.code_seq, x.code_bran, 
                        x.bran_seq, x.receipt_no, 
                        replace(replace(ISNULL(x.신청서,' ')
										+','
										+ISNULL(x.사진,' ')
										+','
                                       	+ISNULL(x.영양사면허증사본,' ')
										+','
										+ISNULL(x.경력증명서,' ')
										+','
                                       	+ISNULL(x.학위증명서,' ')
										+','
										+ISNULL(x.최종학위성적증명서,' ')
										+','
                                       	+ISNULL(x.기존자격증사본,' ')
										+','
										+ISNULL(x.발급회비,' ')
										,' ,',''),', ','') detcodename
                  from (           
                        select * from (
                                       select ab.code_kind, ab.code_certifi, ab.code_seq, ab.code_bran, 
                                              ab.bran_seq, ab.receipt_no, bb.detcodename
                                         from oper_add_file ab, com_code bb
                                        where bb.groupcode = '037' 
                                          and bb.detcode = ab.add_file_no     
                                       ) z
                        pivot (max(z.detcodename) for z.detcodename 
                           in ([신청서],[사진],[영양사면허증사본],[경력증명서],[학위증명서]
                              ,[최종학위성적증명서],[기존자격증사본],[발급회비])
                              ) as pvt
                        ) x
               ) b 
               on b.code_kind = a.code_kind 
              and b.code_certifi = a.code_certifi
              and b.code_seq = a.code_seq
              and b.code_bran = a.code_bran
              and b.bran_seq = a.bran_seq
              and b.receipt_no = a.receipt_no
     left join oper_result c 
               on c.code_kind = a.code_kind 
              and c.code_certifi = a.code_certifi
              and c.code_seq = a.code_seq
              and c.code_bran = a.code_bran
              and c.bran_seq = a.bran_seq
              and c.receipt_no = a.receipt_no
	left join (select z.code_pers, 
                       x.code_certifi, max(x.result_end_dt) result_end_dt
                  from Person_M_TBL z, result_print x
                 where z.code_pers = x.code_pers
                 group by z.code_pers,
<!--                  JUMIN_DEL -->
<!--                  z.pers_no, -->
                 x.code_certifi
                ) d 
               on d.code_certifi = a.code_certifi
              and d.code_pers = a.person_yn
     left join delay_release e
               on e.code_kind = a.code_kind 
              and e.code_certifi = a.code_certifi
              and e.code_seq = a.code_seq
     left join com_code i
               on i.groupcode = '025'
              and i.detcode = a.code_email_comp
     left join com_code j
               on j.groupcode = '014'
              and j.detcode = a.code_pay_flag
     left join com_code k
               on k.groupcode = '023'
              and k.detcode = c.result_state
   , edu_test f
     left join com_code l
       on l.groupcode = '034'
      and l.detcode = f.code_bran
     left join edu_test_name g
               on g.code_kind = f.code_kind
              and g.code_certifi = f.code_certifi
              and g.code_seq = f.code_seq
 where a.code_kind = f.code_kind
   and a.code_certifi = f.code_certifi
   and a.code_seq = f.code_seq
   and a.code_bran = f.code_bran
   and a.bran_seq = f.bran_seq     
    and a.code_kind in ('5')    
	and isnull(p.code_pers, '') != ''
	<dynamic prepend="and">
		<isNotEmpty property="sel">
			a.oper_state NOT IN ('08','09')  
		</isNotEmpty>
   </dynamic>     
		/* 교육년도  */
	<dynamic prepend="and">
		<isNotEmpty property="yyyy1">
			f.yyyy = #yyyy1#
		</isNotEmpty>
	</dynamic>
	/* 교육주최  */
	<dynamic prepend="and">
		<isNotEmpty property="code_bran1">
			f.code_bran = #code_bran1#
		</isNotEmpty>
	</dynamic>
	/* 자격증구분  */
	<dynamic prepend="and">
		<isNotEmpty property="code_certifi1">
			a.code_certifi = #code_certifi1#
		</isNotEmpty>
	</dynamic>
<!-- 	JUMIN_DEL -->
<!-- 	/* 주민번호 동일 조건  */ -->
<!-- 	<dynamic prepend="and"> -->
<!-- 		<isNotEmpty property="oper_no1"> -->
<!-- 			[dbo].[GetPersNodecord](a.oper_no,'1') like #oper_no1#+'%' -->
<!-- 		</isNotEmpty> -->
<!-- 	</dynamic> -->
	/* 생년월일 동일 조건  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_birth1">
			a.oper_birth like #oper_birth1#+'%'
		</isNotEmpty>
	</dynamic>
	/* 이름 동일 조건  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_name1">
			a.oper_name like #oper_name1#+'%'
		</isNotEmpty>
	</dynamic>
	/* 학기   */
	<dynamic prepend="and">
		<isNotEmpty property="season1">
			f.season = #season1#
		</isNotEmpty>
	</dynamic>
	/* 시험명 동일 조건  */
	<dynamic prepend="and">
		<isNotEmpty property="edutest_name1">
			a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0')) = #edutest_name1#
		</isNotEmpty>
	</dynamic>
	<dynamic prepend="and">
		<isNotEmpty property="code_operation1">
			a.code_operation=#code_operation1#
		</isNotEmpty>
	</dynamic>
	)sout
	where sout.ncount > #nstart# and sout.ncount <![CDATA[<=]]> #nend#
	</select>	
	
	
	<!-- 결과등록 update -->
	<update id="updateresult" parameterClass="java.util.HashMap">
		UPDATE oper_result
		   SET 
		      attend_cnt 		= #attend_cnt1#     
			  ,time_cnt 		= #time_cnt1#
		      ,result_point 	= #result_point1#   
		      ,edu_marks		= #edu_marks1#
		      ,result_state 	= #result_state1#
		      ,up_date 			= getdate()      
			  ,updater 			= #g_name#      
		where code_kind 	= #code_kind1# 
		  and code_certifi  = #code_certifi1# 
		  and code_seq 		= #code_seq1# 
		  and code_bran 	= #code_bran1# 
		  and bran_seq 		= #bran_seq1#  
		  and receipt_no	= #receipt_no1#
	</update>

	
	<!-- 결과등록를 위한 합격관리룰 가져오기  select -->
    <select id="selectexampoint1" resultClass="java.util.HashMap">
<!-- 		select -->
<!-- 				isnull(f.edu_marks,0) edu_marks, -->
<!-- 		       isnull(f.service_marks,0) service_marks, -->
<!-- 		       isnull(f.finish_time,0) finish_time, -->
<!-- 		       isnull(f.finish_date,0) finish_date,  -->
<!-- 		       isnull(f.finish_point,0) finish_point -->
<!-- from edu_test_name f  -->
<!--  where f.code_kind+f.code_certifi+f.code_seq = substring(#detcode1#,1,5) -->
 
		select
				isnull(f.edu_marks,0) edu_marks,
		       isnull(f.service_marks,0) service_marks,
		       isnull(f.finish_time,0) finish_time,
		       isnull(f.finish_date,0) finish_date, 
		       isnull(f.finish_point,0) finish_point
from edu_test f 
 where f.code_kind+f.code_certifi+f.code_seq+f.code_bran+f.bran_seq+convert(varchar,isnull(f.operation_cnt,'0'))+convert(varchar,isnull(f.season,'0')) = #detcode1#
		</select>
		
	<!--자격증 심사 페이지 count -->
	<select id="inspectionsendcnt" resultClass="java.util.HashMap">
	
    SELECT count(*) cnt
        FROM (
        select distinct 
			 ISNULL(a.code_operation, '' ) code_operation
			, ISNULL(l.certifi_name , '' ) codecertifi
			, ISNULL(m.detcodename, '' ) codeoperation
			, ISNULL(a.code_certifi, '') code_certifi
			, ISNULL(p.member,'') person_yn
			, ISNULL(a.oper_name, '')oper_name
			, ISNULL(a.oper_lic_no , '') oper_lic_no
<!-- 			JUMIN_DEL -->
<!-- 			, case when #check# = '1'  then [dbo].[GetPersNoDecord](a.oper_no , '1') -->
<!-- 		      when #check# = '2'  then [dbo].[GetPersNoDecord](a.oper_no , '2')   -->
<!-- 			  when #check# = '3'  then [dbo].[GetPersNoDecord](a.oper_no , '3') -->
<!-- 			  else [dbo].[GetPersNoDecord](a.oper_no , '3') end oper_no -->
<!-- 			, [dbo].[GetPersNoDecord](a.oper_no , '1') oper_no1 -->
			, ISNULL(a.oper_birth,'') oper_birth 
			, ISNULL(a.oper_comp_name1,'') oper_comp_name1 
			, ISNULL(a.oper_hp, '') oper_hp
			, seasonA
			, seasonB
			, isnull( p.code_pers, '') person_yn1
			, case when a.code_email_comp = '01' or ISNULL(a.code_email_comp,'') = '' then a.oper_email else rtrim(a.oper_email) + '@' + isnull(i.detcodename,'') end operemail
			, ISNULL(k.detcodename, '') operstate
			, ISNULL(a.oper_state, '') oper_state
			, ISNULL(replace(b.detcodename, ' ', ''),'') detcodename
	   		, ISNULL(d.result_end_dt , '') result_end_dt
			, aa.code_kind+aa.code_certifi+aa.code_seq+aa.code_bran+aa.bran_seq+convert(varchar,isnull(aa.season,'0')) as detcode
			, aa.code_kind
			, aa.code_bran
			, aa.code_seq
			, aa.bran_seq
			, aa.receipt_no
from operater a 
	left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member, w.pers_state
                  from Person_M_TBL w
                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn 
	left join (select z.code_pers, 
                       x.code_certifi, max(x.result_start_dt) result_start_dt, 
                       max(x.result_end_dt) result_end_dt, x.result_no
                  from Person_M_TBL z, result_print x
                 where z.code_pers = x.code_pers
                 group by z.code_pers,
<!--                  JUMIN_DEL -->
<!--                  z.pers_no, -->
                 x.code_certifi, x.result_no
                ) d 
               on d.code_certifi = a.code_certifi
              and d.code_pers = a.person_yn
     left join delay_release e
               on e.code_kind = a.code_kind 
              and e.code_certifi = a.code_certifi
              and e.code_seq = a.code_seq
     left join com_code i
               on i.groupcode = '025'
              and i.detcode = a.code_email_comp
     left join com_code j
               on j.groupcode = '014'
              and j.detcode = a.code_pay_flag
     left join com_code k
               on k.groupcode = '022'
              and k.detcode = a.oper_state
	left join com_code m
               on m.groupcode = '035'
              and m.detcode = a.code_operation
	left join certifi l
               on l.code_certifi = a.code_certifi
   , (
       select CODE_KIND, CODE_CERTIFI, CODE_SEQ, CODE_BRAN, BRAN_SEQ, PERSON_YN
            , MAX(receipt_no) receipt_no, MAX(season) season
            , MAX(seasonA) seasonA, MAX(result_pointA) result_pointA
            , MAX(seasonB) seasonB, MAX(result_pointB) result_pointB
         from (
			SELECT  distinct AA.CODE_KIND, AA.CODE_CERTIFI, AA.CODE_SEQ,
<!-- 					AA.CODE_BRAN, -->
				  case when aa.season in ('1','3') then AA.CODE_BRAN else  BB.CODE_BRAN end CODE_BRAN,
					aa.PERSON_YN, 
					case when aa.season in ('1','3') then aa.receipt_no when aa.season in ('2','4') then bb.receipt_no else  '' end receipt_no
				  , case when aa.season = '1' then '1' when aa.season = '2' then '2' when aa.season = '3' then '3' when aa.season = '4' then '4' else  '' end season
				  , case when aa.season in ('1','3') then AA.BRAN_SEQ else  BB.BRAN_SEQ end BRAN_SEQ
				  , case when aa.season in ('1','3') then aa.season when aa.season in ('2','4') then bb.season else '' end  seasonA
				  , case when aa.season in ('1','3') then aa.result_point when aa.season in ('2','4') then bb.result_point else '' end result_pointA
				  , case when aa.season in ('2','4') then aa.season when aa.season in ('1','3') then bb.season else '' end seasonB
				  , case when aa.season in ('2','4') then aa.result_point when aa.season in ('1','3') then bb.result_point else '' end result_pointB
			  FROM
			(SELECT a.CODE_KIND, a.CODE_CERTIFI, a.CODE_SEQ, a.CODE_BRAN, a.BRAN_SEQ, a.RECEIPT_NO, a.PERSON_YN
				  , C.YYYY, c.season, b.result_point, A.code_operation
			  FROM OPERATER A
				   LEFT JOIN OPER_RESULT B ON B.CODE_KIND = A.CODE_KIND
									   AND B.CODE_CERTIFI = A.CODE_CERTIFI
									   AND B.CODE_SEQ = A.CODE_SEQ
									   AND B.CODE_BRAN = A.CODE_BRAN
									   AND B.BRAN_SEQ = A.BRAN_SEQ
									   AND B.RECEIPT_NO = A.RECEIPT_NO
				   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
									   AND C.CODE_CERTIFI = A.CODE_CERTIFI
									   AND C.CODE_SEQ = A.CODE_SEQ
									   AND C.CODE_BRAN = A.CODE_BRAN
									   AND C.BRAN_SEQ = A.BRAN_SEQ
		WHERE A.CODE_KIND = '5'   
			/* 교육주최  */
			<dynamic prepend="and">
				<isNotEmpty property="code_bran1">
					a.code_bran = #code_bran1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
		  AND ISNULL(B.result_no,'') = ''
		  AND c.yyyy=#yyyy1#
		  ) AA,
			(SELECT a.CODE_KIND, a.CODE_CERTIFI, a.CODE_SEQ, a.CODE_BRAN, a.BRAN_SEQ, a.RECEIPT_NO, a.PERSON_YN
				  , C.YYYY, c.season, b.result_point, A.code_operation
			  FROM OPERATER A
				   LEFT JOIN OPER_RESULT B ON B.CODE_KIND = A.CODE_KIND
									   AND B.CODE_CERTIFI = A.CODE_CERTIFI
									   AND B.CODE_SEQ = A.CODE_SEQ
									   AND B.CODE_BRAN = A.CODE_BRAN
									   AND B.BRAN_SEQ = A.BRAN_SEQ
									   AND B.RECEIPT_NO = A.RECEIPT_NO
			   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
								   AND C.CODE_CERTIFI = A.CODE_CERTIFI
								   AND C.CODE_SEQ = A.CODE_SEQ
								   AND C.CODE_BRAN = A.CODE_BRAN
								   AND C.BRAN_SEQ = A.BRAN_SEQ
		WHERE A.CODE_KIND = '5'
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
		  ) BB
		WHERE AA.CODE_KIND = BB.CODE_KIND
		  AND AA.CODE_CERTIFI = BB.CODE_CERTIFI
		  AND AA.PERSON_YN = BB.PERSON_YN
		  and bb.yyyy between (aa.yyyy - 5) and aa.yyyy
		  and aa.season != bb.season
		  AND (Aa.code_operation IN ('3','4') or bb.code_operation IN ('3','4'))

	UNION ALL

			SELECT  distinct AA.CODE_KIND, AA.CODE_CERTIFI, AA.CODE_SEQ,
<!-- 					AA.CODE_BRAN, -->
				  case when aa.season in ('1','3') then AA.CODE_BRAN else  BB.CODE_BRAN end CODE_BRAN,
					aa.PERSON_YN, 
					case when aa.season in ('1','3') then aa.receipt_no when aa.season in ('2','4') then bb.receipt_no else  '' end receipt_no
				  , case when aa.season = '1' then '1' when aa.season = '2' then '2' when aa.season = '3' then '3' when aa.season = '4' then '4' else  '' end season
				  , case when aa.season in ('1','3') then AA.BRAN_SEQ else  BB.BRAN_SEQ end BRAN_SEQ
				  , case when aa.season in ('1','3') then aa.season when aa.season in ('2','4') then bb.season else '' end  seasonA
				  , case when aa.season in ('1','3') then aa.result_point when aa.season in ('2','4') then bb.result_point else '' end result_pointA
				  , case when aa.season in ('2','4') then aa.season when aa.season in ('1','3') then bb.season else '' end seasonB
				  , case when aa.season in ('2','4') then aa.result_point when aa.season in ('1','3') then bb.result_point else '' end result_pointB
			  FROM
			(SELECT a.CODE_KIND, a.CODE_CERTIFI, a.CODE_SEQ, a.CODE_BRAN, a.BRAN_SEQ, a.RECEIPT_NO, b.PERSON_YN
				  , C.YYYY, c.season, a.result_point, b.code_operation
			  FROM OPER_RESULT A
				   LEFT JOIN OPERATER B ON B.CODE_KIND = A.CODE_KIND
									   AND B.CODE_CERTIFI = A.CODE_CERTIFI
									   AND B.CODE_SEQ = A.CODE_SEQ
									   AND B.CODE_BRAN = A.CODE_BRAN
									   AND B.BRAN_SEQ = A.BRAN_SEQ
									   AND B.RECEIPT_NO = A.RECEIPT_NO
				   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
									   AND C.CODE_CERTIFI = A.CODE_CERTIFI
									   AND C.CODE_SEQ = A.CODE_SEQ
									   AND C.CODE_BRAN = A.CODE_BRAN
									   AND C.BRAN_SEQ = A.BRAN_SEQ
		WHERE A.CODE_KIND = '5'   
			/* 교육주최  */
			<dynamic prepend="and">
				<isNotEmpty property="code_bran1">
					a.code_bran = #code_bran1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
		  AND ISNULL(A.RESULT_NO,'') = ''
		  AND A.RESULT_STATE in ('10','12')
		  AND c.yyyy=#yyyy1#
		  ) AA,
			(SELECT a.CODE_KIND, a.CODE_CERTIFI, a.CODE_SEQ, a.CODE_BRAN, a.BRAN_SEQ, a.RECEIPT_NO, b.PERSON_YN
				  , C.YYYY, c.season, a.result_point, b.code_operation
			  FROM OPER_RESULT A
				   LEFT JOIN OPERATER B ON B.CODE_KIND = A.CODE_KIND
									   AND B.CODE_CERTIFI = A.CODE_CERTIFI
									   AND B.CODE_SEQ = A.CODE_SEQ
									   AND B.CODE_BRAN = A.CODE_BRAN
									   AND B.BRAN_SEQ = A.BRAN_SEQ
									   AND B.RECEIPT_NO = A.RECEIPT_NO
			   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
								   AND C.CODE_CERTIFI = A.CODE_CERTIFI
								   AND C.CODE_SEQ = A.CODE_SEQ
								   AND C.CODE_BRAN = A.CODE_BRAN
								   AND C.BRAN_SEQ = A.BRAN_SEQ
		WHERE A.CODE_KIND = '5'
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
		  AND ISNULL(A.RESULT_NO,'') = ''
		  AND A.RESULT_STATE in ('10','12')
		  ) BB
		WHERE AA.CODE_KIND = BB.CODE_KIND
		  AND AA.CODE_CERTIFI = BB.CODE_CERTIFI
		  AND AA.PERSON_YN = BB.PERSON_YN
		  and bb.yyyy between (aa.yyyy - 5) and aa.yyyy     
			  and aa.season != bb.season
			  AND (Aa.code_operation not IN ('3','4') and bb.code_operation not IN ('3','4'))
	     ) bb
	     group by CODE_KIND, CODE_CERTIFI, CODE_SEQ, CODE_BRAN, BRAN_SEQ, PERSON_YN
      ) aa
     left join (select  x.code_kind, x.code_certifi, x.code_seq, x.code_bran, 
                        x.bran_seq, x.receipt_no, 
                        replace(replace(ISNULL(x.신청서,' ')
									   +','+ISNULL(x.사진,' ')
									   +','+ISNULL(x.영양사면허증사본,' ')
									   +','+ISNULL(x.경력증명서,' ')
									   +','+ISNULL(x.학위증명서,' ')
									   +','+ISNULL(x.최종학위성적증명서,' ')
									   +','+ISNULL(x.기존자격증사본,' ')
									   +','+ISNULL(x.발급회비,' '),' ,',''),', ','') detcodename
                  from (           
                        select * from (
                                       select ab.code_kind, ab.code_certifi, ab.code_seq, ab.code_bran, 
                                              ab.bran_seq, ab.receipt_no, bb.detcodename
                                         from oper_add_file ab, com_code bb
                                        where bb.groupcode = '037' 
                                          and bb.detcode = ab.add_file_no     
                                       ) z
                        pivot (max(z.detcodename) for z.detcodename 
                           in ([신청서],[사진],[영양사면허증사본],[경력증명서],[학위증명서]
                              ,[최종학위성적증명서],[기존자격증사본],[발급회비])
                              ) as pvt
                        ) x
               ) b 
               on b.code_kind = aa.code_kind 
              and b.code_certifi = aa.code_certifi
              and b.code_seq = aa.code_seq
              and b.code_bran = aa.code_bran
              and b.bran_seq = aa.bran_seq
              and b.receipt_no = aa.receipt_no
 where a.code_kind = aa.code_kind
   and a.code_certifi = aa.code_certifi
   and a.code_seq = aa.code_seq
   and a.code_bran = aa.code_bran
   and a.bran_seq=aa.bran_seq
   and a.receipt_no = aa.receipt_no
   and a.code_kind in ('5')
   and isnull(p.code_pers, '') != ''
   and a.oper_state = '11'  
   and p.pers_state != '02'
	/* 자격증구분  */
	<dynamic prepend="and">
		<isNotEmpty property="code_certifi1">
			a.code_certifi = #code_certifi1#
		</isNotEmpty>
	</dynamic>
<!-- 	JUMIN_DEL -->
<!-- 	/* 주민번호 동일 조건  */ -->
<!-- 	<dynamic prepend="and"> -->
<!-- 		<isNotEmpty property="oper_no1"> -->
<!-- 			[dbo].[GetPersNodecord](a.oper_no,'1') like #oper_no1#+'%' -->
<!-- 		</isNotEmpty> -->
<!-- 	</dynamic> -->
	/* 생년월일 동일 조건  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_birth1">
			a.oper_birth like #oper_birth1#+'%'
		</isNotEmpty>
	</dynamic>
	/* 이름 동일 조건  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_name1">
			a.oper_name like '%'+#oper_name1#+'%'
		</isNotEmpty>
	</dynamic>
	/* 대상자  */
	 <dynamic prepend="and">
	 	<isNotEmpty property="code_operation1"> 
	 		a.code_operation =  #code_operation1#  
	 	</isNotEmpty>
	 </dynamic>
	 <dynamic prepend="and">
	 	<isNotEmpty property="code_operation2"> 
	 		a.code_operation IN ('7','8')  
	 	</isNotEmpty>
	 </dynamic>
	 /* 면허번호  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_lic_no1">
			a.oper_lic_no = #oper_lic_no1#
		</isNotEmpty>
	</dynamic>
        ) OUT
        WHERE 1=1
	</select>	
	
	
	<!--자격증 심사 페이지 출력 엑셀저장 쪽지,문자
	   	1. 자격증 심사 대상은  석사이상 말소자 인 경우는 교육에 관계없이 선심사를 한다.
	   	2. 자격증 교육 이수를 통한 자격증심사는 교육 1학기 2학기 모두 수료해야 대상이 된다.
	   	3. 조회 항목에 맞도록 화면 조정 필요
	-->
	<select id="selectlinspection" resultClass="java.util.HashMap">
	
    select sout.*
	  from ( select aa.*
           	      , ROW_NUMBER()OVER(ORDER BY aa.oper_name,aa.receipt_no,aa.detcode ) ncount
	         from (
        select distinct 
			 ISNULL(a.code_operation, '' ) code_operation
			, ISNULL(l.certifi_name , '' ) codecertifi
			, ISNULL(m.detcodename, '' ) codeoperation
			, ISNULL(a.code_certifi, '') code_certifi
			, ISNULL(p.member,'') person_yn
			, ISNULL(a.oper_name, '')oper_name
			, ISNULL(a.oper_lic_no , '') oper_lic_no
<!-- 			JUMIN_DEL -->
<!-- 			, case when #check# = '1'  then [dbo].[GetPersNoDecord](a.oper_no , '1') -->
<!-- 		      when #check# = '2'  then [dbo].[GetPersNoDecord](a.oper_no , '2')   -->
<!-- 			  when #check# = '3'  then [dbo].[GetPersNoDecord](a.oper_no , '3') -->
<!-- 			  else [dbo].[GetPersNoDecord](a.oper_no , '3') end oper_no -->
<!-- 			, [dbo].[GetPersNoDecord](a.oper_no , '1') oper_no1 -->
			, ISNULL(a.oper_birth , '') oper_birth
			, ISNULL(a.oper_comp_name1,'') oper_comp_name1 
			, ISNULL(a.oper_hp, '') oper_hp
			, result_pointA seasonA
			, result_pointB seasonB
			, isnull( p.code_pers, '') person_yn1
			, case when a.code_email_comp = '01' or ISNULL(a.code_email_comp,'') = '' then a.oper_email else rtrim(a.oper_email) + '@' + isnull(i.detcodename,'') end operemail
			, ISNULL(k.detcodename, '') operstate
			, ISNULL(a.oper_state, '') oper_state
			, ISNULL(replace(b.detcodename, ' ', ''),'') detcodename
	   		, ISNULL(d.result_end_dt , '') result_end_dt
			, aa.code_kind+aa.code_certifi+aa.code_seq+aa.code_bran+aa.bran_seq+convert(varchar,isnull(aa.season,'0')) as detcode
			, aa.code_kind
			, aa.code_bran
			, aa.code_seq
			, aa.bran_seq
			, aa.receipt_no
			, convert(varchar,isnull(aa.season,'0')) season
			
            ,aa.code_bran_other
            ,aa.bran_seq_other
            ,aa.receipt_no_other
            ,aa.code_operation_other
            
from operater a 
	left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member, w.pers_state
                  from Person_M_TBL w
                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn 
	left join (select z.code_pers, 
                       x.code_certifi, max(x.result_start_dt) result_start_dt, 
                       max(x.result_end_dt) result_end_dt, x.result_no
                  from Person_M_TBL z, result_print x
                 where z.code_pers = x.code_pers
                 group by z.code_pers,
<!--                  JUMIN_DEL -->
<!--                  z.pers_no, -->
                 x.code_certifi, x.result_no
                ) d 
               on d.code_certifi = a.code_certifi
              and d.code_pers = a.person_yn
     left join delay_release e
               on e.code_kind = a.code_kind 
              and e.code_certifi = a.code_certifi
              and e.code_seq = a.code_seq
     left join com_code i
               on i.groupcode = '025'
              and i.detcode = a.code_email_comp
     left join com_code j
               on j.groupcode = '014'
              and j.detcode = a.code_pay_flag
     left join com_code k
               on k.groupcode = '022'
              and k.detcode = a.oper_state
	left join com_code m
               on m.groupcode = '035'
              and m.detcode = a.code_operation
	left join certifi l
               on l.code_certifi = a.code_certifi
   , (
       select CODE_KIND, CODE_CERTIFI, CODE_SEQ, CODE_BRAN, BRAN_SEQ, PERSON_YN
            , MAX(receipt_no) receipt_no, MAX(season) season
            , MAX(seasonA) seasonA, MAX(result_pointA) result_pointA
            , MAX(seasonB) seasonB, MAX(result_pointB) result_pointB

            ,Max(CODE_BRAN_OTHER) CODE_BRAN_OTHER
            ,Max(BRAN_SEQ_OTHER) BRAN_SEQ_OTHER
            ,Max(receipt_no_OTHER) receipt_no_OTHER
            ,Max(code_operation_other) code_operation_other

         from (
			SELECT  distinct AA.CODE_KIND, AA.CODE_CERTIFI, AA.CODE_SEQ,
<!-- 					AA.CODE_BRAN, -->
				  case when aa.season in ('1','3') then AA.CODE_BRAN else  BB.CODE_BRAN end CODE_BRAN,
					aa.PERSON_YN, 
					case when aa.season in ('1','3') then aa.receipt_no when aa.season in ('2','4') then bb.receipt_no else  '' end receipt_no
				  , case when aa.season = '1' then '1' when aa.season = '2' then '2' when aa.season = '3' then '3' when aa.season = '4' then '4' else  '' end season
				  , case when aa.season in ('1','3') then AA.BRAN_SEQ else  BB.BRAN_SEQ end BRAN_SEQ
				  , case when aa.season in ('1','3') then aa.season when aa.season in ('2','4') then bb.season else '' end  seasonA
				  , case when aa.season in ('1','3') then aa.result_point when aa.season in ('2','4') then bb.result_point else '' end result_pointA
				  , case when aa.season in ('2','4') then aa.season when aa.season in ('1','3') then bb.season else '' end seasonB
				  , case when aa.season in ('2','4') then aa.result_point when aa.season in ('1','3') then bb.result_point else '' end result_pointB

				,CASE WHEN aa.season IN ( '2', '4' ) THEN AA.code_bran ELSE BB.code_bran END CODE_BRAN_OTHER
				,CASE WHEN aa.season IN ( '2', '4' ) THEN AA.bran_seq ELSE BB.bran_seq END BRAN_SEQ_OTHER
				,CASE WHEN aa.season IN ( '2', '4' ) THEN aa.receipt_no WHEN aa.season IN ( '1', '3' ) THEN bb.receipt_no ELSE '' END receipt_no_OTHER
				,CASE WHEN aa.season IN ( '2', '4' ) THEN AA.code_operation ELSE BB.code_operation END code_operation_other

			  FROM
			(SELECT a.CODE_KIND, a.CODE_CERTIFI, a.CODE_SEQ, a.CODE_BRAN, a.BRAN_SEQ, a.RECEIPT_NO, a.PERSON_YN
				  , C.YYYY, c.season, b.result_point, A.code_operation
			  FROM OPERATER A
				   LEFT JOIN OPER_RESULT B ON B.CODE_KIND = A.CODE_KIND
									   AND B.CODE_CERTIFI = A.CODE_CERTIFI
									   AND B.CODE_SEQ = A.CODE_SEQ
									   AND B.CODE_BRAN = A.CODE_BRAN
									   AND B.BRAN_SEQ = A.BRAN_SEQ
									   AND B.RECEIPT_NO = A.RECEIPT_NO
				   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
									   AND C.CODE_CERTIFI = A.CODE_CERTIFI
									   AND C.CODE_SEQ = A.CODE_SEQ
									   AND C.CODE_BRAN = A.CODE_BRAN
									   AND C.BRAN_SEQ = A.BRAN_SEQ
		WHERE A.CODE_KIND = '5'   
			/* 교육주최  */
			<dynamic prepend="and">
				<isNotEmpty property="code_bran1">
					a.code_bran = #code_bran1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
		  AND ISNULL(B.result_no,'') = ''
		  AND c.yyyy=#yyyy1#
		  ) AA,
			(SELECT a.CODE_KIND, a.CODE_CERTIFI, a.CODE_SEQ, a.CODE_BRAN, a.BRAN_SEQ, a.RECEIPT_NO, a.PERSON_YN
				  , C.YYYY, c.season, b.result_point, A.code_operation
			  FROM OPERATER A
				   LEFT JOIN OPER_RESULT B ON B.CODE_KIND = A.CODE_KIND
									   AND B.CODE_CERTIFI = A.CODE_CERTIFI
									   AND B.CODE_SEQ = A.CODE_SEQ
									   AND B.CODE_BRAN = A.CODE_BRAN
									   AND B.BRAN_SEQ = A.BRAN_SEQ
									   AND B.RECEIPT_NO = A.RECEIPT_NO
			   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
								   AND C.CODE_CERTIFI = A.CODE_CERTIFI
								   AND C.CODE_SEQ = A.CODE_SEQ
								   AND C.CODE_BRAN = A.CODE_BRAN
								   AND C.BRAN_SEQ = A.BRAN_SEQ
		WHERE A.CODE_KIND = '5'
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
		  ) BB
		WHERE AA.CODE_KIND = BB.CODE_KIND
		  AND AA.CODE_CERTIFI = BB.CODE_CERTIFI
		  AND AA.PERSON_YN = BB.PERSON_YN
		  and bb.yyyy between (aa.yyyy - 5) and aa.yyyy
		  and aa.season != bb.season
		  AND (Aa.code_operation IN ('3','4') or bb.code_operation IN ('3','4'))

	UNION ALL

			SELECT  distinct AA.CODE_KIND, AA.CODE_CERTIFI, AA.CODE_SEQ,
<!-- 					AA.CODE_BRAN, -->
				  case when aa.season in ('1','3') then AA.CODE_BRAN else  BB.CODE_BRAN end CODE_BRAN,
					aa.PERSON_YN, 
					case when aa.season in ('1','3') then aa.receipt_no when aa.season in ('2','4') then bb.receipt_no else  '' end receipt_no
				  , case when aa.season = '1' then '1' when aa.season = '2' then '2' when aa.season = '3' then '3' when aa.season = '4' then '4' else  '' end season
				  , case when aa.season in ('1','3') then AA.BRAN_SEQ else  BB.BRAN_SEQ end BRAN_SEQ
				  , case when aa.season in ('1','3') then aa.season when aa.season in ('2','4') then bb.season else '' end  seasonA
				  , case when aa.season in ('1','3') then aa.result_point when aa.season in ('2','4') then bb.result_point else '' end result_pointA
				  , case when aa.season in ('2','4') then aa.season when aa.season in ('1','3') then bb.season else '' end seasonB
				  , case when aa.season in ('2','4') then aa.result_point when aa.season in ('1','3') then bb.result_point else '' end result_pointB

				,CASE WHEN aa.season IN ( '2', '4' ) THEN AA.code_bran ELSE BB.code_bran END CODE_BRAN_OTHER
				,CASE WHEN aa.season IN ( '2', '4' ) THEN AA.bran_seq ELSE BB.bran_seq END BRAN_SEQ_OTHER
				,CASE WHEN aa.season IN ( '2', '4' ) THEN aa.receipt_no WHEN aa.season IN ( '1', '3' ) THEN bb.receipt_no ELSE '' END receipt_no_OTHER
				,CASE WHEN aa.season IN ( '2', '4' ) THEN AA.code_operation ELSE BB.code_operation END code_operation_other

			  FROM
			(SELECT a.CODE_KIND, a.CODE_CERTIFI, a.CODE_SEQ, a.CODE_BRAN, a.BRAN_SEQ, a.RECEIPT_NO, b.PERSON_YN
				  , C.YYYY, c.season, a.result_point, b.code_operation
			  FROM OPER_RESULT A
				   LEFT JOIN OPERATER B ON B.CODE_KIND = A.CODE_KIND
									   AND B.CODE_CERTIFI = A.CODE_CERTIFI
									   AND B.CODE_SEQ = A.CODE_SEQ
									   AND B.CODE_BRAN = A.CODE_BRAN
									   AND B.BRAN_SEQ = A.BRAN_SEQ
									   AND B.RECEIPT_NO = A.RECEIPT_NO
				   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
									   AND C.CODE_CERTIFI = A.CODE_CERTIFI
									   AND C.CODE_SEQ = A.CODE_SEQ
									   AND C.CODE_BRAN = A.CODE_BRAN
									   AND C.BRAN_SEQ = A.BRAN_SEQ
		WHERE A.CODE_KIND = '5'   
			/* 교육주최  */
			<dynamic prepend="and">
				<isNotEmpty property="code_bran1">
					a.code_bran = #code_bran1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
		  AND ISNULL(A.RESULT_NO,'') = ''
		  AND A.RESULT_STATE in ('10','12')
		  AND c.yyyy=#yyyy1#
		  ) AA,
			(SELECT a.CODE_KIND, a.CODE_CERTIFI, a.CODE_SEQ, a.CODE_BRAN, a.BRAN_SEQ, a.RECEIPT_NO, b.PERSON_YN
				  , C.YYYY, c.season, a.result_point, b.code_operation
			  FROM OPER_RESULT A
				   LEFT JOIN OPERATER B ON B.CODE_KIND = A.CODE_KIND
									   AND B.CODE_CERTIFI = A.CODE_CERTIFI
									   AND B.CODE_SEQ = A.CODE_SEQ
									   AND B.CODE_BRAN = A.CODE_BRAN
									   AND B.BRAN_SEQ = A.BRAN_SEQ
									   AND B.RECEIPT_NO = A.RECEIPT_NO
			   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
								   AND C.CODE_CERTIFI = A.CODE_CERTIFI
								   AND C.CODE_SEQ = A.CODE_SEQ
								   AND C.CODE_BRAN = A.CODE_BRAN
								   AND C.BRAN_SEQ = A.BRAN_SEQ
		WHERE A.CODE_KIND = '5'
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
		  AND ISNULL(A.RESULT_NO,'') = ''
		  AND A.RESULT_STATE in ('10','12')
		  ) BB
		WHERE AA.CODE_KIND = BB.CODE_KIND
		  AND AA.CODE_CERTIFI = BB.CODE_CERTIFI
		  AND AA.PERSON_YN = BB.PERSON_YN
		  and bb.yyyy between (aa.yyyy - 5) and aa.yyyy     
			  and aa.season != bb.season
			  AND (Aa.code_operation not IN ('3','4') and bb.code_operation not IN ('3','4'))
	     ) bb
	     group by CODE_KIND, CODE_CERTIFI, CODE_SEQ, CODE_BRAN, BRAN_SEQ, PERSON_YN
      ) aa
     left join (select  x.code_kind, x.code_certifi, x.code_seq, x.code_bran, 
                        x.bran_seq, x.receipt_no, 
                        replace(replace(ISNULL(x.신청서,' ')
                                +','+ISNULL(x.사진,' ')
                                +','+ISNULL(x.영양사면허증사본,' ')
                                +','+ISNULL(x.경력증명서,' ')
                                +','+ISNULL(x.학위증명서,' ')
                                +','+ISNULL(x.최종학위성적증명서,' ')
                                +','+ISNULL(x.기존자격증원본,' ')
                                +','+ISNULL(x.외국취득면허사본,' ')
                                +','+ISNULL(x.발급회비,' ')
                                +','+ISNULL(x.압축파일,' '),' ,',''),', ','') detcodename
                  from (           
                        select * from (
                                       select ab.code_kind, ab.code_certifi, ab.code_seq, ab.code_bran, 
                                              ab.bran_seq, ab.receipt_no, bb.detcodename
                                         from oper_add_file ab, com_code bb
                                        where bb.groupcode = '037' 
                                          and bb.detcode = ab.add_file_no     
                                       ) z
                        pivot (max(z.detcodename) for z.detcodename 
                           in ([신청서],[사진],[영양사면허증사본],[경력증명서],[학위증명서]
                              ,[최종학위성적증명서],[기존자격증원본],[외국취득면허사본],[발급회비],[압축파일])
                              ) as pvt
                        ) x
               ) b 
               on b.code_kind = aa.code_kind 
              and b.code_certifi = aa.code_certifi
              and b.code_seq = aa.code_seq
              and b.code_bran = aa.code_bran
              and b.bran_seq = aa.bran_seq
              and b.receipt_no = aa.receipt_no
 where a.code_kind = aa.code_kind
   and a.code_certifi = aa.code_certifi
   and a.code_seq = aa.code_seq
   and a.code_bran = aa.code_bran
   and a.bran_seq=aa.bran_seq
   and a.receipt_no = aa.receipt_no
   and a.code_kind in ('5')
   and isnull(p.code_pers, '') != ''
   and a.oper_state = '11'  
   and p.pers_state != '02'
	/* 자격증구분  */
	<dynamic prepend="and">
		<isNotEmpty property="code_certifi1">
			a.code_certifi = #code_certifi1#
		</isNotEmpty>
	</dynamic>
<!-- 	JUMIN_DEL -->
<!-- 	/* 주민번호 동일 조건  */ -->
<!-- 	<dynamic prepend="and"> -->
<!-- 		<isNotEmpty property="oper_no1"> -->
<!-- 			[dbo].[GetPersNodecord](a.oper_no,'1') like #oper_no1#+'%' -->
<!-- 		</isNotEmpty> -->
<!-- 	</dynamic> -->
	/* 생년월일 동일 조건  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_birth1">
			a.oper_birth like #oper_birth1#+'%'
		</isNotEmpty>
	</dynamic>
	/* 이름 동일 조건  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_name1">
			a.oper_name like '%'+#oper_name1#+'%'
		</isNotEmpty>
	</dynamic>
	/* 대상자  */
	 <dynamic prepend="and">
	 	<isNotEmpty property="code_operation1"> 
	 		a.code_operation =  #code_operation1#  
	 	</isNotEmpty>
	 </dynamic>
	 <dynamic prepend="and">
	 	<isNotEmpty property="code_operation2"> 
	 		a.code_operation IN ('7','8')  
	 	</isNotEmpty>
	 </dynamic>
	 /* 면허번호  */
	<dynamic prepend="and">
		<isNotEmpty property="oper_lic_no1">
			a.oper_lic_no = #oper_lic_no1#
		</isNotEmpty>
	</dynamic>
		) aa	
	 	)sout
	where sout.ncount > #nstart# and sout.ncount <![CDATA[<=]]> #nend#
	</select>	
	
	
	<!--자격증 발급 대상검색버튼 count -->
	<select id="issuesendcnt" resultClass="java.util.HashMap">
	
    SELECT count(*) cnt
        FROM (
					select upYN, code_kind, code_certifi, oper_name, person_yn1,
<!-- 							JUMIN_DEL -->
<!-- 							oper_no, -->
							oper_birth,
							oper_lic_no, result_no,
					       MAX(codecertifi) codecertifi,
					       MAX(result_start_dt) result_start_dt,
					       MAX(result_end_dt) result_end_dt,
					       MAX(person_yn) person_yn,
					       MAX(codeoperation) codeoperation,
					       MAX(result_dt) result_dt,
					       MAX(oper_comp_name1) oper_comp_name1,
					       MAX(oper_comp_add1_1) oper_comp_add1_1,
					       MAX(code_post) code_post,
					       MAX(oper_hp) oper_hp,
					       MAX(operemail) operemail,
					       MAX(start_dt) start_dt,
					       MAX(end_dt) end_dt,
					       MAX(insp_date) insp_date,
					       MAX(inspdate) inspdate
					  from (
					        select  '' upYN
							, f.code_kind
					        , l.certifi_name codecertifi
					        , a.code_certifi
					        , ISNULL(d.result_no,'') result_no
					        , ISNULL(d.result_start_dt,'') result_start_dt
					        , ISNULL(d.result_end_dt,'') result_end_dt
					        , p.member person_yn
							, isnull( p.code_pers, '') person_yn1
					        , m.detcodename codeoperation
					        , ISNULL(d.result_dt,'') result_dt
					        , a.oper_name
					        , a.oper_lic_no
<!-- 					        JUMIN_DEL -->
<!-- 							, a.oper_no    -->
							, a.oper_birth   
					        , ISNULL(a.oper_comp_name1, '') oper_comp_name1 
							, ISNULL(a.oper_comp_add1_1, '') oper_comp_add1_1
							, ISNULL(a.code_post, '') code_post
					        , a.oper_hp
					        , case when a.code_email_comp = '01'  or ISNULL(a.code_email_comp,'') = ''  then a.oper_email 
					          else rtrim(a.oper_email) + '@' + i.detcodename end operemail
					        , ISNULL(e.start_dt, '') start_dt
					        , ISNULL(e.end_dt, '') end_dt
						    , a.insp_date
						    , a.inspdate
					 	from (
					 	      select code_kind, code_certifi, code_seq, code_bran, bran_seq, oper_name, oper_lic_no, person_yn,
<!-- 					 	      		JUMIN_DEL -->
<!-- 					 	             max([dbo].[GetPersNoDecord](oper_no , #check#)) oper_no,  -->
					 	             max(oper_birth) oper_birth, 
					 	             max(oper_hp) oper_hp,
					 	             max(oper_comp_name1) oper_comp_name1,
					 	             max(oper_comp_add1_1) oper_comp_add1_1, 
					 	             max(code_post) code_post, 
					 	             max(code_email_comp) code_email_comp, 
					 	             max(oper_email) oper_email, 
					 	             max(result_state) result_state, 
					 	             max(result_state2) result_state2,
					 	             MAX(code_pay_flag) code_pay_flag,
					 	             MAX(code_operation) code_operation,
                                     case when isnull(insp_date,'') > isnull(insp_date2,'') then insp_date else insp_date2 end insp_date,
                                     case when isnull(inspdate,'') > isnull(inspdate2,'') then inspdate else inspdate2 end inspdate
					 	        from (
					 			SELECT  AA.*,bb.result_point result_point2, bb.result_state result_state2,
									   bb.insp_date insp_date2,
									   bb.inspdate inspdate2
							  FROM
							(SELECT b.*
							      , C.YYYY, c.season, a.result_point, a.result_state
								   ,a.insp_date
								   ,CONVERT(varchar, a.insp_date ,  112) inspdate
							  FROM OPER_RESULT A
								   LEFT JOIN OPERATER B ON B.CODE_KIND = A.CODE_KIND
													   AND B.CODE_CERTIFI = A.CODE_CERTIFI
													   AND B.CODE_SEQ = A.CODE_SEQ
													   AND B.CODE_BRAN = A.CODE_BRAN
													   AND B.BRAN_SEQ = A.BRAN_SEQ
													   AND B.RECEIPT_NO = A.RECEIPT_NO
								   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
													   AND C.CODE_CERTIFI = A.CODE_CERTIFI
													   AND C.CODE_SEQ = A.CODE_SEQ
													   AND C.CODE_BRAN = A.CODE_BRAN
													   AND C.BRAN_SEQ = A.BRAN_SEQ
							WHERE A.CODE_KIND = '5'   
							/* 자격증구분  */
							<dynamic prepend="and">
								<isNotEmpty property="code_certifi1">
									a.code_certifi = #code_certifi1#
								</isNotEmpty>
							</dynamic> 
							  AND ISNULL(A.RESULT_NO,'') = ''
							  AND A.RESULT_STATE in ('10','12')
<!-- 							<dynamic prepend="and"> -->
<!-- 								<isNotEmpty property="yyyy1"> -->
<!-- 									c.yyyy = #yyyy1# -->
<!-- 								</isNotEmpty> -->
<!-- 							</dynamic>   -->
							  ) AA,
							(SELECT b.*
							      , C.YYYY, c.season, a.result_point, a.result_state
								   ,a.insp_date
								   ,CONVERT(varchar, a.insp_date ,  112) inspdate
							  FROM OPER_RESULT A
								   LEFT JOIN OPERATER B ON B.CODE_KIND = A.CODE_KIND
													   AND B.CODE_CERTIFI = A.CODE_CERTIFI
													   AND B.CODE_SEQ = A.CODE_SEQ
													   AND B.CODE_BRAN = A.CODE_BRAN
													   AND B.BRAN_SEQ = A.BRAN_SEQ
													   AND B.RECEIPT_NO = A.RECEIPT_NO
								   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
													   AND C.CODE_CERTIFI = A.CODE_CERTIFI
													   AND C.CODE_SEQ = A.CODE_SEQ
													   AND C.CODE_BRAN = A.CODE_BRAN
													   AND C.BRAN_SEQ = A.BRAN_SEQ
							WHERE A.CODE_KIND = '5'
							/* 자격증구분  */
							<dynamic prepend="and">
								<isNotEmpty property="code_certifi1">
									a.code_certifi = #code_certifi1#
								</isNotEmpty>
							</dynamic> 
							  AND ISNULL(A.RESULT_NO,'') = ''
							  AND A.RESULT_STATE in ('10','12')
							  ) BB
							WHERE AA.CODE_KIND = BB.CODE_KIND
							  AND AA.CODE_CERTIFI = BB.CODE_CERTIFI
							  AND AA.PERSON_YN = BB.PERSON_YN
							  and bb.yyyy between (aa.yyyy - 5) and aa.yyyy     
							  and aa.season != bb.season
							) b
							group by code_kind, code_certifi, code_seq, code_bran, bran_seq, oper_name, oper_lic_no, person_yn,
									  insp_date,
									  inspdate,
									  insp_date2,
									  inspdate2
					      ) a 
						left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member, w.pers_state
					                  from Person_M_TBL w
					                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
					                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn 
						left join (select z.code_pers, 
					                       x.code_certifi, max(x.result_start_dt) result_start_dt, 
					                       max(x.result_end_dt) result_end_dt, x.result_no , x.result_dt
					                  from Person_M_TBL z, result_print x
					                 where z.code_pers = x.code_pers
					                 group by z.code_pers,
<!-- 					                 JUMIN_DEL -->
<!-- 					                 z.pers_no, -->
					                 x.code_certifi, x.result_no , x.result_dt
					                ) d 
					               on d.code_certifi = a.code_certifi
					              and d.code_pers = a.person_yn
					     left join delay_release e
					               on e.code_kind = a.code_kind 
					              and e.code_certifi = a.code_certifi
					              and e.code_seq = a.code_seq
					     left join com_code i
					               on i.groupcode = '025'
					              and i.detcode = a.code_email_comp
					     left join com_code j
					               on j.groupcode = '014'
					              and j.detcode = a.code_pay_flag
					  left join com_code m
					               on m.groupcode = '035'
					              and m.detcode = a.code_operation
						left join certifi l
					               on l.code_certifi = a.code_certifi
					   , edu_test f
					     left join com_code s
					       on s.groupcode = '034'
					      and s.detcode = f.code_bran
					     left join edu_test_name g
					               on g.code_kind = f.code_kind
					              and g.code_certifi = f.code_certifi
					              and g.code_seq = f.code_seq
					 	where a.code_kind = f.code_kind
					   and a.code_certifi = f.code_certifi
					   and a.code_seq = f.code_seq
					   and a.code_bran = f.code_bran
					   and a.bran_seq = f.bran_seq     
					   and a.code_kind in ('5')   
					   and ISNULL(d.result_no , '' ) = ''    
					   and isnull(p.code_pers, '') != '' 
					   and (a.result_state = '12' or a.result_state2 = '12')
					   /*19.03.06 사망자 제외*/
					   and p.pers_state != '02'
<!-- 						/* 발급년도  */ -->
						
<!-- 								<dynamic prepend="and"> -->
<!-- 									<isNotEmpty property="yyyy1"> -->
<!-- 										substring(f.oper_end_dt,1,4) = #yyyy1# -->
<!-- 									</isNotEmpty> -->
<!-- 								</dynamic>   -->
						
						
						/* 심사년도  */
								<dynamic prepend="and">
									<isNotEmpty property="yyyy1">
											<isEmpty property="season1">
												<isEmpty property="season2">
												a.inspdate between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and #yyyy1#+'0731'  /*전후반기 조회시*/
												</isEmpty>
											</isEmpty>
											<isNotEmpty property="season1">
												a.inspdate between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'1231'  /*전반기 조회시*/
											</isNotEmpty>
											<isNotEmpty property="season2">
												a.inspdate between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
											</isNotEmpty>
									</isNotEmpty>
								</dynamic> 

						/* 자격증구분  */
						<dynamic prepend="and">
							<isNotEmpty property="code_certifi1">
								a.code_certifi = #code_certifi1#
							</isNotEmpty>
						</dynamic>
						<dynamic prepend="and">
								<isNotEmpty property="code_operation1">
									a.code_operation = #code_operation1#
								</isNotEmpty>
						</dynamic> 
						 
						<dynamic prepend="and">
						<isNotEmpty property="person_yns">
							p.code_pers in (
							<iterate property="person_yns" open="" conjunction="," close="">
							#person_yns[]#
							</iterate>		
							)
						</isNotEmpty>
						</dynamic>
						 
					) qq
					group by upYN, code_kind, code_certifi, oper_name, person_yn1,
<!-- 					JUMIN_DEL -->
<!-- 					oper_no, -->
					oper_birth,
					oper_lic_no, result_no
        ) OUT
        WHERE 1=1
	</select>	
	
	
	<!--자격증 발급 대상검색버튼 출력 엑셀저장 ,문자,쪽지
	   selectlinspection1. 1학기나 2학기 자격증시험 결과에 대한 상태가 '12'(첨부서류심사) 하나는 있어야 한다
	-->
	<select id="selectissue" resultClass="java.util.HashMap">

    select sout.*
	  from ( select aa.*, ROW_NUMBER()OVER(ORDER BY aa.oper_name, aa.result_no ) ncount
	          from (
					select upYN, code_kind, code_certifi, oper_name, person_yn1,
<!-- 							JUMIN_DEL -->
<!-- 							oper_no, -->
							oper_birth,
							oper_lic_no, result_no, print_state,
					       MAX(codecertifi) codecertifi,
					       MAX(result_start_dt) result_start_dt,
					       MAX(result_end_dt) result_end_dt,
					       MAX(person_yn) person_yn,
					       MAX(codeoperation) codeoperation,
					       MAX(result_dt) result_dt,
					       MAX(oper_comp_name1) oper_comp_name1,
					       MAX(oper_comp_add1_1) oper_comp_add1_1,
					       MAX(code_post) code_post,
					       MAX(oper_hp) oper_hp,
					       MAX(operemail) operemail,
					       MAX(start_dt) start_dt,
					       MAX(end_dt) end_dt,
					       MAX(insp_date) insp_date,
					       MAX(inspdate) inspdate
					  from (
					        select  '' upYN
							, f.code_kind
					        , l.certifi_name codecertifi
					        , a.code_certifi
					        , ISNULL(d.result_no,'') result_no
					        , ISNULL(d.result_start_dt,'') result_start_dt
					        , ISNULL(d.result_end_dt,'') result_end_dt
					        , p.member person_yn
							, isnull( p.code_pers, '') person_yn1
					        , m.detcodename codeoperation
					        , ISNULL(d.result_dt,'') result_dt
					        , a.oper_name
					        , a.oper_lic_no
<!-- 					        JUMIN_DEL -->
<!-- 							, a.oper_no    -->
							, a.oper_birth   
					        , ISNULL(a.oper_comp_name1, '') oper_comp_name1 
							, ISNULL(a.oper_comp_add1_1, '') oper_comp_add1_1
							, ISNULL(a.code_post, '') code_post
					        , a.oper_hp
<!-- 					        , case when a.code_email_comp = '01' or ISNULL(a.code_email_comp,'') = ''  then a.oper_email  -->
<!-- 					          else rtrim(a.oper_email) + '@' + i.detcodename end operemail -->
							, a.oper_email operemail
					        , ISNULL(e.start_dt, '') start_dt
					        , ISNULL(e.end_dt, '') end_dt
					        , ISNULL(d.print_state,'') print_state
						    , a.insp_date
						    , a.inspdate
					 	from (
					 	      select code_kind, code_certifi, code_seq, code_bran, bran_seq, oper_name, oper_lic_no, person_yn,
<!-- 					 	             JUMIN_DEL -->
<!-- 					 	             max([dbo].[GetPersNoDecord](oper_no , #check#)) oper_no,  -->
					 	             max(oper_birth) oper_birth,
					 	             max(oper_hp) oper_hp,
					 	             max(oper_comp_name1) oper_comp_name1,
					 	             max(oper_comp_add1_1) oper_comp_add1_1, 
					 	             max(code_post) code_post, 
					 	             max(code_email_comp) code_email_comp, 
					 	             max(oper_email) oper_email, 
					 	             max(result_state) result_state, 
					 	             max(result_state2) result_state2,
					 	             MAX(code_pay_flag) code_pay_flag,
					 	             MAX(code_operation) code_operation,
                                     case when isnull(insp_date,'') > isnull(insp_date2,'') then insp_date else insp_date2 end insp_date,
                                     case when isnull(inspdate,'') > isnull(inspdate2,'') then inspdate else inspdate2 end inspdate
					 	        from (
					 			SELECT  AA.*,bb.result_point result_point2, bb.result_state result_state2,
									   bb.insp_date insp_date2,
									   bb.inspdate inspdate2
							  FROM
							(SELECT b.*
							      , C.YYYY, c.season, a.result_point, a.result_state
								   ,a.insp_date
								   ,CONVERT(varchar, a.insp_date ,  112) inspdate
							  FROM OPER_RESULT A
								   LEFT JOIN OPERATER B ON B.CODE_KIND = A.CODE_KIND
													   AND B.CODE_CERTIFI = A.CODE_CERTIFI
													   AND B.CODE_SEQ = A.CODE_SEQ
													   AND B.CODE_BRAN = A.CODE_BRAN
													   AND B.BRAN_SEQ = A.BRAN_SEQ
													   AND B.RECEIPT_NO = A.RECEIPT_NO
								   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
													   AND C.CODE_CERTIFI = A.CODE_CERTIFI
													   AND C.CODE_SEQ = A.CODE_SEQ
													   AND C.CODE_BRAN = A.CODE_BRAN
													   AND C.BRAN_SEQ = A.BRAN_SEQ
							WHERE A.CODE_KIND = '5'   
							/* 자격증구분  */
							<dynamic prepend="and">
								<isNotEmpty property="code_certifi1">
									a.code_certifi = #code_certifi1#
								</isNotEmpty>
							</dynamic> 
							  AND ISNULL(A.RESULT_NO,'') = ''
							  AND A.RESULT_STATE in ('10','12')
							  ) AA,
							(SELECT b.*
							      , C.YYYY, c.season, a.result_point, a.result_state
								   ,a.insp_date
								   ,CONVERT(varchar, a.insp_date ,  112) inspdate
							  FROM OPER_RESULT A
								   LEFT JOIN OPERATER B ON B.CODE_KIND = A.CODE_KIND
													   AND B.CODE_CERTIFI = A.CODE_CERTIFI
													   AND B.CODE_SEQ = A.CODE_SEQ
													   AND B.CODE_BRAN = A.CODE_BRAN
													   AND B.BRAN_SEQ = A.BRAN_SEQ
													   AND B.RECEIPT_NO = A.RECEIPT_NO
								   LEFT JOIN EDU_TEST C ON C.CODE_KIND = A.CODE_KIND
													   AND C.CODE_CERTIFI = A.CODE_CERTIFI
													   AND C.CODE_SEQ = A.CODE_SEQ
													   AND C.CODE_BRAN = A.CODE_BRAN
													   AND C.BRAN_SEQ = A.BRAN_SEQ
							WHERE A.CODE_KIND = '5'
							/* 자격증구분  */
							<dynamic prepend="and">
								<isNotEmpty property="code_certifi1">
									a.code_certifi = #code_certifi1#
								</isNotEmpty>
							</dynamic> 
							  AND ISNULL(A.RESULT_NO,'') = ''
							  AND A.RESULT_STATE in ('10','12')
							  ) BB
							WHERE AA.CODE_KIND = BB.CODE_KIND
							  AND AA.CODE_CERTIFI = BB.CODE_CERTIFI
							  AND AA.PERSON_YN = BB.PERSON_YN
							  and bb.yyyy between (aa.yyyy - 5) and aa.yyyy     
							  and aa.season != bb.season
							) b
							group by code_kind, code_certifi, code_seq, code_bran, bran_seq, oper_name, oper_lic_no, person_yn,
									  insp_date,
									  inspdate,
									  insp_date2,
									  inspdate2
					      ) a 
						left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member, w.pers_state
					                  from Person_M_TBL w
					                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
					                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn 
						left join (select z.code_pers, 
					                       x.code_certifi, max(x.result_start_dt) result_start_dt, 
					                       max(x.result_end_dt) result_end_dt, x.result_no , x.result_dt, xxx.detcodename print_state
					                  from Person_M_TBL z
					                     , result_print x
					                       left join com_code xxx
					                              on xxx.groupcode='024'
					                             and xxx.detcode=x.print_state
					                 where z.code_pers = x.code_pers
					                 group by z.code_pers,
<!-- 					                 JUMIN_DEL -->
<!-- 					                 z.pers_no, -->
					                 x.code_certifi, x.result_no , x.result_dt, xxx.detcodename
					                ) d 
					               on d.code_certifi = a.code_certifi
					              and d.code_pers = a.person_yn
					     left join delay_release e
					               on e.code_kind = a.code_kind 
					              and e.code_certifi = a.code_certifi
					              and e.code_seq = a.code_seq
					     left join com_code i
					               on i.groupcode = '025'
					              and i.detcode = a.code_email_comp
					     left join com_code j
					               on j.groupcode = '014'
					              and j.detcode = a.code_pay_flag
						  left join com_code m
					               on m.groupcode = '035'
					              and m.detcode = a.code_operation
						left join certifi l
					               on l.code_certifi = a.code_certifi
					   , edu_test f
					     left join com_code s
					       on s.groupcode = '034'
					      and s.detcode = f.code_bran
					     left join edu_test_name g
					               on g.code_kind = f.code_kind
					              and g.code_certifi = f.code_certifi
					              and g.code_seq = f.code_seq
					 	where a.code_kind = f.code_kind
					   and a.code_certifi = f.code_certifi
					   and a.code_seq = f.code_seq
					   and a.code_bran = f.code_bran
					   and a.bran_seq = f.bran_seq     
					   and a.code_kind in ('5')   
					   and ISNULL(d.result_no , '' ) = ''    
					   and isnull(p.code_pers, '') != '' 
					   and (a.result_state = '12' or a.result_state2 = '12')
					   /*19.03.06 사망자 제외*/
					   and p.pers_state != '02'
<!-- 						/* 발급년도  */ -->
						
<!-- 								<dynamic prepend="and"> -->
<!-- 									<isNotEmpty property="yyyy1"> -->
<!-- 										substring(f.oper_end_dt,1,4) = #yyyy1# -->
<!-- 									</isNotEmpty> -->
<!-- 								</dynamic>   -->
						
						
						/* 심사년도  */
								<dynamic prepend="and">
									<isNotEmpty property="yyyy1">
											<isEmpty property="season1">
												<isEmpty property="season2">
												a.inspdate between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and #yyyy1#+'0731'  /*전후반기 조회시*/
												</isEmpty>
											</isEmpty>
											<isNotEmpty property="season1">
												a.inspdate between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'1231'  /*전반기 조회시*/
											</isNotEmpty>
											<isNotEmpty property="season2">
												a.inspdate between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
											</isNotEmpty>
									</isNotEmpty>
								</dynamic> 

						/* 자격증구분  */
						<dynamic prepend="and">
							<isNotEmpty property="code_certifi1">
								a.code_certifi = #code_certifi1#
							</isNotEmpty>
						</dynamic>
						<dynamic prepend="and">
								<isNotEmpty property="code_operation1">
									a.code_operation = #code_operation1#
								</isNotEmpty>
						</dynamic>
						 
						<dynamic prepend="and">
						<isNotEmpty property="person_yns">
							p.code_pers in (
							<iterate property="person_yns" open="" conjunction="," close="">
							#person_yns[]#
							</iterate>		
							)
						</isNotEmpty>
						</dynamic>
						 
						 
					) qq
					group by upYN, code_kind, code_certifi, oper_name, person_yn1,
<!-- 					JUMIN_DEL -->
<!-- 					oper_no, -->
					oper_birth,
					oper_lic_no, result_no, print_state
		) aa
	)sout
	where sout.ncount > #nstart# and sout.ncount <![CDATA[<=]]> #nend#
	</select>	
	
	<!--자격증 발급 현황조회페이지 count -->
	<select id="nowsendcnt" resultClass="java.util.HashMap">
	 SELECT count(*) cnt
        FROM (
				select upYN, code_kind, code_certifi, oper_name, person_yn1,
<!-- 						JUMIN_DEL -->
<!-- 						oper_no, -->
						oper_birth,
						oper_lic_no, result_no,
				       MAX(codecertifi) codecertifi,
				       MAX(result_start_dt) result_start_dt,
				       MAX(result_end_dt) result_end_dt,
				       MAX(person_yn) person_yn,
				       MAX(codeoperation) codeoperation,
				       MAX(result_dt) result_dt,
				       MAX(oper_comp_name1) oper_comp_name1,
				       MAX(oper_comp_add1_1) oper_comp_add1_1,
				       MAX(code_post) code_post,
				       MAX(oper_hp) oper_hp,
				       MAX(operemail) operemail,
				       MAX(start_dt) start_dt,
				       MAX(end_dt) end_dt
                 from (
			        select distinct '' upYN
						, f.code_kind
				        , l.certifi_name codecertifi
				        , a.code_certifi
				        , d.result_no
				        , d.result_start_dt
				        , d.result_end_dt
				        , p.member person_yn
						, isnull( p.code_pers, '') person_yn1
				        , m.detcodename codeoperation
				        , d.result_dt
				        , a.oper_name
				        , a.oper_lic_no
<!-- 				        JUMIN_DEL -->
<!-- 						,case when #check# = '1'  then [dbo].[GetPersNoDecord](a.oper_no , '1') -->
<!-- 						      when #check# = '2'  then [dbo].[GetPersNoDecord](a.oper_no , '2')   -->
<!-- 							  when #check# = '3'  then [dbo].[GetPersNoDecord](a.oper_no , '3') -->
<!-- 							  else [dbo].[GetPersNoDecord](a.oper_no , '3') end oper_no   /*주민등록번호 */ -->
				        , a.oper_birth
				        , ISNULL(a.oper_comp_name1, '') oper_comp_name1 
						, ISNULL(a.oper_comp_add1_1, '') oper_comp_add1_1
						, ISNULL(a.code_post, '') code_post
				        , a.oper_hp
				        , case when a.code_email_comp = '01' or ISNULL(a.code_email_comp,'') = ''  then a.oper_email 
				          else rtrim(a.oper_email) + '@' + i.detcodename end operemail
				        , k.detcodename operstate
				        , a.oper_state
				        , ISNULL(e.start_dt, '') start_dt
				        , ISNULL(e.end_dt, '') end_dt
					from operater a 
						left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member, w.pers_state
					                  from Person_M_TBL w
					                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
					                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn 
						left join (select z.code_pers, 
					                       x.code_certifi, max(x.result_dt) result_dt, max(x.result_start_dt) result_start_dt, 
					                       max(x.result_end_dt) result_end_dt, x.result_no, max(x.code_seq) result_code_seq
					                  from Person_M_TBL z, result_print x
					                 where z.code_pers = x.code_pers
					                 group by z.code_pers,
<!-- 					                 JUMIN_DEL -->
<!-- 					                 z.pers_no, -->
					                 x.code_certifi, x.result_no
					                ) d 
					               on d.code_certifi = a.code_certifi
					              and d.code_pers = a.person_yn
					     left join delay_release e
					               on e.code_kind = a.code_kind 
					              and e.code_certifi = a.code_certifi
					              and e.code_seq = a.code_seq
					     left join com_code i
					               on i.groupcode = '025'
					              and i.detcode = a.code_email_comp
					     left join com_code k
					               on k.groupcode = '022'
					              and k.detcode = a.oper_state
								  left join com_code m
					               on m.groupcode = '035'
					              and m.detcode = a.code_operation
						left join certifi l
					               on l.code_certifi = a.code_certifi
					   , edu_test f
					     left join com_code s
					       on s.groupcode = '034'
					      and s.detcode = f.code_bran
					     left join edu_test_name g
					               on g.code_kind = f.code_kind
					              and g.code_certifi = f.code_certifi
					              and g.code_seq = f.code_seq
					  ,  oper_result c 
					 	where a.code_kind = f.code_kind
					   and a.code_certifi = f.code_certifi
					   and a.code_seq = f.code_seq
					   and a.code_bran = f.code_bran
					   and a.bran_seq = f.bran_seq    
					   and a.code_kind in ('5')   
					   and c.code_kind = a.code_kind 
					   and c.code_certifi = a.code_certifi
					   and c.code_seq = a.code_seq
					   and c.code_bran = a.code_bran
					   and c.bran_seq = a.bran_seq
					   and c.receipt_no = a.receipt_no
					   and ISNULL(d.result_no , '' ) != '' 
					   and isnull(p.code_pers, '') != '' 
					   and d.result_code_seq = '01'
					   /*19.03.06 사망자 제외*/
					   and p.pers_state != '02'
						/* 발급년도  */
								<dynamic prepend="and">
									<isNotEmpty property="yyyy1">
										substring(d.result_dt,1,4) = #yyyy1#
										/* 반기 동일 조건  */
											<isNotEmpty property="season1">
												and d.result_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*전반기 조회시*/
											</isNotEmpty>
											<isNotEmpty property="season2">
												and d.result_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*후반기 조회시*/
											</isNotEmpty>
									</isNotEmpty>
								</dynamic> 
								
						
						/* 자격증구분  */
						<dynamic prepend="and">
							<isNotEmpty property="code_certifi1">
								a.code_certifi = #code_certifi1#
							</isNotEmpty>
						</dynamic> 
						<dynamic prepend="and">
							<isNotEmpty property="code_operation1">
								a.code_operation = #code_operation1#
							</isNotEmpty>
						</dynamic> 
						 
						<dynamic prepend="and">
						<isNotEmpty property="person_yns">
							p.code_pers in (
							<iterate property="person_yns" open="" conjunction="," close="">
							#person_yns[]#
							</iterate>		
							)
						</isNotEmpty>
						</dynamic>
						 
			) bb
        group by upYN, code_kind, code_certifi, oper_name, person_yn1,
<!--         JUMIN_DEL -->
<!--         oper_no, -->
        oper_birth,
        oper_lic_no, result_no
        ) OUT
        WHERE 1=1
		</select>
		
		<!--자격증 발급 현황페이지조회 출력 -->
	<select id="selectnow" resultClass="java.util.HashMap">
		select sout.*  
	  from ( select aa.*, ROW_NUMBER()OVER(ORDER BY aa.oper_name, aa.result_no ) ncount
	          from (
				select upYN, code_kind, code_certifi, oper_name, person_yn1,
<!-- 						JUMIN_DEL -->
<!-- 						oper_no, -->
						oper_birth,
						oper_lic_no, result_no, print_state,
				       MAX(codecertifi) codecertifi,
				       MAX(result_start_dt) result_start_dt,
				       MAX(result_end_dt) result_end_dt,
				       MAX(person_yn) person_yn,
				       MAX(codeoperation) codeoperation,
				       MAX(result_dt) result_dt,
				       MAX(oper_comp_name1) oper_comp_name1,
				       MAX(oper_comp_add1_1) oper_comp_add1_1,
				       MAX(code_post) code_post,
				       MAX(oper_hp) oper_hp,
				       MAX(operemail) operemail,
				       MAX(start_dt) start_dt,
				       MAX(end_dt) end_dt
                 from (
			        select distinct '' upYN
						, f.code_kind
				        , l.certifi_name codecertifi
				        , a.code_certifi
				        , d.result_no
				        , d.result_start_dt
				        , d.result_end_dt
				        , p.member person_yn
						, isnull( p.code_pers, '') person_yn1
				        , m.detcodename codeoperation
				        , d.result_dt
				        , a.oper_name
				        , a.oper_lic_no
<!-- 				        JUMIN_DEL -->
<!-- 						,case when #check# = '1'  then [dbo].[GetPersNoDecord](a.oper_no , '1') -->
<!-- 						      when #check# = '2'  then [dbo].[GetPersNoDecord](a.oper_no , '2')   -->
<!-- 							  when #check# = '3'  then [dbo].[GetPersNoDecord](a.oper_no , '3') -->
<!-- 							  else [dbo].[GetPersNoDecord](a.oper_no , '3') end oper_no   /*주민등록번호 */ -->
				        , a.oper_birth
				        , ISNULL(a.oper_comp_name1, '') oper_comp_name1 
						, ISNULL(a.oper_comp_add1_1, '') oper_comp_add1_1
						, ISNULL(a.code_post, '') code_post
				        , a.oper_hp
<!-- 				        , case when a.code_email_comp = '01' or ISNULL(a.code_email_comp,'') = ''  then a.oper_email  -->
<!-- 				          else rtrim(a.oper_email) + '@' + i.detcodename end operemail -->
						, a.oper_email operemail
				        , k.detcodename operstate
				        , a.oper_state
				        , ISNULL(e.start_dt, '') start_dt
				        , ISNULL(e.end_dt, '') end_dt
				        , ISNULL(d.print_state,'') print_state
					from operater a 
						left join (select  w.code_pers, cq.detcodename + '(' + cw.detcodename + ')' member, w.pers_state
					                  from Person_M_TBL w
					                       left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
					                       left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn 
						left join (select z.code_pers, 
					                       x.code_certifi, max(x.result_dt) result_dt, max(x.result_start_dt) result_start_dt, 
					                       max(x.result_end_dt) result_end_dt, x.result_no, max(x.code_seq) result_code_seq, xxx.detcodename print_state
					                  from Person_M_TBL z
					                     , result_print x
					                       left join com_code xxx
					                              on xxx.groupcode='024'
					                             and xxx.detcode=x.print_state
					                 where z.code_pers = x.code_pers
					                 group by z.code_pers,
<!-- 					                 JUMIN_DEL -->
<!-- 					                 z.pers_no, -->
					                 x.code_certifi, x.result_no, xxx.detcodename
					                ) d 
					               on d.code_certifi = a.code_certifi
					              and d.code_pers = a.person_yn
					     left join delay_release e
					               on e.code_kind = a.code_kind 
					              and e.code_certifi = a.code_certifi
					              and e.code_seq = a.code_seq
					     left join com_code i
					               on i.groupcode = '025'
					              and i.detcode = a.code_email_comp
					     left join com_code k
					               on k.groupcode = '022'
					              and k.detcode = a.oper_state
								  left join com_code m
					               on m.groupcode = '035'
					              and m.detcode = a.code_operation
						left join certifi l
					               on l.code_certifi = a.code_certifi
					   , edu_test f
					     left join com_code s
					       on s.groupcode = '034'
					      and s.detcode = f.code_bran
					     left join edu_test_name g
					               on g.code_kind = f.code_kind
					              and g.code_certifi = f.code_certifi
					              and g.code_seq = f.code_seq
					  ,  oper_result c 
					 	where a.code_kind = f.code_kind
					   and a.code_certifi = f.code_certifi
					   and a.code_seq = f.code_seq
					   and a.code_bran = f.code_bran
					   and a.bran_seq = f.bran_seq    
					   and a.code_kind in ('5')   
					   and c.code_kind = a.code_kind 
					   and c.code_certifi = a.code_certifi
					   and c.code_seq = a.code_seq
					   and c.code_bran = a.code_bran
					   and c.bran_seq = a.bran_seq
					   and c.receipt_no = a.receipt_no
					   and ISNULL(d.result_no , '' ) != '' 
					   and isnull(p.code_pers, '') != '' 
					   and d.result_code_seq = '01'
					   /*19.03.06 사망자 제외*/
					   and p.pers_state != '02'
						/* 발급년도  */
								<dynamic prepend="and">
									<isNotEmpty property="yyyy1">
										substring(d.result_dt,1,4) = #yyyy1#
										/* 반기 동일 조건  */
											<isNotEmpty property="season1">
												and d.result_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*전반기 조회시*/
											</isNotEmpty>
											<isNotEmpty property="season2">
												and d.result_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*후반기 조회시*/
											</isNotEmpty>
									</isNotEmpty>
								</dynamic> 
								
						
						/* 자격증구분  */
						<dynamic prepend="and">
							<isNotEmpty property="code_certifi1">
								a.code_certifi = #code_certifi1#
							</isNotEmpty>
						</dynamic> 
						<dynamic prepend="and">
							<isNotEmpty property="code_operation1">
								a.code_operation = #code_operation1#
							</isNotEmpty>
						</dynamic> 
						 
						<dynamic prepend="and">
						<isNotEmpty property="person_yns">
							p.code_pers in (
							<iterate property="person_yns" open="" conjunction="," close="">
							#person_yns[]#
							</iterate>		
							)
						</isNotEmpty>
						</dynamic>
						 
			) bb
        group by upYN, code_kind, code_certifi, oper_name, person_yn1,
<!--         	JUMIN_DEL -->
<!--         	oper_no, -->
        	oper_birth,
        	oper_lic_no, result_no, print_state
	 ) aa
	)sout
	where sout.ncount > #nstart# and sout.ncount <![CDATA[<=]]> #nend#
		</select>



	<parameterMap class="java.util.Map" id="lnc">
		<parameter property="iCertifi"		jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN" />
		<parameter property="iYyyy"			jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN" />
		<parameter property="iSeason"		jdbcType="VARCAHR"	javaType="java.lang.String" 	mode="IN" />
		<parameter property="procReturn"	jdbcType="NUMERIC"	javaType="java.lang.Integer"	mode="OUT" />
	</parameterMap>
	 <procedure id="pLicenseNoCreat_STR" parameterMap="lnc">
	   {CALL LicenseNoCreat_STR(?,?,?,?)}
	 </procedure> 

	<parameterMap class="java.util.Map" id="rnst">
		<parameter property="iCertifi"		jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN" />
		<parameter property="iYyyy"			jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN" />
		<parameter property="iSeason"		jdbcType="NUMERIC"	javaType="java.lang.Integer"	mode="IN" />
		<parameter property="procReturn"	jdbcType="NUMERIC"	javaType="java.lang.Integer"	mode="OUT" />
	</parameterMap>
	 <procedure id="pRenewal_STR" parameterMap="rnst">
	   {CALL Renewal_STR(?,?,?,?)}
	 </procedure>
	 		
	<!-- 자격증 심사 insert를 위한 delete-->
	<delete id="deletinspection" parameterClass="java.util.HashMap">
		DELETE oper_add_file 
			WHERE  code_kind 		=  #code_kind1#  
			  and  code_certifi  	=  #code_certifi1#
			  and  code_seq  		=  #code_seq1#
			  and  code_bran  		=  #code_bran1#
			  and  bran_seq  		=  #bran_seq1#
			  and  receipt_no  		=  #receipt_no1#
	</delete>
	
	<!--자격증심사 insert --> 
	<insert id="insertinspection" parameterClass="java.util.HashMap">
 		INSERT INTO oper_add_file 
					(code_kind
					, code_certifi
					, code_seq
					, code_bran
					, bran_seq
					, receipt_no
					, add_file_no
					, chang_file_name
					, regi_date
					)
		       VALUES (
				      #code_kind1#
				    , #code_certifi1#
				    , #code_seq1#
					, #code_bran1#
					, #bran_seq1#
					, #receipt_no1#
					, #add_file_no#
					, #chang_file_name#
					, getdate())
	</insert>
	
	<update  id="upinspection2" parameterClass="java.util.HashMap">
		UPDATE oper_add_file 
		   SET chang_file_name=#chang_file_name#
		     , regi_date=GETDATE()
		 WHERE  code_kind 	=  #code_kind1#  
		   and  code_certifi =  #code_certifi1#
		   and  code_seq  	=  #code_seq1#
		   and  code_bran  	=  #code_bran1#
		   and  bran_seq  	=  #bran_seq1#
		   and  receipt_no  =  #receipt_no1#
		   and  add_file_no =  #add_file_no#   
	</update>
	
	<!-- 자격증심사 첨부 파일 -->
	<select id="selectCFiles" resultClass="java.util.HashMap">
		SELECT add_file_no 
		     , chang_file_name
		  FROM oper_add_file 
		 WHERE  code_kind 	=  #code_kind1#  
		   and  code_certifi  	=  #code_certifi1#
		   and  code_seq  	=  #code_seq1#
		   and  code_bran  	=  #code_bran1#
		   and  bran_seq  	=  #bran_seq1#
		   and  receipt_no  	=  #receipt_no1#
		   <dynamic prepend="and">
		   		<isNotEmpty property="add_file_no">			 
	  				add_file_no =#add_file_no#
	  			</isNotEmpty>
	 	   </dynamic>
	</select>
	
	<!-- 자격증심사 첨부 파일 Batch-->
	<select id="selectCFilesBatch" resultClass="java.util.HashMap">
		SELECT a.add_file_no , a.chang_file_name, a.extension,
			t.yyyy+'_'+c.CERTIFI_name+'_'+d.detcodename detcode,
			b.oper_name , b.oper_birth, b.oper_lic_no, b.code_operation, e.detcodename codeoperation
		  FROM oper_add_file a
			left join operater b
			 on  a.code_kind 	=  b.code_kind
			   and  a.code_certifi  	=  b.code_certifi
			   and  a.code_seq  	=  b.code_seq
			   and  a.code_bran  	=  b.code_bran
			   and  a.bran_seq  	=  b.bran_seq
			   and  a.receipt_no  	=  b.receipt_no
			left join edu_test t
			 on  a.code_kind 	=  t.code_kind
			   and  a.code_certifi  	=  t.code_certifi
			   and  a.code_seq  	=  t.code_seq
			   and  a.code_bran  	=  t.code_bran
			   and  a.bran_seq  	=  t.bran_seq
			   left join certifi c on c.code_certifi = a.code_certifi
			   left join com_code d on d.groupcode = '034' and d.detcode =  a.code_bran
			   left join com_code e on e.groupcode = '035' and e.detcode =  b.code_operation
		 WHERE
			<iterate property="file_infos" open="(" conjunction=" or " close=")">
			(a.code_kind = #file_infos[].[0]# and a.code_certifi = #file_infos[].[1]# and a.code_seq =#file_infos[].[2]# 
					and a.code_bran = #file_infos[].[3]# and a.bran_seq = #file_infos[].[4]# and a.receipt_no= #file_infos[].[5]#)
			</iterate>		
	</select>
	
	<delete id="deletCFiles" parameterClass="java.util.HashMap">
		DELETE oper_add_file 
			WHERE  code_kind 		=  #code_kind1#  
			  and  code_certifi  	=  #code_certifi1#
			  and  code_seq  		=  #code_seq1#
			  and  code_bran  	=  #code_bran1#
			  and  bran_seq  	=  #bran_seq1#
			  and  receipt_no  	=  #receipt_no1#
			  and  add_file_no	=  #add_file_no#
	</delete>

	<select id="selectBFiles" resultClass="java.util.HashMap">
		SELECT ISNULL(add_file_1,'') add_file_1
			 , ISNULL(add_file_2,'') add_file_2
			 , ISNULL(add_file_3,'') add_file_3
			 , ISNULL(add_file_4,'') add_file_4
			 , ISNULL(add_file_5,'') add_file_5
			 , convert(varchar, DATEADD(year,+3,convert(date,a.result_dt)),112)+'_'+c.CERTIFI_name detcode
			 , b.pers_name , b.pers_birth, b.lic_no
		  FROM result_print a
			   left join certifi c on c.code_certifi = a.code_certifi
			   left join Person_M_TBL b on a.code_pers = b.code_pers
		 WHERE a.code_pers 		=  #code_pers1#  
		   and a.code_certifi  	=  #code_certifi1#
		   and a.result_no  		=  #result_no1#
		   and a.code_seq  		=  #code_seq1#
		   
	</select>
	
	<update  id="upBFiles" parameterClass="java.util.HashMap">
		UPDATE result_print 
		   SET add_file_1	=  #add_file_1#	
			 , add_file_2	=  #add_file_2#
			 , add_file_3	=  #add_file_3#
			 , add_file_4	=  #add_file_4#
		 WHERE code_pers 	=  #code_pers1#  
		   and code_certifi	=  #code_certifi1#
		   and result_no  	=  #result_no1#
		   and code_seq  	=  #code_seq1#   
	</update>
	
	<update id="deletBFiles" parameterClass="java.util.HashMap">
		   UPDATE result_print
		      set add_file_2='' 
			WHERE  code_pers 		=  #code_pers1#  
			  and  code_certifi  	=  #code_certifi1#
			  and  result_no  		=  #result_no1#
			  and  code_seq  		=  #code_seq1#
			  
	</update>   

<!-- 공통코드 조회 SELECT -->
<select id="sCodeExcel1" resultClass="java.util.HashMap">
	SELECT groupcode
     		 , detcode
     		 , detcodename
     FROM com_code
   WHERE groupcode in ('016','022','023','025','034','035')
     AND use_yn = 'Y'
   ORDER BY groupcode, cdseq, detcode
</select>
<!--시험별응시현황 엑셀올리기 등록된 동일인이 있는지 확인 -->
<select id="SelectOperater1" resultClass="java.util.HashMap">
            select isnull(max(receipt_no),'') receipt_no,
<!--             	JUMIN_DEL -->
<!--             	[dbo].[GetPersNodecord](oper_no,'1') oper_no  -->
				oper_birth, oper_name
              from operater 
             where
<!--              	JUMIN_DEL -->
<!--              	[dbo].[GetPersNodecord](oper_no,'1') = #oper_no1#  -->
				oper_name = #oper_name1# and oper_birth = #oper_birth1#
               and code_kind+code_certifi+code_seq+code_bran+bran_seq = left(#edutest_name1#,11)
             group by
<!--              	JUMIN_DEL -->
<!--              	[dbo].[GetPersNodecord](oper_no,'1')  -->
				oper_name, oper_birth
	</select>
<!-- 이름/생년월일로 회원정보 읽어 오기 -->
<select id="SelectPersonMtbl1" resultClass="java.util.HashMap">
		select a.pers_name,
<!-- 				JUMIN_DEL -->
<!-- 				[dbo].[GetPersNodecord](a.pers_no,'1') pers_no, -->
				a.pers_birth,
				a.lic_no, a.pers_hp, a.email, a.code_email_comp, 
		       case when isnull(b.code_post,'') = '' then isnull(a.code_post,'') else b.code_post end code_post, 
		       isnull(b.company_name,'') company_name, 
		       case when isnull(b.comp_add,'') = '' then RTRIM(a.pers_add)+' '+RTRIM(a.pers_add_detail) else b.comp_add end comp_add,
		       isnull(a.code_pers,'') code_pers, 
		       isnull(b.code_use,'') code_use, 
		       isnull(b.trust_name,'') trust_name, 
		       isnull(b.code_great,'') code_great, 
		       case when isnull(b.company_tel,'') = '' then isnull(a.pers_tel,'') else isnull(b.company_tel,'') end company_tel
		from Person_M_TBL a 
		     left join ( select z.code_pers, max(z.company_name) company_name, max(z.code_post) code_post, 
		                        RTRIM(max(z.company_add))+' '+RTRIM(max(z.company_add_detail)) comp_add,
		                        max(z.company_tel) company_tel, max(z.code_great) code_great, 
		                        max(z.code_use) code_use, max(z.trust_name) trust_name
		                   from pers_company z
		                  where z.primary_flag = '1'
		                    and z.comp_seq = (select MAX(comp_seq) 
		                                        from pers_company
		                                       where code_pers = z.code_pers
		                                         and primary_flag = '1')
		                                       group by code_pers )b on b.code_pers = a.code_pers
		where
<!-- 			JUMIN_DEL -->
<!-- 			[dbo].[GetPersNodecord](a.pers_no,'1') = #oper_no1# -->
			a.pers_name = #oper_name1# and a.pers_birth = #oper_birth1#
	</select>
<!-- 시험별응시현황 update -->
	<update id="updatelicense" parameterClass="java.util.HashMap">
		update operater
		set 
		  oper_name 		= #oper_name1#
<!-- 		  JUMIN_DEL -->
<!-- 		, oper_no 			= [dbo].[GetPersNoencord](#oper_no1#) -->
		, oper_birth 			= #oper_birth1#
		, oper_lic_no 		= #oper_lic_no1#
		, oper_hp 			= #oper_hp1#
		, code_operation 	= #code_operation1#
		, oper_comp_name1	= #oper_comp_name11#
		, code_pay_flag		= #code_pay_flag1#
		, oper_email		= #oper_email1#
		, oper_state		= #oper_state1#
		, register			= #register1#
		, regi_date			= getdate()
		where code_kind = #code_kind1# and code_certifi = #code_certifi1# and code_seq =#code_seq1# 
				and code_bran = #code_bran1# and bran_seq = #bran_seq1# and receipt_no= #receipt_no1#
	</update>
	
	<!--시험별 응시현황 insert --> 
	<insert id="insertlicense" parameterClass="java.util.HashMap">
		INSERT INTO operater
	    (code_kind, code_certifi, code_seq, code_bran, bran_seq, receipt_no, oper_name,
<!-- 	    	JUMIN_DEL -->
<!-- 	    	oper_no, -->
	    	oper_birth,
	    	oper_lic_no, oper_hp
		   ,oper_email, code_operation, oper_comp_name1, oper_comp_add1_2
		   ,receipt_dt,code_pay_flag, bank_name, oper_account, person_yn, oper_state, register, regi_date, code_use, trust_name, code_great, company_tel)
	VALUES (#code_kind1#
	    ,#code_certifi1#
	    ,#code_seq1#
	    ,#code_bran1#
	    ,#bran_seq1#
	    ,(select right('0000'+convert(varchar,convert(int,isnull(MAX(receipt_no),0))+1),4) 
		   from operater where code_kind = #code_kind1# and code_certifi =#code_certifi1# and code_seq =#code_seq1# and code_bran =#code_bran1#
		   and bran_seq = #bran_seq1#)
	    ,#oper_name1#
<!-- 	    JUMIN_DEL -->
<!-- 	    ,[dbo].[GetPersNoencord](#oper_no1#) -->
	    ,#oper_lic_birth1#
	    ,#oper_lic_no1#
	    ,#oper_hp1#
	    ,#oper_email1#
	    ,#code_operation1#
	    ,#oper_comp_name11#
	    ,#oper_comp_add1_21#
	    ,convert(varchar,getdate(),112)
	    ,#code_pay_flag1#
	    ,#bank_name1#
	    ,#oper_account1#
	    ,#person_yn1#
	    ,#oper_state1#
	    ,#register1#
	    ,getdate()
	    , #code_use1#
	    , #trust_name1#
	    , #code_great1#
	    , #company_tel1#
	   )	
	</insert> 

<!--결과등록  insert --> 
	<delete id="deletresult" parameterClass="java.util.HashMap">
		DELETE oper_result 
		where code_kind 	= #code_kind1# 
		  and code_certifi  = #code_certifi1# 
		  and code_seq 		= #code_seq1# 
		  and code_bran 	= #code_bran1# 
		  and bran_seq 		= #bran_seq1#  
		  and receipt_no	= #receipt_no1#
	</delete>
<!--결과등록-->
	<insert id="insertresult" parameterClass="java.util.HashMap">
	INSERT INTO oper_result
           (code_kind 
           ,code_certifi 
           ,code_seq 
           ,code_bran 
           ,bran_seq 
           ,receipt_no
           ,edu_marks
           ,attend_cnt
           ,time_cnt 
           ,result_point 
           ,result_state 
           ,up_date
           ,updater)
     VALUES
           (#code_kind1#
           ,#code_certifi1#
           ,#code_seq1#
           ,#code_bran1#
           ,#bran_seq1#
           ,#receipt_no1#
           ,#edu_marks1#
           ,#attend_cnt1#
           ,#time_cnt1#
           ,#result_point1#
           ,#result_state1#
           ,GETDATE()
           ,#g_name#)
	</insert>


<!-- ************************************************************************************** -->
		
		<!--자격증 갱신 페이지 count -->
	<select id="renewalsendcnt" resultClass="java.util.HashMap">
    SELECT count(*) cnt
        FROM (

			<!-- 무교육자 쿼리 추가 [START] -->
			select
				CONVERT(VARCHAR, Isnull(kk.code_certifi, '0')) + CONVERT(VARCHAR, Isnull(kk.code_pers, '0')) + CONVERT(VARCHAR, Isnull(kk.code_seq, '0')) + CONVERT(VARCHAR, Isnull(kk.result_no, '0')) AS detcode,
				crtf.certifi_name code_certifi,
				kk.code_seq code_seq,
				kk.result_no,
				kk.code_pers,
				Isnull(kk2.oper_birth,'') oper_birth,
				Isnull(kk2.oper_lic_no,'') oper_lic_no,
				Isnull(kk2.oper_name,'') oper_name,
				Isnull(kk.result_start_dt,'') result_start_dt,
				Isnull(kk.result_end_dt,'') result_end_dt,
				''oper_state,
				Isnull(kk2.code_post,'') code_post,
				Isnull(kk2.oper_comp_add1_1,'') oper_comp_add1_1,
				Isnull(kk.result_dt,'') result_dt,
				Isnull(m.detcodename,'') prtstateh,
				Isnull(kk.print_state,'') prtstatec,
				Isnull(kk2.oper_comp_name1,'') oper_comp_name1,
				Isnull(kk2.oper_hp,'') oper_hp,
				Isnull(kk2.oper_email,'') oper_email,
				Isnull(kk2.member,'') member,
				Isnull(kk2.docname,'') docname,
				Isnull(kk2.col1,0) col1,
				Isnull(kk2.col2,0) col2,
				Isnull(kk2.col3,0) col3,
				Isnull(kk2.col1,0) +Isnull(kk2.col2,0) +Isnull(kk2.col3,0) total_marks,
				Row_number() OVER( ORDER BY pp.pers_name, kk.code_certifi, kk.result_no, kk.code_pers ) ncount
			from (select * from result_print where
					/* 발급년도  */
					/* 반기 동일 조건  */
					<isNotEmpty property="selA">
							<isNotEmpty property="season1">
								result_end_dt between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'1231'  /*전반기 조회시*/
							</isNotEmpty>
							<isNotEmpty property="season2">
								result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
							</isNotEmpty>
					</isNotEmpty>

					/*print_state가 발급인 경우*/
					<isNotEmpty property="selB">
						result_dt like convert(varchar,convert(int,#yyyy1#))+replace(#mm1#,' ','')+replace(#dd1#,' ','')+'%'
					</isNotEmpty>
				) kk
			left join person_m_tbl pp on kk.code_pers = pp.code_pers
			left join certifi crtf on crtf.code_certifi = kk.code_certifi
			left join com_code m on m.groupcode = '024' and m.detcode = kk.print_state
			left join ( 
			<!-- 무교육자 쿼리 추가 [END] -->

			SELECT  convert(varchar,isnull(code_certifi,'0'))
				 +convert(varchar,isnull(code_pers,'0'))
				 +convert(varchar,isnull(result_no,'0')) as detcode	
				 , code_certifi
				 , zz.code_certifi codecertifi
			     , result_no
			     , code_pers
<!-- 			     JUMIN_DEL -->
<!-- 			      ,case when #check# = '1'  -->
<!-- 							  then [dbo].[GetPersNoDecord](max(oper_no) , '1') -->
<!-- 					      when #check# = '2'  -->
<!-- 							  then [dbo].[GetPersNoDecord](max(oper_no) , '2')   -->
<!-- 						  when #check# = '3' -->
<!-- 						      then [dbo].[GetPersNoDecord](max(oper_no) , '3') -->
<!-- 						  else [dbo].[GetPersNoDecord](max(oper_no) , '3') end oper_no   /*주민등록번호 */ -->
						  
				 , max(oper_birth) oper_birth
				 , oper_lic_no oper_lic_no
				 , isnull(max(oper_name),'') oper_name
			     , isnull(max(result_start_dt),'') result_start_dt
				 , isnull(max(result_end_dt),'') result_end_dt
				 , '' oper_state
				 , ISNULL(max(code_post), '') code_post
				 , isnull(max(oper_comp_add1_1),'') oper_comp_add1_1
				 , isnull(max(result_dt),'') result_dt
				 , isnull(max(prtstateh),'') prtstateh
				 , isnull(max(prtstatec),'') prtstatec
				 , ISNULL(max(oper_comp_name1),'') oper_comp_name1
				 , isnull(max(oper_hp),'') oper_hp
				 , isnull(max(oper_email),'') oper_email
				 , ISNULL(max(member), '') member
				 , ISNULL(max(docname),'') docname
				 , SUM(ISNULL(col1,0)) col1
				 , SUM(ISNULL(col2,0)) col2
				 , SUM(isnull(col3,0)) col3 
				 , SUM(ISNULL(col1,0)+ISNULL(col2,0)+ISNULL(col3,0)) total_marks
			     , ROW_NUMBER()OVER(ORDER BY max(oper_name)
				                            , code_certifi
				                            , result_no
				                            , code_pers
				                            , oper_lic_no ) ncount
				 , max(code_seq) code_seq
			from (
			SELECT a.code_certifi
			     , a.result_no
				 , a.code_pers
				 , max(a.code_seq) code_seq
<!-- 				 JUMIN_DEL -->
<!-- 			     , c.oper_no -->
			     , c.oper_birth
				 , c.oper_lic_no
				 , max(c.oper_name) oper_name
			     , a.result_start_dt
				 , a.result_end_dt
				 , c.code_post
				 , isnull((c.pers_add),'') oper_comp_add1_1
				 , max(a.result_dt) result_dt
				 , max(m.detcodename) prtstateh
				 , max(a.print_state) prtstatec
				 , max(c.oper_comp_name1) oper_comp_name1
				 , max(c.oper_hp) oper_hp
				 , max(c.oper_email) oper_email
				 , max(c.member) member
				 , max(b.detcodename) docname
				 , SUM(ISNULL(col1,0)) col1
				 , SUM(ISNULL(col2,0)) col2
				 , case when SUM(isnull(col3,0)) >= 4 then 4 else SUM(isnull(col3,0)) end col3 
			  FROM result_print a
					  left join com_code m
						     on m.groupcode = '024'
						    and m.detcode = a.print_state
					  left join (select  x.code_pers, x.code_certifi, x.result_no, x.code_seq,
										replace(replace(ISNULL(x.신청서,' ')
													+','+ISNULL(x.사진,' ')
													+','+ISNULL(x.영양사면허증사본,' ')
													+','+ISNULL(x.발급회비,' '), ' ,',''),', ','') detcodename
								  from (           
										select * from (
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_1,'') != '' then '신청서' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_2,'') != '' then '사진' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_3,'') != '' then '영양사면허증사본' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_4,'') != '' then '발급회비' else '' end detcodename
														 from result_print     
													   ) z
										pivot (max(z.detcodename) for z.detcodename 
										   in ([신청서]
											  ,[사진]
											  ,[영양사면허증사본]
											  ,[발급회비])
											  ) as pvt
										) x
							   ) b 
							   on b.code_pers = a.code_pers 
							  and b.code_certifi = a.code_certifi
							  and b.code_seq = a.code_seq
							  and b.result_no = a.result_no
				 , (SELECT a.oper_name
<!-- 				 		JUMIN_DEL -->
<!-- 						 , a.oper_no -->
						 , a.oper_birth
				 		 , a.oper_lic_no
				         , a.oper_comp_name1
						 , a.oper_hp
						 , a.oper_email
						 , p.member
						 , p.code_post
						 , p.pers_add
				         , case when g.outside_yn='N' then isnull(c.edu_marks,0) else 0 end col1
						 , case when g.outside_yn='Y' then isnull(c.edu_marks,0) else 0 end col2
						 , isnull(c.service_marks,0) col3
						 , a.person_yn code_pers
						 , f.oper_end_dt
						 , c.point_manage code_certifi, c.result_state			     
					 FROM operater a 							
						  left join (select  w.code_pers
										   , w.code_post
										   , w.pers_add
										   , cq.detcodename + '(' + cw.detcodename + ')' member
									  from Person_M_TBL w
										   left join com_code cq on cq.groupcode = '006' 
												and cq.detcode = w.code_member
										   left join com_code cw on cw.groupcode = '021' 
												and cw.detcode = w.pers_state ) p 
												on p.code_pers = a.person_yn 
						  left join oper_result c 
								 on c.code_kind = a.code_kind 
								and c.code_certifi = a.code_certifi
								and c.code_seq = a.code_seq
								and c.code_bran = a.code_bran
								and c.bran_seq = a.bran_seq
								and c.receipt_no = a.receipt_no	
						 , edu_test f
						  left join edu_test_name g
								 on g.code_kind = f.code_kind
								and g.code_certifi = f.code_certifi
								and g.code_seq = f.code_seq					        
					WHERE a.code_kind = f.code_kind
					  AND a.code_certifi = f.code_certifi
					  AND a.code_seq = f.code_seq
					  AND a.code_bran = f.code_bran
					  AND a.bran_seq = f.bran_seq
					  AND f.code_kind IN ('2')
				    ) c 
			WHERE a.code_pers = c.code_pers
			  and a.code_certifi = c.code_certifi 
			  and c.oper_end_dt between DATEADD(DAY,+1,DATEADD(year,-3,convert(date,a.result_end_dt))) 
			  and DATEADD(year,-2,convert(date,a.result_end_dt))
			  and c.result_state = '11'
			/* 발급상태  */
			<dynamic prepend="and">
				<isNotEmpty property="print_state1">
					a.print_state = #print_state1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
			/* 자격증번호  */
			<dynamic prepend="and">
				<isNotEmpty property="result_no1">
					a.result_no = #result_no1#
				</isNotEmpty>
			</dynamic>
<!-- 			JUMIN_DEL -->
<!-- 			/* 주민번호 동일 조건  */ -->
<!-- 			<dynamic prepend="and"> -->
<!-- 				<isNotEmpty property="oper_no1"> -->
<!-- 					c.oper_no like #oper_no1#+'%' -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			/* 생년월일 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_birth1">
					c.oper_birth like #oper_birth1#+'%'
				</isNotEmpty>
			</dynamic>
			/* 이름 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_name1">
					c.oper_name like '%'+#oper_name1#+'%'
				</isNotEmpty>
			</dynamic>
				/* 발급년도  */
<!-- 			<dynamic prepend="and">					 -->
<!-- 				<isNotEmpty property="selA"> -->
<!-- 					/* 반기 동일 조건  */ -->
<!-- 						<isNotEmpty property="season1"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*전반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 						<isNotEmpty property="season2"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			
				/* 반기 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="selA">
						<isNotEmpty property="season1">
							a.result_end_dt between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'1231'  /*전반기 조회시*/
						</isNotEmpty>
						<isNotEmpty property="season2">
							a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
						</isNotEmpty>
				</isNotEmpty>
			</dynamic> 

			/*print_state가 발급인 경우*/
			<dynamic prepend="and">
				<isNotEmpty property="selB">
					a.result_dt like convert(varchar,convert(int,#yyyy1#))+replace(#mm1#,' ','')+replace(#dd1#,' ','')+'%'
				</isNotEmpty>
			</dynamic>
						
			<dynamic prepend="and">
			<isNotEmpty property="person_yns">
				c.code_pers in (
				<iterate property="person_yns" open="" conjunction="," close="">
				#person_yns[]#
				</iterate>		
				)
			</isNotEmpty>
			</dynamic>
						
			GROUP BY a.code_certifi
				   , a.result_no
				   , a.code_pers
<!-- 				   JUMIN_DEL -->
<!-- 				   , c.oper_no -->
				   , c.oper_birth
				   , c.oper_lic_no
			       , a.result_start_dt
				   , a.result_end_dt
				   , c.code_post
				   , c.pers_add
			union all
			SELECT a.code_certifi
			       , a.result_no
				   , a.code_pers
				   , max(a.code_seq) code_seq
<!-- 				   JUMIN_DEL -->
<!-- 			       , c.oper_no -->
			       , c.oper_birth
				   , c.oper_lic_no
				   , max(c.oper_name) 
			       , a.result_start_dt
				   , a.result_end_dt
				   , c.code_post
				   , isnull((c.pers_add),'') oper_comp_add1_1
				   , max(a.result_dt) result_dt
				   , max(m.detcodename) prtstateh
				   , max(a.print_state) prtstatec
				   , max(c.oper_comp_name1) oper_comp_name1
				   , max(c.oper_hp) oper_hp
				   , max(c.oper_email) oper_email
				   , max(c.member) member
				   , max(b.detcodename) codeoperation
				   , SUM(ISNULL(col1,0)) col1
				   , SUM(ISNULL(col2,0)) col2
				   , case when SUM(isnull(col3,0)) >= 4 then 4 else SUM(isnull(col3,0)) end col3 
			  FROM result_print a
					  left join com_code m
						     on m.groupcode = '024'
						    and m.detcode = a.print_state
					  left join (select  x.code_pers, x.code_certifi, x.result_no, x.code_seq,
										replace(replace(ISNULL(x.신청서,' ')
													+','+ISNULL(x.사진,' ')
													+','+ISNULL(x.영양사면허증사본,' ')
													+','+ISNULL(x.발급회비,' '), ' ,',''),', ','') detcodename
								  from (           
										select * from (
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_1,'') != '' then '신청서' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_2,'') != '' then '사진' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_3,'') != '' then '영양사면허증사본' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_4,'') != '' then '발급회비' else '' end detcodename
														 from result_print     
													   ) z
										pivot (max(z.detcodename) for z.detcodename 
										   in ([신청서]
											  ,[사진]
											  ,[영양사면허증사본]
											  ,[발급회비])
											  ) as pvt
										) x
							   ) b 
							   on b.code_pers = a.code_pers 
							  and b.code_certifi = a.code_certifi
							  and b.code_seq = a.code_seq
							  and b.result_no = a.result_no
				 , (SELECT a.oper_name
<!-- 				 JUMIN_DEL -->
<!-- 				   , a.oper_no -->
				   , a.oper_birth
				   , a.oper_lic_no
				   , a.oper_comp_name1
				   , a.oper_hp
				   , a.oper_email
				   , p.member
				   , p.code_post
				   , p.pers_add
				   , case when g.outside_yn='N' then isnull(c.edu_marks,0) else 0 end col1
				   , case when g.outside_yn='Y' then isnull(c.edu_marks,0) else 0 end col2
				   , isnull(c.service_marks,0) col3
				   , a.person_yn code_pers
				   , f.oper_end_dt
				   , c.point_manage code_certifi, c.result_state
					 FROM operater a 							
						  left join (select  w.code_pers
										   , w.code_post
										   , w.pers_add
										   , cq.detcodename + '(' + cw.detcodename + ')' member
									  from Person_M_TBL w
										   left join com_code cq on cq.groupcode = '006' 
												and cq.detcode = w.code_member
										   left join com_code cw on cw.groupcode = '021' 
												and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn 
						  left join oper_result c 
								 on c.code_kind = a.code_kind 
								and c.code_certifi = a.code_certifi
								and c.code_seq = a.code_seq
								and c.code_bran = a.code_bran
								and c.bran_seq = a.bran_seq
								and c.receipt_no = a.receipt_no	
						 , edu_test f
						  left join edu_test_name g
								 on g.code_kind = f.code_kind
								and g.code_certifi = f.code_certifi
								and g.code_seq = f.code_seq					        
					WHERE a.code_kind = f.code_kind
					  AND a.code_certifi = f.code_certifi
					  AND a.code_seq = f.code_seq
					  AND a.code_bran = f.code_bran
					  AND a.bran_seq = f.bran_seq
					  AND f.code_kind IN ('2')
				    ) c 
			WHERE a.code_pers = c.code_pers
			  and a.code_certifi = c.code_certifi 
			  and c.oper_end_dt between DATEADD(DAY,+1,DATEADD(year,-2,convert(date,a.result_end_dt))) 
			  and DATEADD(year,-1,convert(date,a.result_end_dt))
			  and c.result_state = '11' 
			/* 발급상태  */
			<dynamic prepend="and">
				<isNotEmpty property="print_state1">
					a.print_state = #print_state1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
			/* 자격증번호  */
			<dynamic prepend="and">
				<isNotEmpty property="result_no1">
					a.result_no = #result_no1#
				</isNotEmpty>
			</dynamic>
<!-- 			JUMIN_DEL -->
<!-- 			/* 주민번호 동일 조건  */ -->
<!-- 			<dynamic prepend="and"> -->
<!-- 				<isNotEmpty property="oper_no1"> -->
<!-- 					c.oper_no like #oper_no1#+'%' -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			/* 생년월일 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_birth1">
					c.oper_birth like #oper_birth1#+'%'
				</isNotEmpty>
			</dynamic>
			/* 이름 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_name1">
					c.oper_name like '%'+#oper_name1#+'%'
				</isNotEmpty>
			</dynamic>
				/* 발급년도  */
<!-- 			<dynamic prepend="and"> -->
<!-- 				<isNotEmpty property="selA">					 -->
<!-- 					/* 반기 동일 조건  */ -->
<!-- 						<isNotEmpty property="season1"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*전반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 						<isNotEmpty property="season2"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			
				/* 반기 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="selA">
						<isNotEmpty property="season1">
							a.result_end_dt between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'1231'  /*전반기 조회시*/
						</isNotEmpty>
						<isNotEmpty property="season2">
							a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
						</isNotEmpty>
				</isNotEmpty>
			</dynamic> 

			/*print_state가 발급인 경우*/
			<dynamic prepend="and">
				<isNotEmpty property="selB">
					a.result_dt like convert(varchar,convert(int,#yyyy1#))+replace(#mm1#,' ','')+replace(#dd1#,' ','')+'%'
				</isNotEmpty>
			</dynamic>
						
			<dynamic prepend="and">
			<isNotEmpty property="person_yns">
				c.code_pers in (
				<iterate property="person_yns" open="" conjunction="," close="">
				#person_yns[]#
				</iterate>		
				)
			</isNotEmpty>
			</dynamic>
						
			GROUP BY a.code_certifi
					, a.result_no
					, a.code_pers
<!-- 					JUMIN_DEL -->
<!-- 					, c.oper_no -->
					, c.oper_birth
					, c.oper_lic_no
			        , a.result_start_dt
					, a.result_end_dt
					, c.code_post
					, c.pers_add
			union all
			SELECT a.code_certifi
					, a.result_no
					, a.code_pers
				    , max(a.code_seq) code_seq
<!-- 				    JUMIN_DEL -->
<!-- 			        , c.oper_no -->
			        , c.oper_birth
					, c.oper_lic_no
					, max(c.oper_name) 
			        , a.result_start_dt
					, a.result_end_dt
					, c.code_post
					, isnull((c.pers_add),'') oper_comp_add1_1
					, max(a.result_dt) result_dt
					, max(m.detcodename) prtstateh
					, max(a.print_state) prtstatec
					, max(c.oper_comp_name1) oper_comp_name1
					, max(c.oper_hp) oper_hp
					, max(c.oper_email) oper_email
					, max(c.member) member
					, max(b.detcodename) codeoperation
					, SUM(ISNULL(col1,0)) col1
					, SUM(ISNULL(col2,0)) col2
					, case when SUM(isnull(col3,0)) >= 4 then 4 else SUM(isnull(col3,0)) end col3 
			  FROM result_print a
					  left join com_code m
						     on m.groupcode = '024'
						    and m.detcode = a.print_state
					  left join (select  x.code_pers, x.code_certifi, x.result_no, x.code_seq,
										replace(replace(ISNULL(x.신청서,' ')
													+','+ISNULL(x.사진,' ')
													+','+ISNULL(x.영양사면허증사본,' ')
													+','+ISNULL(x.발급회비,' '), ' ,',''),', ','') detcodename
								  from (           
										select * from (
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_1,'') != '' then '신청서' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_2,'') != '' then '사진' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_3,'') != '' then '영양사면허증사본' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_4,'') != '' then '발급회비' else '' end detcodename
														 from result_print     
													   ) z
										pivot (max(z.detcodename) for z.detcodename 
										   in ([신청서]
											  ,[사진]
											  ,[영양사면허증사본]
											  ,[발급회비])
											  ) as pvt
										) x
							   ) b 
							   on b.code_pers = a.code_pers 
							  and b.code_certifi = a.code_certifi
							  and b.code_seq = a.code_seq
							  and b.result_no = a.result_no
				 , (SELECT a.oper_name
<!-- 				 JUMIN_DEL -->
<!-- 				 	,a.oper_no -->
				 	,a.oper_birth
				    , a.oper_lic_no
			        , a.oper_comp_name1
					, a.oper_hp
					, a.oper_email
					, p.member
					, p.code_post
					, p.pers_add
		            , case when g.outside_yn='N' then isnull(c.edu_marks,0) else 0 end col1
				    , case when g.outside_yn='Y' then isnull(c.edu_marks,0) else 0 end col2
				    , isnull(c.service_marks,0) col3
				    , a.person_yn code_pers
					, f.oper_end_dt
				    , c.point_manage code_certifi, c.result_state			     
					 FROM operater a 						
						  left join (select  w.code_pers
											, w.code_post
											, w.pers_add
											, cq.detcodename + '(' + cw.detcodename + ')' member
									  from Person_M_TBL w
										   left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
										   left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn 
						  left join oper_result c 
								 on c.code_kind = a.code_kind 
								and c.code_certifi = a.code_certifi
								and c.code_seq = a.code_seq
								and c.code_bran = a.code_bran
								and c.bran_seq = a.bran_seq
								and c.receipt_no = a.receipt_no
						 , edu_test f
						  left join edu_test_name g
								 on g.code_kind = f.code_kind
								and g.code_certifi = f.code_certifi
								and g.code_seq = f.code_seq					        
					WHERE a.code_kind = f.code_kind
					  AND a.code_certifi = f.code_certifi
					  AND a.code_seq = f.code_seq
					  AND a.code_bran = f.code_bran
					  AND a.bran_seq = f.bran_seq 
					  AND f.code_kind IN ('2')
				    ) c 
			WHERE a.code_pers = c.code_pers
			  and a.code_certifi = c.code_certifi 
			  and c.oper_end_dt between DATEADD(DAY,+1,DATEADD(year,-1,convert(date,a.result_end_dt))) 
			  and convert(date,a.result_end_dt)
			  and c.result_state = '11' 
			/* 발급상태  */
			<dynamic prepend="and">
				<isNotEmpty property="print_state1">
					a.print_state = #print_state1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
			/* 자격증번호  */
			<dynamic prepend="and">
				<isNotEmpty property="result_no1">
					a.result_no = #result_no1#
				</isNotEmpty>
			</dynamic>
<!-- 			JUMIN_DEL -->
<!-- 			/* 주민번호 동일 조건  */ -->
<!-- 			<dynamic prepend="and"> -->
<!-- 				<isNotEmpty property="oper_no1"> -->
<!-- 					c.oper_no like #oper_no1#+'%' -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			/* 생년월일 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_birth1">
					c.oper_birth like #oper_birth1#+'%'
				</isNotEmpty>
			</dynamic>
			/* 이름 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_name1">
					c.oper_name like '%'+#oper_name1#+'%'
				</isNotEmpty>
			</dynamic>
			/* 면허번호 동일 조건  */
				/* 발급년도  */
<!-- 			<dynamic prepend="and"> -->
<!-- 				<isNotEmpty property="selA">					 -->
<!-- 					/* 반기 동일 조건  */ -->
<!-- 						<isNotEmpty property="season1"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*전반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 						<isNotEmpty property="season2"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			
				/* 반기 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="selA">
						<isNotEmpty property="season1">
							a.result_end_dt between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'1231'  /*전반기 조회시*/
						</isNotEmpty>
						<isNotEmpty property="season2">
							a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
						</isNotEmpty>
				</isNotEmpty>
			</dynamic> 

			/*print_state가 발급인 경우*/
			<dynamic prepend="and">
				<isNotEmpty property="selB">
					a.result_dt like convert(varchar,convert(int,#yyyy1#))+replace(#mm1#,' ','')+replace(#dd1#,' ','')+'%'
				</isNotEmpty>
			</dynamic>
						
			<dynamic prepend="and">
			<isNotEmpty property="person_yns">
				c.code_pers in (
				<iterate property="person_yns" open="" conjunction="," close="">
				#person_yns[]#
				</iterate>		
				)
			</isNotEmpty>
			</dynamic>
						
		GROUP BY a.code_certifi
				, a.result_no
				, a.code_pers
<!-- 				JUMIN_DEL -->
<!-- 				, c.oper_no -->
				, c.oper_birth
				, c.oper_lic_no
		        , a.result_start_dt
				, a.result_end_dt
				, c.code_post
				, c.pers_add
		) zz
		GROUP BY code_certifi
				, result_no
				, code_pers
				, oper_lic_no
  
		<!-- 무교육자 쿼리 추가 [START] -->
		)kk2 on kk.code_pers = kk2.code_pers and kk.code_certifi = kk2.codecertifi and kk.result_no = kk2.result_no and kk.code_seq = kk2.code_seq
		
			where 1=1
			/*19.03.06 사망자 제외*/
			and pp.pers_state != '02'
			/* 발급상태  */
			<dynamic prepend="and">
				<isNotEmpty property="print_state1">
					kk.print_state = #print_state1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					kk.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
			/* 자격증번호  */
			<dynamic prepend="and">
				<isNotEmpty property="result_no1">
					kk.result_no = #result_no1#
				</isNotEmpty>
			</dynamic>
			/* 생년월일 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_birth1">
					pp.pers_birth like #oper_birth1#+'%'
				</isNotEmpty>
			</dynamic>
			/* 이름 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_name1">
					pp.pers_name like '%'+#oper_name1#+'%'
				</isNotEmpty>
			</dynamic>
						
			<dynamic prepend="and">
			<isNotEmpty property="person_yns">
				kk.code_pers in (
				<iterate property="person_yns" open="" conjunction="," close="">
				#person_yns[]#
				</iterate>		
				)
			</isNotEmpty>
			</dynamic>
		
		<!-- 무교육자 쿼리 추가 [END] -->
	
	)sout
	</select>


<!--************************************************************************************************** -->

	<!--자격증 갱신 페이지 출력  엑셀저장-->
	<select id="selectrenewal" resultClass="java.util.HashMap">
	select *, case when renewalok = 'PASS' and marksok = 'PASS' then 'PASS' else 'NG' end totalok from (
	
    select sout2.*
	 , case when result_start_dt<![CDATA[>=]]>auth_start2 
            and result_start_dt<![CDATA[<=]]>auth_end2
           then isnull(replace(auth_end0+'~'+auth_start0+' / '+ auth_end1 +'~'+auth_start1+' / '+ auth_end2 +'~'+auth_start2,'~ / ',''),'') 
           when result_start_dt<![CDATA[>=]]>auth_start3 
            and result_start_dt<![CDATA[<=]]>auth_end3
           then isnull(replace(auth_end0+'~'+auth_start0+' / '+ auth_end1 +'~'+auth_start1+' / '+ auth_end2 +'~'+auth_start2+' / '+ auth_end3 +'~'+auth_start3,'~ / ',''),'')
           end renewalbt
    , case when date_diff1 > 0 and date_diff1 != 99999 then convert(varchar,date_diff1)
           when date_diff1 = 99999 
             or isnull(replace(auth_end0+'~'+auth_start0
                       +' / '+ auth_end1 +'~'+auth_start1
                       +' / '+ auth_end2 +'~'+auth_start2
                       +' / '+ auth_end3 +'~'+auth_start3,'~ / ',''),'') = '' then 'NG'
           else 'PASS' end renewalok
    , case when col1 >= 8 and total_marks >= 20 then 'PASS' else 'NG' end marksok
	from
	(select sout.* 
	        , auth_end0
	        , auth_end1
	        , auth_end2
	        , auth_end3
	        , auth_start0
	        , auth_start1
	        , auth_start2
	        , auth_start3        
	         , case when result_start_dt<![CDATA[>=]]>auth_start2 
	                 and result_start_dt<![CDATA[<=]]>auth_end2
	                 and ISNULL(auth_end2,'') != '' 
	                 and ISNULL(auth_end1,'') != '' 
	                 and ISNULL(auth_end0,'') != ''
					<!-- <isNotEmpty property="selA"><isNotEmpty property="season2">and Isnull(auth_end0, '') >= #yyyy1#+'0801'</isNotEmpty></isNotEmpty> -->
					 and result_end_dt<![CDATA[<=]]>Isnull(auth_end0, '') 
				    then datediff(dd,auth_end2,auth_start1) + datediff(dd,auth_end1,auth_start0) -2

										 WHEN result_start_dt >= auth_start2
										 AND       result_start_dt <![CDATA[<=]]> auth_end2
										 AND       Isnull(auth_end2, '') != ''
										 AND       Isnull(auth_end0, '') != ''
										 and result_end_dt<![CDATA[<=]]>Isnull(auth_end0, '') 
										 THEN Datediff(dd, auth_end2, auth_start0) - 1

				    when result_start_dt<![CDATA[>=]]>rr.auth_start3 
	                 and result_start_dt<![CDATA[<=]]>rr.auth_end3
	                 and ISNULL(auth_end3,'') != ''
	                 and ISNULL(auth_end2,'') != '' 
	                 and ISNULL(auth_end1,'') != '' 
	                 and ISNULL(auth_end0,'') != ''  
	                 and result_end_dt<![CDATA[<=]]>Isnull(auth_end0, '') 
				    then datediff(dd,auth_end3,auth_start2) + datediff(dd,auth_end2,auth_start1) + datediff(dd,auth_end1,auth_start0) -3

										 WHEN result_start_dt >= rr.auth_start3
										 AND       result_start_dt <![CDATA[<=]]> rr.auth_end3
										 AND       Isnull(auth_end3, '') != ''
										 AND       Isnull(auth_end2, '') != ''
										 AND       Isnull(auth_end0, '') != ''
										 and result_end_dt<![CDATA[<=]]>Isnull(auth_end0, '') 
										 THEN Datediff(dd, auth_end3, auth_start2) + Datediff(dd, auth_end2, auth_start0) - 2
										 WHEN result_start_dt >= rr.auth_start3
										 AND       result_start_dt <![CDATA[<=]]> rr.auth_end3
										 AND       Isnull(auth_end3, '') != ''
										 AND       Isnull(auth_end1, '') != ''
										 AND       Isnull(auth_end0, '') != ''
										 and result_end_dt<![CDATA[<=]]>Isnull(auth_end0, '') 
										 THEN Datediff(dd, auth_end3, auth_start1) + Datediff(dd, auth_end1, auth_start0) - 2
										 WHEN result_start_dt >= rr.auth_start3
										 AND       result_start_dt <![CDATA[<=]]> rr.auth_end3
										 AND       Isnull(auth_end3, '') != ''
										 AND       Isnull(auth_end0, '') != ''
										 and result_end_dt<![CDATA[<=]]>Isnull(auth_end0, '') 
										 THEN Datediff(dd, auth_end3, auth_start0) - 1

					else 99999 end date_diff1
	  from (

			<!-- 무교육자 쿼리 추가 [START] -->
			select
				CONVERT(VARCHAR, Isnull(kk.code_certifi, '0')) + CONVERT(VARCHAR, Isnull(kk.code_pers, '0')) + CONVERT(VARCHAR, Isnull(kk.code_seq, '0')) + CONVERT(VARCHAR, Isnull(kk.result_no, '0')) AS detcode,
				crtf.certifi_name code_certifi,
				kk.code_certifi code_certifi_c,
				kk.code_seq code_seq,
				kk.result_no,
				kk.code_pers,
				Isnull(kk2.oper_birth,Isnull(pp.pers_birth,'')) oper_birth,
				Isnull(kk2.oper_lic_no,Isnull(pp.lic_no,'')) oper_lic_no,
				Isnull(kk2.oper_name,Isnull(pp.pers_name,'')) oper_name,
				Isnull(kk.result_start_dt,'') result_start_dt,
				Isnull(kk.result_end_dt,'') result_end_dt,
				''oper_state,
				Isnull(kk2.code_post,Isnull(cc.code_post,'')) code_post,
				Isnull(replace(kk2.oper_comp_add1_1,',',' '),Isnull(replace(ltrim(rtrim(cc.company_add+' '+cc.company_add_detail)),',',' '),'')) oper_comp_add1_1,
				Isnull(kk.result_dt,'') result_dt,
				Isnull(m.detcodename,'') prtstateh,
				Isnull(kk.print_state,'') prtstatec,
				Isnull(kk2.oper_comp_name1,Isnull(cc.company_name,'')) oper_comp_name1,
				Isnull(kk2.oper_hp,Isnull(pp.pers_hp,'')) oper_hp,
				Isnull(kk2.oper_email,Isnull((case when isnull(pp.code_email_comp,'') = '' or pp.code_email_comp = '01' then pp.email else rtrim(pp.email) + '@' + ii.detcodename end),'')) oper_email,
				Isnull(kk2.member,Isnull(cq.detcodename,'')) member,
				Isnull(kk2.docname,'') docname,
				Isnull(kk2.col1,0) col1,
				Isnull(kk2.col2,0) col2,
				Isnull(kk2.col3,0) col3,
				Isnull(kk2.col1,0) +Isnull(kk2.col2,0) +Isnull(kk2.col3,0) total_marks,
				Row_number() OVER( ORDER BY pp.pers_name, kk.code_certifi, kk.result_no, kk.code_pers ) ncount,
				kk2.ncount ncount_org
			from (select * from result_print where
					/* 발급년도  */
					/* 반기 동일 조건  */
					<isNotEmpty property="selA">
							<isNotEmpty property="season1">
								result_end_dt between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'1231'  /*전반기 조회시*/
							</isNotEmpty>
							<isNotEmpty property="season2">
								<!-- result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/ -->
								result_end_dt between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)))+'0101' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)))+'0731'  /*후반기 조회시*/
							</isNotEmpty>
					</isNotEmpty>

					/*print_state가 발급인 경우*/
					<isNotEmpty property="selB">
						result_dt like convert(varchar,convert(int,#yyyy1#))+replace(#mm1#,' ','')+replace(#dd1#,' ','')+'%'
					</isNotEmpty>
				) kk
			left join person_m_tbl pp on kk.code_pers = pp.code_pers
			left join certifi crtf on crtf.code_certifi = kk.code_certifi
			left join com_code m on m.groupcode = '024' and m.detcode = kk.print_state
			left join com_code cq on cq.groupcode = '006' and cq.detcode = pp.code_member
			left join pers_company cc on pp.code_pers=cc.code_pers and cc.primary_flag='1'
			left join com_code ii on ii.groupcode = '025' and ii.detcode = pp.code_email_comp
			left join ( 
			<!-- 무교육자 쿼리 추가 [END] -->

			SELECT  convert(varchar,isnull(zz.code_certifi,'0'))
				 + convert(varchar,isnull(code_pers,'0'))
				 + convert(varchar,isnull(code_seq,'0'))
				 + convert(varchar,isnull(result_no,'0')) as detcode	
				 , crtf.certifi_name code_certifi
                 , zz.code_certifi codecertifi
				 , code_seq code_seq
			     , result_no
			     , code_pers
<!-- 			     JUMIN_DEL -->
<!-- 			     , case   when #check# = '1'  -->
<!-- 							  then [dbo].[GetPersNoDecord](max(oper_no) , '1') -->
<!-- 					      when #check# = '2'  -->
<!-- 							  then [dbo].[GetPersNoDecord](max(oper_no) , '2')   -->
<!-- 						  when #check# = '3' -->
<!-- 						      then [dbo].[GetPersNoDecord](max(oper_no) , '3') -->
<!-- 						  else [dbo].[GetPersNoDecord](max(oper_no) , '3') end oper_no   /*주민등록번호 */ -->
				 , max(oper_birth) oper_birth
				 , oper_lic_no oper_lic_no
				 , isnull(max(oper_name),'') oper_name
			     , isnull(max(result_start_dt),'') result_start_dt
				 , isnull(max(result_end_dt),'') result_end_dt
				 , '' oper_state
				 , ISNULL(max(code_post), '') code_post
				 , isnull(max(oper_comp_add1_1),'') oper_comp_add1_1
				 , isnull(max(result_dt),'') result_dt
				 , isnull(max(prtstateh),'') prtstateh
				 , isnull(max(prtstatec),'') prtstatec
				 , ISNULL(max(oper_comp_name1),'') oper_comp_name1
				 , isnull(max(oper_hp),'') oper_hp
				 , isnull(max(oper_email),'') oper_email
				 , ISNULL(max(member), '') member
				 , ISNULL(max(docname),'') docname
				 , SUM(ISNULL(col1,0)) col1
				 , SUM(ISNULL(col2,0)) col2
				 , SUM(isnull(col3,0)) col3 
				 , SUM(ISNULL(col1,0)+ISNULL(col2,0)+ISNULL(col3,0)) total_marks
			     , ROW_NUMBER()OVER(ORDER BY max(oper_name)
				                            , zz.code_certifi
				                            , result_no
				                            , code_pers
				                            , oper_lic_no ) ncount
			from (
			SELECT a.code_certifi
			     , a.result_no
				 , a.code_pers
				 , max(a.code_seq) code_seq
<!-- 				 JUMIN_DEL -->
<!-- 			     , c.oper_no -->
				 , c.oper_birth
				 , c.oper_lic_no
				 , max(c.oper_name) oper_name
			     , a.result_start_dt
				 , a.result_end_dt
				 , c.code_post
				 , isnull((c.pers_add),'') oper_comp_add1_1
				 , max(a.result_dt) result_dt
				 , max(m.detcodename) prtstateh
				 , max(a.print_state) prtstatec
				 , max(c.oper_comp_name1) oper_comp_name1
				 , max(c.oper_hp) oper_hp
				 , max(c.oper_email) oper_email
				 , max(c.member) member
				 , max(b.detcodename) docname
				 , SUM(ISNULL(col1,0)) col1
				 , SUM(ISNULL(col2,0)) col2
				 , case when SUM(isnull(col3,0)) >= 4 then 4 else SUM(isnull(col3,0)) end col3 
			  FROM result_print a
					  left join com_code m
						     on m.groupcode = '024'
						    and m.detcode = a.print_state
					  left join (select  x.code_pers, x.code_certifi, x.result_no, x.code_seq,
										replace(replace(ISNULL(x.신청서,' ')
													+','+ISNULL(x.사진,' ')
													+','+ISNULL(x.영양사면허증사본,' ')
													+','+ISNULL(x.발급회비,' ')
													+','+ISNULL(x.압축파일,' '), ' ,',''),', ','') detcodename
								  from (           
										select * from (
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_1,'') != '' then '신청서' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_2,'') != '' then '사진' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_3,'') != '' then '영양사면허증사본' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_4,'') != '' then '발급회비' else '' end detcodename
														 from result_print  
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_5,'') != '' then '압축파일' else '' end detcodename
														 from result_print	    
													   ) z
										pivot (max(z.detcodename) for z.detcodename 
										   in ([신청서]
											  ,[사진]
											  ,[영양사면허증사본]
											  ,[발급회비]
											  ,[압축파일])
											  ) as pvt
										) x
							   ) b 
							   on b.code_pers = a.code_pers 
							  and b.code_certifi = a.code_certifi
							  and b.code_seq = a.code_seq
							  and b.result_no = a.result_no
				 , (SELECT a.oper_name
<!-- 				 		JUMIN_DEL -->
<!-- 						 , a.oper_no -->
				 		 , a.oper_birth
				 		 , a.oper_lic_no
				         , a.oper_comp_name1
						 , a.oper_hp
						 , a.oper_email
						 , p.member
						 , p.code_post
						 , p.pers_add
				         , case when g.outside_yn='N' then isnull(c.edu_marks,0) else 0 end col1
						 , case when g.outside_yn='Y' then isnull(c.edu_marks,0) else 0 end col2
						 , isnull(c.service_marks,0) col3
						 , a.person_yn code_pers
						 , f.oper_end_dt
						 , c.point_manage code_certifi, c.result_state			     
					 FROM operater a 							
						  left join (select  w.code_pers
										   , w.code_post
										   , w.pers_add
										   , cq.detcodename + '(' + cw.detcodename + ')' member
									  from Person_M_TBL w
										   left join com_code cq on cq.groupcode = '006' 
												and cq.detcode = w.code_member
										   left join com_code cw on cw.groupcode = '021' 
												and cw.detcode = w.pers_state ) p 
												on p.code_pers = a.person_yn 
						  left join oper_result c 
								 on c.code_kind = a.code_kind 
								and c.code_certifi = a.code_certifi
								and c.code_seq = a.code_seq
								and c.code_bran = a.code_bran
								and c.bran_seq = a.bran_seq
								and c.receipt_no = a.receipt_no
						 , edu_test f
						  left join edu_test_name g
								 on g.code_kind = f.code_kind
								and g.code_certifi = f.code_certifi
								and g.code_seq = f.code_seq					        
					WHERE a.code_kind = f.code_kind
					  AND a.code_certifi = f.code_certifi
					  AND a.code_seq = f.code_seq
					  AND a.code_bran = f.code_bran
					  AND a.bran_seq = f.bran_seq
					  AND f.code_kind IN ('2')
				    ) c 
			WHERE a.code_pers = c.code_pers
			  and a.code_certifi = c.code_certifi 
			  and c.oper_end_dt between DATEADD(DAY,+1,DATEADD(year,-3,convert(date,a.result_end_dt))) 
			  and DATEADD(year,-2,convert(date,a.result_end_dt))
			  and c.result_state = '11' 
			/* 발급상태  */
			<dynamic prepend="and">
				<isNotEmpty property="print_state1">
					a.print_state = #print_state1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
			/* 자격증번호  */
			<dynamic prepend="and">
				<isNotEmpty property="result_no1">
					a.result_no = #result_no1#
				</isNotEmpty>
			</dynamic>
<!-- 			JUMIN_DEL -->
<!-- 			/* 주민번호 동일 조건  */ -->
<!-- 			<dynamic prepend="and"> -->
<!-- 				<isNotEmpty property="oper_no1"> -->
<!-- 					c.oper_no like #oper_no1#+'%' -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			/* 생년월일 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_birth1">
					c.oper_birth like #oper_birth1#+'%'
				</isNotEmpty>
			</dynamic>
			/* 이름 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_name1">
					c.oper_name like '%'+#oper_name1#+'%'
				</isNotEmpty>
			</dynamic>
			
			/* 발급년도  */
<!-- 			<dynamic prepend="and">                					 -->
<!-- 				<isNotEmpty property="selA"> -->
<!-- 					/* 반기 동일 조건  */ -->
<!-- 						<isNotEmpty property="season1"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*전반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 						<isNotEmpty property="season2"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			
				/* 반기 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="selA">
						<isNotEmpty property="season1">
							a.result_end_dt between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'1231'  /*전반기 조회시*/
						</isNotEmpty>
						<isNotEmpty property="season2">
							a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
						</isNotEmpty>
				</isNotEmpty>
			</dynamic> 

			/*print_state가 발급인 경우*/
			<dynamic prepend="and">
				<isNotEmpty property="selB">
					a.result_dt like convert(varchar,convert(int,#yyyy1#))+replace(#mm1#,' ','')+replace(#dd1#,' ','')+'%'
				</isNotEmpty>
			</dynamic>
						
			<dynamic prepend="and">
			<isNotEmpty property="person_yns">
				c.code_pers in (
				<iterate property="person_yns" open="" conjunction="," close="">
				#person_yns[]#
				</iterate>		
				)
			</isNotEmpty>
			</dynamic>
						
			GROUP BY a.code_certifi
				   , a.result_no
				   , a.code_pers
<!-- 				   JUMIN_DEL -->
<!-- 				   , c.oper_no -->
				   , c.oper_birth
				   , c.oper_lic_no
			       , a.result_start_dt
				   , a.result_end_dt
				   , c.code_post
				   , c.pers_add
			union all
			SELECT a.code_certifi
			       , a.result_no
				   , a.code_pers
				   , max(a.code_seq) code_seq
<!-- 			       JUMIN_DEL -->
<!-- 			       , c.oper_no -->
			       , c.oper_birth
				   , c.oper_lic_no
				   , max(c.oper_name) 
			       , a.result_start_dt
				   , a.result_end_dt
				   , c.code_post
				   , isnull((c.pers_add),'') oper_comp_add1_1
				   , max(a.result_dt) result_dt
				   , max(m.detcodename) prtstateh
				   , max(a.print_state) prtstatec
				   , max(c.oper_comp_name1) oper_comp_name1
				   , max(c.oper_hp) oper_hp
				   , max(c.oper_email) oper_email
				   , max(c.member) member
				   , max(b.detcodename) codeoperation
				   , SUM(ISNULL(col1,0)) col1
				   , SUM(ISNULL(col2,0)) col2
				   , case when SUM(isnull(col3,0)) >= 4 then 4 else SUM(isnull(col3,0)) end col3 
			  FROM result_print a
					  left join com_code m
						     on m.groupcode = '024'
						    and m.detcode = a.print_state
					  left join (select  x.code_pers, x.code_certifi, x.result_no, x.code_seq,
										replace(replace(ISNULL(x.신청서,' ')
													+','+ISNULL(x.사진,' ')
													+','+ISNULL(x.영양사면허증사본,' ')
													+','+ISNULL(x.발급회비,' ')
													+','+ISNULL(x.압축파일,' '), ' ,',''),', ','') detcodename
								  from (           
										select * from (
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_1,'') != '' then '신청서' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_2,'') != '' then '사진' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_3,'') != '' then '영양사면허증사본' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_4,'') != '' then '발급회비' else '' end detcodename
														 from result_print
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_5,'') != '' then '압축파일' else '' end detcodename
														 from result_print       
													   ) z
										pivot (max(z.detcodename) for z.detcodename 
										   in ([신청서]
											  ,[사진]
											  ,[영양사면허증사본]
											  ,[발급회비]
											  ,[압축파일])
											  ) as pvt
										) x
							   ) b 
							   on b.code_pers = a.code_pers 
							  and b.code_certifi = a.code_certifi
							  and b.code_seq = a.code_seq
							  and b.result_no = a.result_no
				 , (SELECT a.oper_name
<!-- 				   JUMIN_DEL -->
<!-- 				   , a.oper_no -->
				   , a.oper_birth
				   , a.oper_lic_no
				   , a.oper_comp_name1
				   , a.oper_hp
				   , a.oper_email
				   , p.member
				   , p.code_post
				   , p.pers_add
				   , case when g.outside_yn='N' then isnull(c.edu_marks,0) else 0 end col1
				   , case when g.outside_yn='Y' then isnull(c.edu_marks,0) else 0 end col2
				   , isnull(c.service_marks,0) col3
				   , a.person_yn code_pers
				   , f.oper_end_dt
				   , c.point_manage code_certifi, c.result_state			     
					 FROM operater a 							
						  left join (select  w.code_pers
										   , w.code_post
										   , w.pers_add
										   , cq.detcodename + '(' + cw.detcodename + ')' member
									  from Person_M_TBL w
										   left join com_code cq on cq.groupcode = '006' 
												and cq.detcode = w.code_member
										   left join com_code cw on cw.groupcode = '021' 
												and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn 
						  left join oper_result c 
								 on c.code_kind = a.code_kind 
								and c.code_certifi = a.code_certifi
								and c.code_seq = a.code_seq
								and c.code_bran = a.code_bran
								and c.bran_seq = a.bran_seq
								and c.receipt_no = a.receipt_no
						 , edu_test f
						  left join edu_test_name g
								 on g.code_kind = f.code_kind
								and g.code_certifi = f.code_certifi
								and g.code_seq = f.code_seq					        
					WHERE a.code_kind = f.code_kind
					  AND a.code_certifi = f.code_certifi
					  AND a.code_seq = f.code_seq
					  AND a.code_bran = f.code_bran
					  AND a.bran_seq = f.bran_seq
					  AND f.code_kind IN ('2')
				    ) c 
			WHERE a.code_pers = c.code_pers
			  and a.code_certifi = c.code_certifi 
			  and c.oper_end_dt between DATEADD(DAY,+1,DATEADD(year,-2,convert(date,a.result_end_dt))) 
			  and DATEADD(year,-1,convert(date,a.result_end_dt))
			  and c.result_state = '11' 
			/* 발급상태  */
			<dynamic prepend="and">
				<isNotEmpty property="print_state1">
					a.print_state = #print_state1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
			/* 자격증번호  */
			<dynamic prepend="and">
				<isNotEmpty property="result_no1">
					a.result_no = #result_no1#
				</isNotEmpty>
			</dynamic>
<!-- 			JUMIN_DEL -->
<!-- 			/* 주민번호 동일 조건  */ -->
<!-- 			<dynamic prepend="and"> -->
<!-- 				<isNotEmpty property="oper_no1"> -->
<!-- 					c.oper_no like #oper_no1#+'%' -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			/* 생년월일 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_birth1">
					c.oper_birth like #oper_birth1#+'%'
				</isNotEmpty>
			</dynamic>
			/* 이름 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_name1">
					c.oper_name like '%'+#oper_name1#+'%'
				</isNotEmpty>
			</dynamic>
				/* 발급년도  */
<!-- 			<dynamic prepend="and"> -->
<!-- 				<isNotEmpty property="selA">					 -->
<!-- 					/* 반기 동일 조건  */ -->
<!-- 						<isNotEmpty property="season1"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*전반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 						<isNotEmpty property="season2"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			
				/* 반기 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="selA">
						<isNotEmpty property="season1">
							a.result_end_dt between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'1231'  /*전반기 조회시*/
						</isNotEmpty>
						<isNotEmpty property="season2">
							a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
						</isNotEmpty>
				</isNotEmpty>
			</dynamic> 

			/*print_state가 발급인 경우*/
			<dynamic prepend="and">
				<isNotEmpty property="selB">
					a.result_dt like convert(varchar,convert(int,#yyyy1#))+replace(#mm1#,' ','')+replace(#dd1#,' ','')+'%'
				</isNotEmpty>
			</dynamic>
						
			<dynamic prepend="and">
			<isNotEmpty property="person_yns">
				c.code_pers in (
				<iterate property="person_yns" open="" conjunction="," close="">
				#person_yns[]#
				</iterate>		
				)
			</isNotEmpty>
			</dynamic>
						
			GROUP BY a.code_certifi
					, a.result_no
					, a.code_pers
<!-- 					JUMIN_DEL -->
<!-- 					, c.oper_no -->
					, c.oper_birth
					, c.oper_lic_no
			        , a.result_start_dt
					, a.result_end_dt
					, c.code_post
					, c.pers_add
			union all
			SELECT a.code_certifi
					, a.result_no
					, a.code_pers
				    , max(a.code_seq) code_seq
<!-- 			        JUMIN_DEL -->
<!-- 			        , c.oper_no -->
			        , c.oper_birth
					, c.oper_lic_no
					, max(c.oper_name) 
			        , a.result_start_dt
					, a.result_end_dt
					, c.code_post
					, isnull((c.pers_add),'') oper_comp_add1_1
					, max(a.result_dt) result_dt
					, max(m.detcodename) prtstateh
					, max(a.print_state) prtstatec
					, max(c.oper_comp_name1) oper_comp_name1
					, max(c.oper_hp) oper_hp
					, max(c.oper_email) oper_email
					, max(c.member) member
					, max(b.detcodename) codeoperation
					, SUM(ISNULL(col1,0)) col1
					, SUM(ISNULL(col2,0)) col2
					, case when SUM(isnull(col3,0)) >= 4 then 4 else SUM(isnull(col3,0)) end col3 
			  FROM result_print a
					  left join com_code m
						     on m.groupcode = '024'
						    and m.detcode = a.print_state
					  left join (select  x.code_pers, x.code_certifi, x.result_no, x.code_seq,
										replace(replace(ISNULL(x.신청서,' ')
													+','+ISNULL(x.사진,' ')
													+','+ISNULL(x.영양사면허증사본,' ')
													+','+ISNULL(x.발급회비,' ')
													+','+ISNULL(x.압축파일,' '), ' ,',''),', ','') detcodename
								  from (           
										select * from (
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_1,'') != '' then '신청서' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_2,'') != '' then '사진' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_3,'') != '' then '영양사면허증사본' else '' end detcodename
														 from result_print     
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_4,'') != '' then '발급회비' else '' end detcodename
														 from result_print  
													   union all
													   select code_pers, code_certifi, result_no, code_seq
															, case when isnull(add_file_5,'') != '' then '압축파일' else '' end detcodename
														 from result_print    
													   ) z
										pivot (max(z.detcodename) for z.detcodename 
										   in ([신청서]
											  ,[사진]
											  ,[영양사면허증사본]
											  ,[발급회비]
											  ,[압축파일])
											  ) as pvt
										) x
							   ) b 
							   on b.code_pers = a.code_pers 
							  and b.code_certifi = a.code_certifi
							  and b.code_seq = a.code_seq
							  and b.result_no = a.result_no
				 , (SELECT a.oper_name
<!-- 				 	JUMIN_DEL -->
<!-- 				 	,a.oper_no -->
				 	,a.oper_birth
				    , a.oper_lic_no
			        , a.oper_comp_name1
					, a.oper_hp
					, a.oper_email
					, p.member
					, p.code_post
					, p.pers_add
		            , case when g.outside_yn='N' then isnull(c.edu_marks,0) else 0 end col1
				    , case when g.outside_yn='Y' then isnull(c.edu_marks,0) else 0 end col2
				    , isnull(c.service_marks,0) col3
				    , a.person_yn code_pers
					, f.oper_end_dt
				    , c.point_manage code_certifi, c.result_state			     
					 FROM operater a 						
						  left join (select  w.code_pers
											, w.code_post
											, w.pers_add
											, cq.detcodename + '(' + cw.detcodename + ')' member
									  from Person_M_TBL w
										   left join com_code cq on cq.groupcode = '006' and cq.detcode = w.code_member
										   left join com_code cw on cw.groupcode = '021' and cw.detcode = w.pers_state ) p on p.code_pers = a.person_yn 
						  left join oper_result c 
								 on c.code_kind = a.code_kind 
								and c.code_certifi = a.code_certifi
								and c.code_seq = a.code_seq
								and c.code_bran = a.code_bran
								and c.bran_seq = a.bran_seq
								and c.receipt_no = a.receipt_no	
						 , edu_test f
						  left join edu_test_name g
								 on g.code_kind = f.code_kind
								and g.code_certifi = f.code_certifi
								and g.code_seq = f.code_seq					        
					WHERE a.code_kind = f.code_kind
					  AND a.code_certifi = f.code_certifi
					  AND a.code_seq = f.code_seq
					  AND a.code_bran = f.code_bran
					  AND a.bran_seq = f.bran_seq 
					  AND f.code_kind IN ('2')
				    ) c 
			WHERE a.code_pers = c.code_pers
			  and a.code_certifi = c.code_certifi 
			  and c.oper_end_dt between DATEADD(DAY,+1,DATEADD(year,-1,convert(date,a.result_end_dt))) 
			  and convert(date,a.result_end_dt)
			  and c.result_state = '11' 
			/* 발급상태  */
			<dynamic prepend="and">
				<isNotEmpty property="print_state1">
					a.print_state = #print_state1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
			/* 자격증번호  */
			<dynamic prepend="and">
				<isNotEmpty property="result_no1">
					a.result_no = #result_no1#
				</isNotEmpty>
			</dynamic>
<!-- 			JUMIN_DEL -->
<!-- 			/* 주민번호 동일 조건  */ -->
<!-- 			<dynamic prepend="and"> -->
<!-- 				<isNotEmpty property="oper_no1"> -->
<!-- 					c.oper_no like #oper_no1#+'%' -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			/* 생년월일 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_birth1">
					c.oper_birth like #oper_birth1#+'%'
				</isNotEmpty>
			</dynamic>
			/* 이름 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_name1">
					c.oper_name like '%'+#oper_name1#+'%'
				</isNotEmpty>
			</dynamic>
				/* 발급년도  */
<!-- 			<dynamic prepend="and"> -->
<!-- 				<isNotEmpty property="selA">					 -->
<!-- 					/* 반기 동일 조건  */ -->
<!-- 						<isNotEmpty property="season1"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*전반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 						<isNotEmpty property="season2"> -->
<!-- 							substring(a.result_end_dt,1,4) = #yyyy1# -->
<!-- 							and a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/ -->
<!-- 						</isNotEmpty> -->
<!-- 				</isNotEmpty> -->
<!-- 			</dynamic> -->
			
				/* 반기 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="selA">
						<isNotEmpty property="season1">
							a.result_end_dt between CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'0801' and CONVERT(VARCHAR,(CONVERT(INT,#yyyy1#)-1))+'1231'  /*전반기 조회시*/
						</isNotEmpty>
						<isNotEmpty property="season2">
							a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
						</isNotEmpty>
				</isNotEmpty>
			</dynamic> 

			/*print_state가 발급인 경우*/
			<dynamic prepend="and">
				<isNotEmpty property="selB">
					a.result_dt like convert(varchar,convert(int,#yyyy1#))+replace(#mm1#,' ','')+replace(#dd1#,' ','')+'%'
				</isNotEmpty>
			</dynamic>
						
			<dynamic prepend="and">
			<isNotEmpty property="person_yns">
				c.code_pers in (
				<iterate property="person_yns" open="" conjunction="," close="">
				#person_yns[]#
				</iterate>		
				)
			</isNotEmpty>
			</dynamic>
						
		GROUP BY a.code_certifi
				, a.result_no
				, a.code_pers
<!-- 				JUMIN_DEL -->
<!-- 				, c.oper_no -->
				, c.oper_birth
				, c.oper_lic_no
		        , a.result_start_dt
				, a.result_end_dt
				, c.code_post
				, c.pers_add
		) zz
		   left join certifi crtf on crtf.code_certifi = zz.code_certifi
		GROUP BY zz.code_certifi
                , crtf.certifi_name
				, result_no
				, code_seq
				, code_pers
				, oper_lic_no

		<!-- 무교육자 쿼리 추가 [START] -->
		)kk2 on kk.code_pers = kk2.code_pers and kk.code_certifi = kk2.codecertifi and kk.result_no = kk2.result_no and kk.code_seq = kk2.code_seq
		
			where 1=1
			/*19.03.06 사망자 제외*/
			and pp.pers_state != '02' 
			/* 발급상태  */
			<dynamic prepend="and">
				<isNotEmpty property="print_state1">
					kk.print_state = #print_state1#
				</isNotEmpty>
			</dynamic>
			/* 자격증구분  */
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					kk.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
			/* 자격증번호  */
			<dynamic prepend="and">
				<isNotEmpty property="result_no1">
					kk.result_no = #result_no1#
				</isNotEmpty>
			</dynamic>
			/* 생년월일 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_birth1">
					pp.pers_birth like #oper_birth1#+'%'
				</isNotEmpty>
			</dynamic>
			/* 이름 동일 조건  */
			<dynamic prepend="and">
				<isNotEmpty property="oper_name1">
					pp.pers_name like '%'+#oper_name1#+'%'
				</isNotEmpty>
			</dynamic>
						
			<dynamic prepend="and">
			<isNotEmpty property="person_yns">
				kk.code_pers in (
				<iterate property="person_yns" open="" conjunction="," close="">
				#person_yns[]#
				</iterate>		
				)
			</isNotEmpty>
			</dynamic>
		
		<!-- 무교육자 쿼리 추가 [END] -->

	)sout
	left join (
		select code_pers
		     , MAX(auth_start0) auth_start0, MAX(auth_end0) auth_end0
		     , MAX(auth_start1) auth_start1, MAX(auth_end1) auth_end1
		     , MAX(auth_start2) auth_start2, MAX(auth_end2) auth_end2
		     , MAX(auth_start3) auth_start3, MAX(auth_end3) auth_end3
		  from (
				select code_pers, min(auth_start) auth_start0, max(auth_end) auth_end0, '' auth_start1, '' auth_end1, '' auth_start2, '' auth_end2, '' auth_start3, '' auth_end3  
				  from dues_h_tbl 
<!-- 				 where (auth_end like  convert(varchar,convert(int,#yyyy1#)+1)+'%' or auth_end like '9999%') and incom_flag = 'Y' -->

				<isNotEmpty property="selA">
					 <!-- where (auth_end like #yyyy1#+'%' or auth_end like '9999%') and incom_flag = 'Y' -->
					 where (auth_end like #yyyy1#+'%' or auth_end like convert(varchar,convert(int,#yyyy1#)+1)+'%' or auth_end like '9999%') and incom_flag = 'Y' 
				</isNotEmpty>
				<isNotEmpty property="selB">
					 where (auth_end like convert(varchar,convert(int,#yyyy1#)+3)+'%' or auth_end like '9999%') and incom_flag = 'Y'
				</isNotEmpty>

				 group by code_pers
				 union all        
				select code_pers, '', '', min(auth_start), max(auth_end),'','','',''
				   from dues_h_tbl 
<!-- 				 where (auth_end like #yyyy1#+'%' or auth_end like '9999%') and incom_flag = 'Y' -->

				<isNotEmpty property="selA">
					 where (auth_end like convert(varchar,convert(int,#yyyy1#)-1)+'%' or auth_end like '9999%') and incom_flag = 'Y'
				</isNotEmpty>
				<isNotEmpty property="selB">
					 where (auth_end like convert(varchar,convert(int,#yyyy1#)+2)+'%' or auth_end like '9999%') and incom_flag = 'Y'
				</isNotEmpty>

				 group by code_pers
				 union all        
				select code_pers,'','','','', min(auth_start), max(auth_end),'','' 
				  from dues_h_tbl 
<!-- 				 where (auth_end like convert(varchar,convert(int,#yyyy1#)-1)+'%' or auth_end like '9999%') and incom_flag = 'Y' -->
				
				<isNotEmpty property="selA">
					 where (auth_end like convert(varchar,convert(int,#yyyy1#)-2)+'%' or auth_end like '9999%') and incom_flag = 'Y' 
				</isNotEmpty>
				<isNotEmpty property="selB">
					 where (auth_end like convert(varchar,convert(int,#yyyy1#)+1)+'%' or auth_end like '9999%') and incom_flag = 'Y'
				</isNotEmpty>

				 group by code_pers
				 union all
				 select code_pers,'', '', '', '','','', min(auth_start) , max(auth_end) 
				  from dues_h_tbl 
<!-- 				 where (auth_end like convert(varchar,convert(int,#yyyy1#)-2)+'%' or auth_end like '9999%') and incom_flag = 'Y'  -->
				
				<isNotEmpty property="selA">
					 where (auth_end like convert(varchar,convert(int,#yyyy1#)-3)+'%' or auth_end like '9999%') and incom_flag = 'Y' 
				</isNotEmpty>
				<isNotEmpty property="selB">
					 where (auth_end like convert(varchar,convert(int,#yyyy1#))+'%' or auth_end like '9999%') and incom_flag = 'Y'
				</isNotEmpty>

				 group by code_pers
		        ) a	
		  group by code_pers
		  ) rr on rr.code_pers = sout.code_pers
	where sout.ncount > #nstart# and sout.ncount <![CDATA[<=]]> #nend#
	)sout2
	)sout3
	</select>	

<!-- 자격증 개별 갱신 update -->
	<update id="updatlicenserenewalList" parameterClass="java.util.HashMap">
		update result_print
		set 
		<isNotEmpty property="result_start_dt1">
		result_start_dt 	= #result_start_dt1#,
		</isNotEmpty>
		<isNotEmpty property="result_end_dt1">
		result_end_dt 	= #result_end_dt1#,
		</isNotEmpty>
		<isNotEmpty property="print_state1">
		print_state 		= #print_state1#,
		</isNotEmpty>
		add_file_1		= #add_file_11#,
		add_file_3		= #add_file_31#,
		add_file_4		= #add_file_41#
		where code_pers = #code_pers1# 
		  and code_certifi = #code_certifi1# 
		  and result_no = #result_no1#
		  and code_seq =#code_seq1# 
	</update>
	
	<select id="selectEtestN" resultClass="java.util.HashMap">
		select case when a.code_kind = '5' then convert(varchar,a.yyyy)+'년도 '+'제'+CONVERT(varchar,a.operation_cnt)+'회 ' + (case when a.season in (1,2) then convert(varchar,a.season)+'학기 ' when a.season = 3 then '집합교육 ' when a.season = 4 then '온라인교육 ' else convert(varchar,a.season)+' ' end) + g.edutest_name + '-' + l.detcodename   
		            else g.edutest_name end  edutest_name
		     , a.code_kind+a.code_certifi+a.code_seq+a.code_bran+a.bran_seq+convert(varchar,isnull(a.operation_cnt,'0'))+convert(varchar,isnull(a.season,'0')) as detcode
			 , a.season
			 , a.operation_place
			 , a.operation_cnt
<!-- 			 , g.finish_point -->
<!-- 			 , g.finish_time -->
			 , g.print_kind
<!-- 			 , g.finish_date	     -->
			 , a.finish_point
			 , a.finish_time
			 , a.finish_date	    
		  from edu_test a
		       left join edu_test_name g
		               on g.code_kind = a.code_kind
		              and g.code_certifi = a.code_certifi
		              and g.code_seq = a.code_seq              
		       left join com_code l
		       on l.groupcode = '034'
		      and l.detcode = a.code_bran
		 where a.code_kind = 5 
		   and a.use_yn='Y'
           and g.use_yn = 'Y'
		   and g.conform = 'Y'		   
		   <dynamic prepend="and">
				<isNotEmpty property="yyyy1">
					a.yyyy = #yyyy1#
				</isNotEmpty>
			</dynamic>
			<dynamic prepend="and">
				<isNotEmpty property="code_bran1">
					a.code_bran = #code_bran1#
				</isNotEmpty>
			</dynamic>
			<dynamic prepend="and">
				<isNotEmpty property="code_certifi1">
					a.code_certifi = #code_certifi1#
				</isNotEmpty>
			</dynamic>
	</select>
	
	<update id="uRstate" parameterClass="java.util.HashMap">
		UPDATE oper_result
		   SET result_state=#result_state#
		     , up_date=GETDATE()
		     , updater=#g_name#
			<isNotEmpty property="insp_date">
		     , insp_date=GETDATE()
			</isNotEmpty>
		 WHERE code_kind=#code_kind1#
		   AND code_certifi=#code_certifi1#
		   AND code_seq=#code_seq1#
		   AND code_bran=#code_bran1#
		   AND bran_seq=#bran_seq1#
		   AND receipt_no=#receipt_no1#	
	</update>
	
	<select id="selectPrint" resultClass="java.util.HashMap">
		 select distinct d.result_no
		        , code_pers
				, a.code_certifi		   
		from operater a 	
			left join (select z.code_pers
			                , x.code_certifi 
		                    , x.result_no, max(x.code_seq) result_code_seq
		                    , x.result_dt
		                  from Person_M_TBL z, result_print x
		                 where z.code_pers = x.code_pers
		                 group by z.code_pers, x.code_certifi, x.result_no, x.result_dt
		                ) d 
		               on d.code_certifi = a.code_certifi
		              and d.code_pers = a.person_yn        
		 	where a.code_kind in ('5')      
		      and d.result_code_seq = '01'
		      and substring(d.result_dt,1,4) = #yyyy1#
		      and a.code_certifi = #code_certifi1#
	     	  <dynamic prepend="and">
	     	  	<isNotEmpty property="code_operation1">
	     	  		a.code_operation=#code_operation1#
	     	  	</isNotEmpty>
	     	  </dynamic>
		      <dynamic prepend="and">
	     	  	<isNotEmpty property="season1">
	     	  		d.result_dt between #yyyy1#+'0801' and #yyyy1#+'1231'
	     	  	</isNotEmpty>
	     	  </dynamic>
	     	  <dynamic prepend="and">
	     	  	<isNotEmpty property="season2">
	     	  		d.result_dt between #yyyy1#+'0101' and #yyyy1#+'0731'
	     	  	</isNotEmpty>
	     	  </dynamic>
	</select>
	<select id="selectPrint1" resultClass="java.util.HashMap">
		select code_pers
		     , result_no
		     , code_seq
		  from 
		(SELECT c.code_pers
		     , a.result_no
		     , a.code_seq
		  FROM result_print a
		     , (SELECT b.person_yn code_pers	
					 , b.code_certifi 	
					 , f.oper_end_dt			     
				  FROM operater b
				     , edu_test f
				 WHERE b.code_kind = f.code_kind
				   AND b.code_certifi = f.code_certifi
				   AND b.code_seq = f.code_seq
				   AND b.code_bran = f.code_bran
				   AND b.bran_seq = f.bran_seq
				   AND f.code_kind IN ('2')) c 	
		 WHERE a.code_pers=c.code_pers
		   AND a.code_certifi=c.code_certifi
		   AND a.print_state=1
		   AND c.oper_end_dt between DATEADD(DAY,+1,DATEADD(year,-3,convert(date,a.result_end_dt))) 
		                         and DATEADD(year,-2,convert(date,a.result_end_dt))
		   
		   AND a.code_certifi=#code_certifi1#
		   AND substring(a.result_end_dt,1,4) = #yyyy1#
		   <dynamic prepend="AND">
		   		<isNotEmpty property="season1">
					a.result_end_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*전반기 조회시*/
				</isNotEmpty>
				<isNotEmpty property="season2">
					a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
				</isNotEmpty>
		   </dynamic>
		 group by c.code_pers, a.result_no, a.code_seq
		union all
		SELECT c.code_pers
		     , a.result_no
		     , a.code_seq
		  FROM result_print a
		     , (SELECT b.person_yn code_pers	
					 , b.code_certifi 	
					 , f.oper_end_dt			     
				  FROM operater b
				     , edu_test f
				 WHERE b.code_kind = f.code_kind
				   AND b.code_certifi = f.code_certifi
				   AND b.code_seq = f.code_seq
				   AND b.code_bran = f.code_bran
				   AND b.bran_seq = f.bran_seq
				   AND f.code_kind IN ('2')) c 	
		 WHERE a.code_pers=c.code_pers
		   AND a.code_certifi=c.code_certifi
		   AND a.print_state=1
		   AND c.oper_end_dt between DATEADD(DAY,+1,DATEADD(year,-2,convert(date,a.result_end_dt))) and DATEADD(year,-1,convert(date,a.result_end_dt))
		 
		   AND a.code_certifi=#code_certifi1#
		   AND substring(a.result_end_dt,1,4) = #yyyy1#
		   <dynamic prepend="AND">
		   		<isNotEmpty property="season1">
					a.result_end_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*전반기 조회시*/
				</isNotEmpty>
				<isNotEmpty property="season2">
					a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
				</isNotEmpty>
		   </dynamic>   
		   group by c.code_pers, a.result_no, a.code_seq
		union all
		SELECT c.code_pers
		     , a.result_no
		     , a.code_seq
		  FROM result_print a
		     , (SELECT b.person_yn code_pers	
					 , b.code_certifi 	
					 , f.oper_end_dt		     
				  FROM operater b
				     , edu_test f
				 WHERE b.code_kind = f.code_kind
				   AND b.code_certifi = f.code_certifi
				   AND b.code_seq = f.code_seq
				   AND b.code_bran = f.code_bran
				   AND b.bran_seq = f.bran_seq
				   AND f.code_kind IN ('2')) c 	
		 WHERE a.code_pers=c.code_pers
		   AND a.code_certifi=c.code_certifi
		   AND a.print_state=1
		   AND c.oper_end_dt between DATEADD(DAY,+1,DATEADD(year,-1,convert(date,a.result_end_dt))) and convert(date,a.result_end_dt)
		   
		   AND a.code_certifi=#code_certifi1#
		   AND substring(a.result_end_dt,1,4) = #yyyy1#		   
		   <dynamic prepend="AND">
		   		<isNotEmpty property="season1">
					a.result_end_dt between #yyyy1#+'0801' and #yyyy1#+'1231'  /*전반기 조회시*/
				</isNotEmpty>
				<isNotEmpty property="season2">
					a.result_end_dt between #yyyy1#+'0101' and #yyyy1#+'0731'  /*후반기 조회시*/
				</isNotEmpty>
		   </dynamic>
		   group by c.code_pers, a.result_no, a.code_seq 						
		) xx
		group by code_pers, result_no, code_seq
	</select>
	
	<update id="uPstate" parameterClass="java.util.HashMap">
		UPDATE result_print 
	      SET print_state='0'
	    WHERE code_pers=#code_pers#
	      AND code_certifi=#code_certifi#
	      AND code_seq=#code_seq#
	      AND result_no=#result_no#
	</update>
	
	<update id="uOPstate" parameterClass="java.util.HashMap">
		UPDATE operater
		   SET oper_state=#oper_state1# 
		 WHERE code_kind=#code_kind1#
		   AND code_certifi=#code_certifi1#
		   AND code_bran=#code_bran1#
		   AND code_seq=#code_seq1#
		   AND bran_seq=#bran_seq1#
		   AND receipt_no=#receipt_no1#
	</update>
	
	<update id="uOPstateBatch" parameterClass="java.util.HashMap">
		UPDATE operater
		   SET oper_state='11' 
		 WHERE code_kind=#code_kind1#
		   AND code_certifi=#code_certifi1#
		   AND code_bran=#code_bran1#
		   AND code_seq=#code_seq1#
		   AND bran_seq=#bran_seq1#
		   AND receipt_no=#receipt_no1#
		   AND oper_state = '01'
	</update>
	
	<delete id="uOPdelete" parameterClass="java.util.HashMap">
		DELETE operater
		 WHERE code_kind=#code_kind1#
		   AND code_certifi=#code_certifi1#
		   AND code_bran=#code_bran1#
		   AND code_seq=#code_seq1#
		   AND bran_seq=#bran_seq1#
		   AND receipt_no=#receipt_no1#
	</delete>
</sqlMap>