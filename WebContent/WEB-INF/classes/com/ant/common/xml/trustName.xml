<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="trustName">
<select id="trust_name" parameterClass="java.util.HashMap" resultClass="java.util.HashMap" >
SELECT OUT.*
 FROM (	select ROW_NUMBER()OVER(ORDER BY trust_name ) no
             , trust_name
             , COUNT(code_pers) pers_count
  		  from pers_company  
  		 where ISNULL(trust_name,'') != ''
         	<dynamic prepend="and">
	  		 	<isNotEmpty property="enddate">
	  		 		pers_in_dt <![CDATA[<=]]> #enddate#
	  		 	</isNotEmpty>
	  		</dynamic>
	  		<dynamic prepend="and">
	  		 	<isNotEmpty property="startdate">
	  		 		(isnull(pers_out_dt,'') = '' or (pers_out_dt <![CDATA[>=]]> #startdate#))
	  		 	</isNotEmpty>
  		 	</dynamic>
         group by trust_name
) OUT
  WHERE 1=1 
  	and out.no > #nstart#
  	and out.no <![CDATA[<=]]> #nend#
</select>

 
<select id="trustNameCnt" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
SELECT count(*) cnt
 FROM ( select trust_name
             , COUNT(code_pers) pers_count
          from pers_company
         where ISNULL(trust_name,'') != ''
         	<dynamic prepend="and">
	  		 	<isNotEmpty property="enddate">
	  		 		pers_in_dt <![CDATA[<=]]> #enddate#
	  		 	</isNotEmpty>
	  		</dynamic>
	  		<dynamic prepend="and">
	  		 	<isNotEmpty property="startdate">
	  		 		(isnull(pers_out_dt,'') = '' or (pers_out_dt <![CDATA[>=]]> #startdate#))
	  		 	</isNotEmpty>
  		 	</dynamic>
         group by trust_name
 ) aa
</select>
    
</sqlMap>
